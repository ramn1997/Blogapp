import{a as ru}from"./chunk-X6YHEMIY.js";import{a as f,b as I,c as It,d as Y,e as Ml,f as h}from"./chunk-ZY7WU73K.js";var Nh={};Y(Nh,{addClientCapabilitiesToClaims:()=>kp,blockAPICallsBeforeInitialize:()=>si,blockAcquireTokenInPopups:()=>Ph,blockNonBrowserEnvironment:()=>Hr,blockRedirectInIframe:()=>Oh,blockReloadInHiddenIframes:()=>bh,cancelPendingBridgeResponse:()=>dl,clearHash:()=>Xo,createGuid:()=>Fr,getCurrentUri:()=>Ie,getHomepage:()=>ul,invoke:()=>te,invokeAsync:()=>m,isInIframe:()=>Lr,isInPopup:()=>vh,parseAuthResponseFromUrl:()=>Rh,preconnect:()=>en,preflightCheck:()=>Zo,redirectPreflightCheck:()=>ai,replaceHash:()=>hl,waitForBridgeResponse:()=>dt});var x={};Y(x,{addApplicationTelemetry:()=>Co,addAuthorizationCode:()=>Oa,addBrokerParameters:()=>it,addCcsOid:()=>ot,addCcsUpn:()=>_t,addClaims:()=>qt,addClientAssertion:()=>Ao,addClientAssertionType:()=>To,addClientCapabilitiesToClaims:()=>Hl,addClientId:()=>Vt,addClientInfo:()=>Jt,addClientSecret:()=>yo,addCodeChallengeParams:()=>sm,addCodeVerifier:()=>Na,addCorrelationId:()=>Wt,addDeviceCode:()=>am,addDomainHint:()=>Ra,addEARParameters:()=>um,addExtraParameters:()=>nt,addGrantType:()=>Io,addIdTokenHint:()=>ka,addInstanceAware:()=>wo,addLibraryInfo:()=>go,addLoginHint:()=>Tr,addLogoutHint:()=>Ma,addNativeBroker:()=>im,addNonce:()=>ba,addOboAssertion:()=>cm,addPassword:()=>dm,addPopToken:()=>So,addPostLogoutRedirectUri:()=>_a,addPrompt:()=>va,addRedirectUri:()=>jt,addRefreshToken:()=>Pa,addRequestTokenUse:()=>lm,addResponseMode:()=>Sa,addResponseType:()=>nm,addScopes:()=>Gt,addServerTelemetry:()=>ko,addSid:()=>Dn,addSshJwk:()=>_o,addState:()=>Eo,addThrottling:()=>Ro,addUsername:()=>hm,instrumentBrokerParams:()=>zt});var y={};Y(y,{AADAuthority:()=>Oe,AAD_INSTANCE_DISCOVERY_ENDPT:()=>Li,AAD_TENANT_DOMAIN_SUFFIX:()=>Hi,ADFS:()=>Ui,APP_METADATA:()=>gr,AUTHORITY_METADATA_CACHE_KEY:()=>Cr,AUTHORITY_METADATA_REFRESH_TIME_SECONDS:()=>es,AUTHORIZATION_PENDING:()=>su,AZURE_REGION_AUTO_DISCOVER_FLAG:()=>zi,AuthenticationScheme:()=>z,AuthorityMetadataSource:()=>Ae,CACHE_ACCOUNT_TYPE_ADFS:()=>Xi,CACHE_ACCOUNT_TYPE_GENERIC:()=>En,CACHE_ACCOUNT_TYPE_MSAV1:()=>ku,CACHE_ACCOUNT_TYPE_MSSTS:()=>Yi,CACHE_KEY_SEPARATOR:()=>Ft,CIAM_AUTH_URL:()=>un,CLIENT_INFO:()=>Zi,CLIENT_INFO_SEPARATOR:()=>fr,CLIENT_MISMATCH_ERROR:()=>hs,CODE_GRANT_TYPE:()=>nu,CONSUMER_UTID:()=>ou,CacheOutcome:()=>Ge,CacheType:()=>Ru,ClaimsRequestKeys:()=>pr,CodeChallengeMethodValues:()=>Su,CredentialType:()=>ne,DEFAULT_AUTHORITY:()=>xl,DEFAULT_AUTHORITY_HOST:()=>xi,DEFAULT_COMMON_TENANT:()=>to,DEFAULT_MAX_THROTTLE_TIME_SECONDS:()=>as,DEFAULT_THROTTLE_TIME_SECONDS:()=>ss,DEFAULT_TOKEN_RENEWAL_OFFSET_SEC:()=>us,DSTS:()=>Di,EMAIL_SCOPE:()=>Ll,EncodingTypes:()=>Ou,FORWARD_SLASH:()=>ur,GrantType:()=>no,HTTP_BAD_REQUEST:()=>gn,HTTP_CLIENT_ERROR:()=>uu,HTTP_CLIENT_ERROR_RANGE_END:()=>Wi,HTTP_CLIENT_ERROR_RANGE_START:()=>qi,HTTP_GATEWAY_TIMEOUT:()=>Au,HTTP_GONE:()=>gu,HTTP_MULTI_SIDED_ERROR:()=>Tu,HTTP_NOT_FOUND:()=>pu,HTTP_REDIRECT:()=>du,HTTP_REQUEST_TIMEOUT:()=>fu,HTTP_SERVER_ERROR:()=>Eu,HTTP_SERVER_ERROR_RANGE_END:()=>$i,HTTP_SERVER_ERROR_RANGE_START:()=>Ji,HTTP_SERVICE_UNAVAILABLE:()=>yu,HTTP_SUCCESS:()=>fn,HTTP_SUCCESS_RANGE_END:()=>hu,HTTP_SUCCESS_RANGE_START:()=>lu,HTTP_TOO_MANY_REQUESTS:()=>Cu,HTTP_UNAUTHORIZED:()=>mu,HeaderNames:()=>F,HttpMethod:()=>Iu,IMDS_ENDPOINT:()=>pn,IMDS_TIMEOUT:()=>Bi,IMDS_VERSION:()=>Ki,INVALID_GRANT_ERROR:()=>ls,INVALID_INSTANCE:()=>ji,JsonWebTokenTypes:()=>ds,KNOWN_PUBLIC_CLOUDS:()=>Vi,NOT_APPLICABLE:()=>au,NOT_AVAILABLE:()=>Ht,OAuthResponseType:()=>_u,OFFLINE_ACCESS_SCOPE:()=>mn,OIDC_DEFAULT_SCOPES:()=>mr,OIDC_SCOPES:()=>Cn,ONE_DAY_IN_MS:()=>bu,OPENID_SCOPE:()=>Ul,PROFILE_SCOPE:()=>Dl,PasswordGrantConstants:()=>Tn,PersistentCacheKeys:()=>wu,PromptValue:()=>oo,REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:()=>Gi,RESOURCE_DELIM:()=>ro,RegionDiscoveryOutcomes:()=>ao,RegionDiscoverySources:()=>St,ResponseMode:()=>Qi,S256_CODE_CHALLENGE_METHOD:()=>iu,SERVER_TELEM_CACHE_KEY:()=>io,SERVER_TELEM_CATEGORY_SEPARATOR:()=>An,SERVER_TELEM_MAX_CACHED_ERRORS:()=>rs,SERVER_TELEM_MAX_CUR_HEADER_BYTES:()=>vu,SERVER_TELEM_MAX_LAST_HEADER_BYTES:()=>ts,SERVER_TELEM_OVERFLOW_FALSE:()=>ns,SERVER_TELEM_OVERFLOW_TRUE:()=>os,SERVER_TELEM_SCHEMA_VERSION:()=>yn,SERVER_TELEM_UNKNOWN_ERROR:()=>is,SERVER_TELEM_VALUE_SEPARATOR:()=>wt,SHR_NONCE_VALIDITY:()=>cu,SKU:()=>Mi,THE_FAMILY_ID:()=>Kt,THROTTLING_PREFIX:()=>so,URL_FORM_CONTENT_TYPE:()=>Fi,X_MS_LIB_CAPABILITY_VALUE:()=>cs});var Mi="msal.js.common",xl="https://login.microsoftonline.com/common/",xi="login.microsoftonline.com",to="common",Ui="adfs",Di="dstsv2",Li=`${xl}discovery/instance?api-version=1.1&authorization_endpoint=`,un=".ciamlogin.com",Hi=".onmicrosoft.com",ro="|",ou="9188040d-6c67-4c5b-b112-36a304b66dad",Ul="openid",Dl="profile",mn="offline_access",Ll="email",nu="authorization_code",iu="S256",Fi="application/x-www-form-urlencoded;charset=utf-8",su="authorization_pending",au="N/A",Ht="Not Available",ur="/",pn="http://169.254.169.254/metadata/instance/compute/location",Ki="2020-06-01",Bi=2e3,zi="TryAutoDetect",Gi="login.microsoft.com",Vi=["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],cu=240,ji="invalid_instance",fn=200,lu=200,hu=299,du=302,uu=400,qi=400,gn=400,mu=401,pu=404,fu=408,gu=410,Cu=429,Wi=499,Eu=500,Ji=500,yu=503,Au=504,$i=599,Tu=600,Iu={GET:"GET",POST:"POST"},mr=[Ul,Dl,mn],Cn=[...mr,Ll],F={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},wu={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Oe={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},pr={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},oo={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},Su={PLAIN:"plain",S256:"S256"},_u={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},Qi={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},no={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},Yi="MSSTS",Xi="ADFS",ku="MSA",En="Generic",Ft="-",fr=".",ne={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Ru={ADFS:1001,MSA:1002,MSSTS:1003,GENERIC:1004,ACCESS_TOKEN:2001,REFRESH_TOKEN:2002,ID_TOKEN:2003,APP_METADATA:3001,UNDEFINED:9999},gr="appmetadata",Zi="client_info",Kt="1",Cr="authority-metadata",es=3600*24,Ae={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},yn=5,vu=80,ts=330,rs=50,io="server-telemetry",An="|",wt=",",os="1",ns="0",is="unknown_error",z={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},ss=60,as=3600,so="throttling",cs="retry-after, h429",ls="invalid_grant",hs="client_mismatch",Tn={username:"username",password:"password"},St={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},ao={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},Ge={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},ds={Jwt:"JWT",Jwk:"JWK",Pop:"pop"},bu=864e5,us=300,Ou={BASE64:"base64",HEX:"hex",UTF8:"utf-8"};var rt={};Y(rt,{ACCESS_TOKEN:()=>Mu,BROKER_CLIENT_ID:()=>co,BROKER_REDIRECT_URI:()=>kn,CCS_HEADER:()=>Bu,CLAIMS:()=>gs,CLIENT_ASSERTION:()=>Ks,CLIENT_ASSERTION_TYPE:()=>Bs,CLIENT_ID:()=>Ve,CLIENT_INFO:()=>Hu,CLIENT_REQUEST_ID:()=>ks,CLIENT_SECRET:()=>Fs,CODE:()=>Is,CODE_CHALLENGE:()=>ws,CODE_CHALLENGE_METHOD:()=>Ss,CODE_VERIFIER:()=>_s,DEVICE_CODE:()=>Hs,DOMAIN_HINT:()=>Js,EAR_JWE_CRYPTO:()=>Qs,EAR_JWK:()=>$s,ERROR:()=>Pu,ERROR_DESCRIPTION:()=>Nu,EXPIRES_IN:()=>Uu,FOCI:()=>Ku,GRANT_TYPE:()=>fs,ID_TOKEN:()=>xu,ID_TOKEN_HINT:()=>Ls,INSTANCE_AWARE:()=>Er,LOGIN_HINT:()=>Ws,LOGOUT_HINT:()=>js,NATIVE_BROKER:()=>Vs,NONCE:()=>As,OBO_ASSERTION:()=>zs,ON_BEHALF_OF:()=>Fu,POST_LOGOUT_URI:()=>Ds,PROMPT:()=>Ts,REDIRECT_URI:()=>In,REFRESH_TOKEN:()=>Es,REFRESH_TOKEN_EXPIRES_IN:()=>Du,REQUESTED_TOKEN_USE:()=>Gs,REQ_CNF:()=>Sn,RESPONSE_MODE:()=>ps,RESPONSE_TYPE:()=>ms,RETURN_SPA_CODE:()=>_n,SCOPE:()=>Cs,SESSION_STATE:()=>Lu,SID:()=>qs,STATE:()=>ys,TOKEN_TYPE:()=>wn,X_APP_NAME:()=>xs,X_APP_VER:()=>Us,X_CLIENT_CPU:()=>Os,X_CLIENT_CURR_TELEM:()=>Ps,X_CLIENT_EXTRA_SKU:()=>zu,X_CLIENT_LAST_TELEM:()=>Ns,X_CLIENT_OS:()=>bs,X_CLIENT_SKU:()=>Rs,X_CLIENT_VER:()=>vs,X_MS_LIB_CAPABILITY:()=>Ms});var Ve="client_id",In="redirect_uri",ms="response_type",ps="response_mode",fs="grant_type",gs="claims",Cs="scope",Pu="error",Nu="error_description",Mu="access_token",xu="id_token",Es="refresh_token",Uu="expires_in",Du="refresh_token_expires_in",ys="state",As="nonce",Ts="prompt",Lu="session_state",Hu="client_info",Is="code",ws="code_challenge",Ss="code_challenge_method",_s="code_verifier",ks="client-request-id",Rs="x-client-SKU",vs="x-client-VER",bs="x-client-OS",Os="x-client-CPU",Ps="x-client-current-telemetry",Ns="x-client-last-telemetry",Ms="x-ms-lib-capability",xs="x-app-name",Us="x-app-ver",Ds="post_logout_redirect_uri",Ls="id_token_hint",Hs="device_code",Fs="client_secret",Ks="client_assertion",Bs="client_assertion_type",wn="token_type",Sn="req_cnf",zs="assertion",Gs="requested_token_use",Fu="on_behalf_of",Ku="foci",Bu="X-AnchorMailbox",_n="return_spa_code",Vs="nativebroker",js="logout_hint",qs="sid",Ws="login_hint",Js="domain_hint",zu="x-client-xtra-sku",co="brk_client_id",kn="brk_redirect_uri",Er="instance_aware",$s="ear_jwk",Qs="ear_jwe_crypto";function Rn(n){return`See https://aka.ms/msal.js.errors#${n} for details`}var w=class n extends Error{constructor(e,t,r){let o=t||(e?Rn(e):""),i=o?`${e}: ${o}`:e;super(i),Object.setPrototypeOf(this,n.prototype),this.errorCode=e||"",this.errorMessage=o||"",this.subError=r||"",this.name="AuthError"}setCorrelationId(e){this.correlationId=e}};function yr(n,e){return new w(n,e||Rn(n))}var lo=class n extends w{constructor(e){super(e),this.name="ClientConfigurationError",Object.setPrototypeOf(this,n.prototype)}};function v(n){return new lo(n)}var K=class{static isEmptyObj(e){if(e)try{let t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){let t={},r=e.split("&"),o=i=>decodeURIComponent(i.replace(/\+/g," "));return r.forEach(i=>{if(i.trim()){let[s,a]=i.split(/=(.+)/g,2);s&&a&&(t[o(s)]=o(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}};var Pe=class n extends w{constructor(e,t){super(e,t),this.name="ClientAuthError",Object.setPrototypeOf(this,n.prototype)}};function p(n,e){return new Pe(n,e)}var ge={};Y(ge,{authorityMismatch:()=>Ju,authorityUriInsecure:()=>Xs,cannotAllowPlatformBroker:()=>Wu,cannotSetOIDCOptions:()=>qu,claimsRequestParsingError:()=>Gu,emptyInputScopesError:()=>ea,invalidAuthenticationHeader:()=>On,invalidAuthorityMetadata:()=>na,invalidClaims:()=>vn,invalidCloudDiscoveryMetadata:()=>bn,invalidCodeChallengeMethod:()=>Vu,invalidRequestMethodForEAR:()=>$u,logoutRequestEmpty:()=>ra,missingNonceAuthenticationHeader:()=>sa,missingSshJwk:()=>ho,missingSshKid:()=>ju,pkceParamsMissing:()=>oa,redirectUriEmpty:()=>Ys,tokenRequestEmpty:()=>ta,untrustedAuthority:()=>ia,urlEmptyError:()=>Zs,urlParseError:()=>Ar});var Ys="redirect_uri_empty",Gu="claims_request_parsing_error",Xs="authority_uri_insecure",Ar="url_parse_error",Zs="empty_url_error",ea="empty_input_scopes_error",vn="invalid_claims",ta="token_request_empty",ra="logout_request_empty",Vu="invalid_code_challenge_method",oa="pkce_params_missing",bn="invalid_cloud_discovery_metadata",na="invalid_authority_metadata",ia="untrusted_authority",ho="missing_ssh_jwk",ju="missing_ssh_kid",sa="missing_nonce_authentication_header",On="invalid_authentication_header",qu="cannot_set_OIDCOptions",Wu="cannot_allow_platform_broker",Ju="authority_mismatch",$u="invalid_request_method_for_EAR";var N={};Y(N,{authTimeNotFound:()=>uo,authorizationCodeMissingFromServerResponse:()=>Ta,bindingKeyNotRemoved:()=>Zu,cannotAppendScopeSet:()=>Ea,cannotRemoveEmptyScope:()=>Ca,clientInfoDecodingError:()=>Pn,clientInfoEmptyError:()=>aa,emptyInputScopeSet:()=>xn,endSessionEndpointNotSupported:()=>Ia,endpointResolutionError:()=>Ne,hashNotDeserialized:()=>da,invalidCacheEnvironment:()=>po,invalidCacheRecord:()=>ya,invalidState:()=>Bt,keyIdMissing:()=>wa,maxAgeTranspired:()=>pa,methodNotImplemented:()=>R,multipleMatchingAppMetadata:()=>fa,multipleMatchingTokens:()=>Qu,nestedAppAuthBridgeDisabled:()=>rm,networkError:()=>la,noAccountFound:()=>Yu,noAccountInSilentRequest:()=>mo,noCryptoObject:()=>Un,noNetworkConnectivity:()=>em,nonceMismatch:()=>ma,nullOrEmptyToken:()=>ca,openIdConfigError:()=>ha,platformBrokerError:()=>om,requestCannotBeMade:()=>ga,stateMismatch:()=>ua,stateNotFound:()=>Mn,tokenClaimsCnfRequiredForSignedJwt:()=>Aa,tokenParsingError:()=>Nn,tokenRefreshRequired:()=>fo,unexpectedCredentialType:()=>Xu,userCanceled:()=>tm});var Pn="client_info_decoding_error",aa="client_info_empty_error",Nn="token_parsing_error",ca="null_or_empty_token",Ne="endpoints_resolution_error",la="network_error",ha="openid_config_error",da="hash_not_deserialized",Bt="invalid_state",ua="state_mismatch",Mn="state_not_found",ma="nonce_mismatch",uo="auth_time_not_found",pa="max_age_transpired",Qu="multiple_matching_tokens",fa="multiple_matching_appMetadata",ga="request_cannot_be_made",Ca="cannot_remove_empty_scope",Ea="cannot_append_scopeset",xn="empty_input_scopeset",mo="no_account_in_silent_request",ya="invalid_cache_record",po="invalid_cache_environment",Yu="no_account_found",Un="no_crypto_object",Xu="unexpected_credential_type",fo="token_refresh_required",Aa="token_claims_cnf_required_for_signedjwt",Ta="authorization_code_missing_from_server_response",Zu="binding_key_not_removed",Ia="end_session_endpoint_not_supported",wa="key_id_missing",em="no_network_connectivity",tm="user_canceled",R="method_not_implemented",rm="nested_app_auth_bridge_disabled",om="platform_broker_error";var G=class n{constructor(e){let t=e?K.trimArrayEntries([...e]):[],r=t?K.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw v(ea);this.scopes=new Set,r.forEach(o=>this.scopes.add(o))}static fromString(e){let r=(e||"").split(" ");return new n(r)}static createSearchScopes(e){let t=e&&e.length>0?e:[...mr],r=new n(t);return r.containsOnlyOIDCScopes()?r.removeScope(mn):r.removeOIDCScopes(),r}containsScope(e){let t=this.printScopesLowerCase().split(" "),r=new n(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return Cn.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw p(Ea)}}removeScope(e){if(!e)throw p(Ca);this.scopes.delete(e.trim())}removeOIDCScopes(){Cn.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw p(xn);let t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw p(xn);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();let t=this.unionScopeSets(e),r=e.getScopeCount(),o=this.getScopeCount();return t.size<o+r}getScopeCount(){return this.scopes.size}asArray(){let e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):""}printScopesLowerCase(){return this.printScopes().toLowerCase()}};function zt(n,e,t){if(!e)return;let r=n.get(Ve);r&&n.has(co)&&t?.addFields({embeddedClientId:r,embeddedRedirectUri:n.get(In)},e)}function nm(n,e){n.set(ms,e)}function Sa(n,e){n.set(ps,e||Qi.QUERY)}function im(n){n.set(Vs,"1")}function Gt(n,e,t=!0,r=mr){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");let o=t?[...e||[],...r]:e||[],i=new G(o);n.set(Cs,i.printScopes())}function Vt(n,e){n.set(Ve,e)}function jt(n,e){n.set(In,e)}function _a(n,e){n.set(Ds,e)}function ka(n,e){n.set(Ls,e)}function Ra(n,e){n.set(Js,e)}function Tr(n,e){n.set(Ws,e)}function _t(n,e){n.set(F.CCS_HEADER,`UPN:${e}`)}function ot(n,e){n.set(F.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function Dn(n,e){n.set(qs,e)}function qt(n,e,t){let r=Hl(e,t);try{JSON.parse(r)}catch{throw v(vn)}n.set(gs,r)}function Wt(n,e){n.set(ks,e)}function go(n,e){n.set(Rs,e.sku),n.set(vs,e.version),e.os&&n.set(bs,e.os),e.cpu&&n.set(Os,e.cpu)}function Co(n,e){e?.appName&&n.set(xs,e.appName),e?.appVersion&&n.set(Us,e.appVersion)}function va(n,e){n.set(Ts,e)}function Eo(n,e){e&&n.set(ys,e)}function ba(n,e){n.set(As,e)}function sm(n,e,t){if(e&&t)n.set(ws,e),n.set(Ss,t);else throw v(oa)}function Oa(n,e){n.set(Is,e)}function am(n,e){n.set(Hs,e)}function Pa(n,e){n.set(Es,e)}function Na(n,e){n.set(_s,e)}function yo(n,e){n.set(Fs,e)}function Ao(n,e){e&&n.set(Ks,e)}function To(n,e){e&&n.set(Bs,e)}function cm(n,e){n.set(zs,e)}function lm(n,e){n.set(Gs,e)}function Io(n,e){n.set(fs,e)}function Jt(n){n.set(Zi,"1")}function wo(n){n.has(Er)||n.set(Er,"true")}function nt(n,e){Object.entries(e).forEach(([t,r])=>{!n.has(t)&&r&&n.set(t,r)})}function Hl(n,e){let t;if(!n)t={};else try{t=JSON.parse(n)}catch{throw v(vn)}return e&&e.length>0&&(t.hasOwnProperty(pr.ACCESS_TOKEN)||(t[pr.ACCESS_TOKEN]={}),t[pr.ACCESS_TOKEN][pr.XMS_CC]={values:e}),JSON.stringify(t)}function hm(n,e){n.set(Tn.username,e)}function dm(n,e){n.set(Tn.password,e)}function So(n,e){e&&(n.set(wn,z.POP),n.set(Sn,e))}function _o(n,e){e&&(n.set(wn,z.SSH),n.set(Sn,e))}function ko(n,e){n.set(Ps,e.generateCurrentRequestHeaderValue()),n.set(Ns,e.generateLastRequestHeaderValue())}function Ro(n){n.set(Ms,cs)}function Ma(n,e){n.set(js,e)}function it(n,e,t){n.has(co)||n.set(co,e),n.has(kn)||n.set(kn,t)}function um(n,e){n.set($s,encodeURIComponent(e)),n.set(Qs,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}var _e={};Y(_e,{getDeserializedResponse:()=>mm,mapToQueryString:()=>je,normalizeUrlForComparison:()=>pm,stripLeadingHashOrQuery:()=>Kl});function Fl(n){if(!n)return n;let e=n.toLowerCase();return K.endsWith(e,"?")?e=e.slice(0,-1):K.endsWith(e,"?/")&&(e=e.slice(0,-2)),K.endsWith(e,"/")||(e+="/"),e}function Kl(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function mm(n){if(!n||n.indexOf("=")<0)return null;try{let e=Kl(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw p(da)}return null}function je(n){let e=new Array;return n.forEach((t,r)=>{e.push(`${r}=${encodeURIComponent(t)}`)}),e.join("&")}function pm(n){if(!n)return n;let e=n.split("#")[0];try{let t=new URL(e),r=t.origin+t.pathname+t.search;return Fl(r)}catch{return Fl(e)}}var qe={createNewGuid:()=>{throw p(R)},base64Decode:()=>{throw p(R)},base64Encode:()=>{throw p(R)},base64UrlEncode:()=>{throw p(R)},encodeKid:()=>{throw p(R)},getPublicKeyThumbprint(){return h(this,null,function*(){throw p(R)})},removeTokenBindingKey(){return h(this,null,function*(){throw p(R)})},clearKeystore(){return h(this,null,function*(){throw p(R)})},signJwt(){return h(this,null,function*(){throw p(R)})},hashString(){return h(this,null,function*(){throw p(R)})}};var M=function(n){return n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace",n}(M||{}),fm=50,gm=500,st=new Map;function Cm(n,e){st.delete(n),st.set(n,e)}function Em(n,e){let t=Date.now(),r=st.get(n);if(r)Cm(n,r);else if(r={logs:[],firstEventTime:t},st.set(n,r),st.size>fm){let o=st.keys().next().value;o&&st.delete(o)}r.logs.push(I(f({},e),{milliseconds:t-r.firstEventTime})),r.logs.length>gm&&r.logs.shift()}function Bl(n){let e=[];for(let t of["",n]){let r=st.get(t);e.push(...r?.logs??[]),st.delete(t)}return e}function ym(n){if(n.length!==6)return!1;for(let e=0;e<n.length;e++){let t=n[e];if(!(t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"))return!1}return!0}var U=class n{constructor(e,t,r){this.level=M.Info;let o=()=>{},i=e||n.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||o,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:M.Info,this.packageName=t||"",this.packageVersion=r||""}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:M.Info}}clone(e,t){return new n({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level},e,t)}logMessage(e,t){let r=t.correlationId;if(ym(e)){let c={hash:e,level:t.logLevel,containsPii:t.containsPii||!1,milliseconds:0};Em(r,c)}if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;let a=`${`[${new Date().toUTCString()}] : [${r}]`} : ${this.packageName}@${this.packageVersion} : ${M[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,a,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:M.Error,containsPii:!1,correlationId:t})}errorPii(e,t){this.logMessage(e,{logLevel:M.Error,containsPii:!0,correlationId:t})}warning(e,t){this.logMessage(e,{logLevel:M.Warning,containsPii:!1,correlationId:t})}warningPii(e,t){this.logMessage(e,{logLevel:M.Warning,containsPii:!0,correlationId:t})}info(e,t){this.logMessage(e,{logLevel:M.Info,containsPii:!1,correlationId:t})}infoPii(e,t){this.logMessage(e,{logLevel:M.Info,containsPii:!0,correlationId:t})}verbose(e,t){this.logMessage(e,{logLevel:M.Verbose,containsPii:!1,correlationId:t})}verbosePii(e,t){this.logMessage(e,{logLevel:M.Verbose,containsPii:!0,correlationId:t})}trace(e,t){this.logMessage(e,{logLevel:M.Trace,containsPii:!1,correlationId:t})}tracePii(e,t){this.logMessage(e,{logLevel:M.Trace,containsPii:!0,correlationId:t})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}};var kt="@azure/msal-common",We="16.0.4";var Rt={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};function xa(n,e){return!!n&&!!e&&n===e.split(".")[1]}function ke(n,e,t,r){if(r){let{oid:o,sub:i,tid:s,name:a,tfp:c,acr:l,preferred_username:d,upn:u,login_hint:g}=r,E=s||c||l||"";return{tenantId:E,localAccountId:o||i||"",name:a,username:d||u||"",loginHint:g,isHomeTenant:xa(E,n)}}else return{tenantId:t,localAccountId:e,username:"",isHomeTenant:xa(t,n)}}function $t(n,e,t,r){let o=n;if(e){let i=e,{isHomeTenant:a}=i,c=It(i,["isHomeTenant"]);o=f(f({},n),c)}if(t){let s=ke(n.homeAccountId,n.localAccountId,n.tenantId,t),{isHomeTenant:a}=s,c=It(s,["isHomeTenant"]);return o=I(f(f({},o),c),{idTokenClaims:t,idToken:r}),o}return o}var D={};Y(D,{checkMaxAge:()=>vo,extractTokenClaims:()=>at,getJWSPayload:()=>zl,isKmsi:()=>Ua});function at(n,e){let t=zl(n);try{let r=e(t);return JSON.parse(r)}catch{throw p(Nn)}}function Ua(n){if(!n.signin_state)return!1;let e=["kmsi","dvc_dmjd"];return n.signin_state.some(t=>e.includes(t.trim().toLowerCase()))}function zl(n){if(!n)throw p(ca);let t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw p(Nn);return t[2]}function vo(n,e){if(e===0||Date.now()-3e5>n+e)throw p(pa)}var b=class n{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw v(Zs);e.includes("#")||(this._urlString=n.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return K.endsWith(t,"?")?t=t.slice(0,-1):K.endsWith(t,"?/")&&(t=t.slice(0,-2)),K.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw v(Ar)}if(!e.HostNameAndPort||!e.PathSegments)throw v(Ar);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw v(Xs)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return n.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){let t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===Oe.COMMON||r[0]===Oe.ORGANIZATIONS)&&(r[0]=e),n.constructAuthorityUriFromObject(t)}getUrlComponents(){let e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw v(Ar);let r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},o=r.AbsolutePath.split("/");return o=o.filter(i=>i&&i.length>0),r.PathSegments=o,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){let t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw v(Ar);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===ur){let o=new n(t).getUrlComponents();return o.Protocol+"//"+o.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new n(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}};var Am=[{host:"login.microsoftonline.com"},{host:"login.chinacloudapi.cn",issuerHost:"login.partner.microsoftonline.cn"},{host:"login.microsoftonline.us"},{host:"login.sovcloud-identity.fr"},{host:"login.sovcloud-identity.de"},{host:"login.sovcloud-identity.sg"}];function Tm(n,e){return{token_endpoint:`https://${n}/{tenantid}/oauth2/v2.0/token`,jwks_uri:`https://${n}/{tenantid}/discovery/v2.0/keys`,issuer:`https://${e}/{tenantid}/v2.0`,authorization_endpoint:`https://${n}/{tenantid}/oauth2/v2.0/authorize`,end_session_endpoint:`https://${n}/{tenantid}/oauth2/v2.0/logout`}}var Im=Am.reduce((n,{host:e,issuerHost:t})=>(n[e]=Tm(e,t||e),n),{}),Vl={endpointMetadata:Im,instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]},{preferred_network:"login.sovcloud-identity.fr",preferred_cache:"login.sovcloud-identity.fr",aliases:["login.sovcloud-identity.fr"]},{preferred_network:"login.sovcloud-identity.de",preferred_cache:"login.sovcloud-identity.de",aliases:["login.sovcloud-identity.de"]},{preferred_network:"login.sovcloud-identity.sg",preferred_cache:"login.sovcloud-identity.sg",aliases:["login.sovcloud-identity.sg"]}]}},Da=Vl.endpointMetadata,La=Vl.instanceDiscoveryMetadata,Ha=new Set;La.metadata.forEach(n=>{n.aliases.forEach(e=>{Ha.add(e)})});function jl(n,e,t){let r,o=n.canonicalAuthority;if(o){let i=new b(o).getUrlComponents().HostNameAndPort;r=Gl(e,t,i,n.cloudDiscoveryMetadata?.metadata)||Gl(e,t,i,La.metadata)||n.knownAuthorities}return r||[]}function Gl(n,e,t,r,o){if(n.trace("1bmquz",e),t&&r){let i=bo(r,t);if(i)return n.trace("1fotbt",e),i.aliases;n.trace("14avvj",e)}return null}function ql(n){return bo(La.metadata,n)}function bo(n,e){for(let t=0;t<n.length;t++){let r=n[t];if(r.aliases.includes(e))return r}return null}var Oo={};Y(Oo,{cacheErrorUnknown:()=>Ka,cacheQuotaExceeded:()=>Fa});var Fa="cache_quota_exceeded",Ka="cache_error_unknown";var Je=class n extends Error{constructor(e,t){let r=t||Rn(e);super(r),Object.setPrototypeOf(this,n.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}};function Ir(n){return n instanceof Error?n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED"||n.message.includes("exceeded the quota")?new Je(Fa):new Je(n.name,n.message):new Je(Ka)}var ie={};Y(ie,{createAccountEntity:()=>Ba,createAccountEntityFromAccountInfo:()=>_m,generateAccountId:()=>wm,generateHomeAccountId:()=>za,getAccountInfo:()=>Sr,isAccountEntity:()=>km,isSingleTenant:()=>Sm});function wr(n,e){if(!n)throw p(aa);try{let t=e(n);return JSON.parse(t)}catch{throw p(Pn)}}function $e(n){if(!n)throw p(Pn);let e=n.split(fr,2);return{uid:e[0],utid:e.length<2?"":e[1]}}var me={Default:0,Adfs:1,Dsts:2,Ciam:3};function ct(n){return n&&(n.tid||n.tfp||n.acr)||null}var H={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};function wm(n){return[n.homeAccountId,n.environment].join(Ft).toLowerCase()}function Sr(n){let e=n.tenantProfiles||[];return e.length===0&&n.realm&&n.localAccountId&&e.push(ke(n.homeAccountId,n.localAccountId,n.realm)),{homeAccountId:n.homeAccountId,environment:n.environment,tenantId:n.realm,username:n.username,localAccountId:n.localAccountId,loginHint:n.loginHint,name:n.name,nativeAccountId:n.nativeAccountId,authorityType:n.authorityType,tenantProfiles:new Map(e.map(t=>[t.tenantId,t])),dataBoundary:n.dataBoundary}}function Sm(n){return!n.tenantProfiles}function Ba(n,e,t){let r;e.authorityType===me.Adfs?r=Xi:e.protocolMode===H.OIDC?r=En:r=Yi;let o,i;n.clientInfo&&t&&(o=wr(n.clientInfo,t),o.xms_tdbr&&(i=o.xms_tdbr==="EU"?"EU":"None"));let s=n.environment||e&&e.getPreferredCache();if(!s)throw p(po);let a=n.idTokenClaims?.preferred_username||n.idTokenClaims?.upn,c=n.idTokenClaims?.emails?n.idTokenClaims.emails[0]:null,l=a||c||"",d=n.idTokenClaims?.login_hint,u=o?.utid||ct(n.idTokenClaims)||"",g=o?.uid||n.idTokenClaims?.oid||n.idTokenClaims?.sub||"",E;return n.tenantProfiles?E=n.tenantProfiles:E=[ke(n.homeAccountId,g,u,n.idTokenClaims)],{homeAccountId:n.homeAccountId,environment:s,realm:u,localAccountId:g,username:l,authorityType:r,loginHint:d,clientInfo:n.clientInfo,name:n.idTokenClaims?.name||"",lastModificationTime:void 0,lastModificationApp:void 0,cloudGraphHostName:n.cloudGraphHostName,msGraphHost:n.msGraphHost,nativeAccountId:n.nativeAccountId,tenantProfiles:E,dataBoundary:i}}function _m(n,e,t){let r=Array.from(n.tenantProfiles?.values()||[]);return r.length===0&&n.tenantId&&n.localAccountId&&r.push(ke(n.homeAccountId,n.localAccountId,n.tenantId,n.idTokenClaims)),{authorityType:n.authorityType||En,homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,nativeAccountId:n.nativeAccountId,realm:n.tenantId,environment:n.environment,username:n.username,loginHint:n.loginHint,name:n.name,cloudGraphHostName:e,msGraphHost:t,tenantProfiles:r,dataBoundary:n.dataBoundary}}function za(n,e,t,r,o,i){if(!(e===me.Adfs||e===me.Dsts)){if(n)try{let s=wr(n,r.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}t.warning("1ub6wv",o)}return i?.sub||""}function km(n){return n?n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("realm")&&n.hasOwnProperty("localAccountId")&&n.hasOwnProperty("username")&&n.hasOwnProperty("authorityType"):!1}var Qt=class{constructor(e,t,r,o,i){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(kt,We),this.staticAuthorityOptions=i,this.performanceClient=o}getAllAccounts(e={},t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){let r=this.getAllAccounts(e,t);return r.length>1?r.sort(i=>i.idTokenClaims?-1:1)[0]:r.length===1?r[0]:null}getBaseAccountInfo(e,t){let r=this.getAccountsFilteredBy(e,t);return r.length>0?Sr(r[0]):null}buildTenantProfiles(e,t,r){return e.flatMap(o=>this.getTenantProfilesFromAccountEntity(o,t,r?.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,o,i){let s=null,a;if(i&&!this.tenantProfileMatchesFilter(r,i))return null;let c=this.getIdToken(e,o,t,r.tenantId);return c&&(a=at(c.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,i))?null:(s=$t(e,r,a,c?.secret),s)}getTenantProfilesFromAccountEntity(e,t,r,o){let i=Sr(e),s=i.tenantProfiles||new Map,a=this.getTokenKeys();if(r){let l=s.get(r);if(l)s=new Map([[r,l]]);else return[]}let c=[];return s.forEach(l=>{let d=this.getTenantedAccountInfoByFilter(i,a,l,t,o);d&&c.push(d)}),c}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}saveCacheRecord(e,t,r,o,i){return h(this,null,function*(){if(!e)throw p(ya);try{e.account&&(yield this.setAccount(e.account,t,r,o)),e.idToken&&i?.idToken!==!1&&(yield this.setIdTokenCredential(e.idToken,t,r)),e.accessToken&&i?.accessToken!==!1&&(yield this.saveAccessToken(e.accessToken,t,r)),e.refreshToken&&i?.refreshToken!==!1&&(yield this.setRefreshTokenCredential(e.refreshToken,t,r)),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(s){throw this.commonLogger?.error("0j476p",t),s instanceof w?s:Ir(s)}})}saveAccessToken(e,t,r){return h(this,null,function*(){let o={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType},i=this.getTokenKeys(),s=G.fromString(e.target);i.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,o,!1))return;let c=this.getAccessTokenCredential(a,t);c&&this.credentialMatchesFilter(c,o,t)&&G.fromString(c.target).intersectingScopeSets(s)&&this.removeAccessToken(a,t)}),yield this.setAccessTokenCredential(e,t,r)})}getAccountsFilteredBy(e,t){let r=this.getAccountKeys(),o=[];return r.forEach(i=>{let s=this.getAccount(i,t);if(!s||e.homeAccountId&&!this.matchHomeAccountId(s,e.homeAccountId)||e.username&&!this.matchUsername(s.username,e.username)||e.environment&&!this.matchEnvironment(s,e.environment,t)||e.realm&&!this.matchRealm(s,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(s,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(s,e.authorityType))return;let a={localAccountId:e?.localAccountId,name:e?.name},c=s.tenantProfiles?.filter(l=>this.tenantProfileMatchesFilter(l,a));c&&c.length===0||o.push(s)}),o}credentialMatchesFilter(e,t,r){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment,r)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||e.credentialType===ne.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===z.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e,t){let r=this.getKeys(),o={};return r.forEach(i=>{if(!this.isAppMetadata(i))return;let s=this.getAppMetadata(i,t);s&&(e.environment&&!this.matchEnvironment(s,e.environment,t)||e.clientId&&!this.matchClientId(s,e.clientId)||(o[i]=s))}),o}getAuthorityMetadataByAlias(e,t){let r=this.getAuthorityMetadataKeys(),o=null;return r.forEach(i=>{if(!this.isAuthorityMetadata(i)||i.indexOf(this.clientId)===-1)return;let s=this.getAuthorityMetadata(i,t);s&&s.aliases.indexOf(e)!==-1&&(o=s)}),o}removeAllAccounts(e){this.getAllAccounts({},e).forEach(r=>{this.removeAccount(r,e)})}removeAccount(e,t){this.removeAccountContext(e,t);let r=this.getAccountKeys(),o=i=>i.includes(e.homeAccountId)&&i.includes(e.environment);r.filter(o).forEach(i=>{this.removeItem(i,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){let r=this.getTokenKeys(),o=i=>i.includes(e.homeAccountId)&&i.includes(e.environment);r.idToken.filter(o).forEach(i=>{this.removeIdToken(i,t)}),r.accessToken.filter(o).forEach(i=>{this.removeAccessToken(i,t)}),r.refreshToken.filter(o).forEach(i=>{this.removeRefreshToken(i,t)})}removeAccessToken(e,t){let r=this.getAccessTokenCredential(e,t);if(r&&(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),r.credentialType.toLowerCase()===ne.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===z.POP)){let i=r.keyId;i&&this.cryptoImpl.removeTokenBindingKey(i,t).catch(()=>{this.commonLogger.error("0cx291",t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}}removeAppMetadata(e){return this.getKeys().forEach(r=>{this.isAppMetadata(r)&&this.removeItem(r,e)}),!0}getIdToken(e,t,r,o){this.commonLogger.trace("1drz22",t);let i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ne.ID_TOKEN,clientId:this.clientId,realm:o},s=this.getIdTokensByFilter(i,t,r),a=s.size;if(a<1)return this.commonLogger.info("1atvtd",t),null;if(a>1){let c=s;if(!o){let l=new Map;s.forEach((u,g)=>{u.realm===e.tenantId&&l.set(g,u)});let d=l.size;if(d<1)return this.commonLogger.info("0ooalx",t),s.values().next().value;if(d===1)return this.commonLogger.info("1eq2vc",t),l.values().next().value;c=l}return this.commonLogger.info("1ws328",t),c.forEach((l,d)=>{this.removeIdToken(d,t)}),this.performanceClient.addFields({multiMatchedID:s.size},t),null}return this.commonLogger.info("1sm769",t),s.values().next().value}getIdTokensByFilter(e,t,r){let o=r&&r.idToken||this.getTokenKeys().idToken,i=new Map;return o.forEach(s=>{if(!this.idTokenKeyMatchesFilter(s,f({clientId:this.clientId},e)))return;let a=this.getIdTokenCredential(s,t);a&&this.credentialMatchesFilter(a,e,t)&&i.set(s,a)}),i}idTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,o){let i=t.correlationId;this.commonLogger.trace("1t7hz1",i);let s=G.createSearchScopes(t.scopes),a=t.authenticationScheme||z.BEARER,c=a&&a.toLowerCase()!==z.BEARER.toLowerCase()?ne.ACCESS_TOKEN_WITH_AUTH_SCHEME:ne.ACCESS_TOKEN,l={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:o||e.tenantId,target:s,tokenType:a,keyId:t.sshKid},d=r&&r.accessToken||this.getTokenKeys().accessToken,u=[];d.forEach(E=>{if(this.accessTokenKeyMatchesFilter(E,l,!0)){let S=this.getAccessTokenCredential(E,i);S&&this.credentialMatchesFilter(S,l,i)&&u.push(S)}});let g=u.length;return g<1?(this.commonLogger.info("1nckna",i),null):g>1?(this.commonLogger.info("1wkfwp",i),u.forEach(E=>{this.removeAccessToken(this.generateCredentialKey(E),i)}),this.performanceClient.addFields({multiMatchedAT:u.length},i),null):(this.commonLogger.info("06yt98",i),u[0])}accessTokenKeyMatchesFilter(e,t,r){let o=e.toLowerCase();if(t.clientId&&o.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&o.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&o.indexOf(t.realm.toLowerCase())===-1)return!1;if(t.target){let i=t.target.asArray();for(let s=0;s<i.length;s++){if(r&&!o.includes(i[s].toLowerCase()))return!1;if(!r&&o.includes(i[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){let r=this.getTokenKeys(),o=[];return r.accessToken.forEach(i=>{if(!this.accessTokenKeyMatchesFilter(i,e,!0))return;let s=this.getAccessTokenCredential(i,t);s&&this.credentialMatchesFilter(s,e,t)&&o.push(s)}),o}getRefreshToken(e,t,r,o){this.commonLogger.trace("0x53vi",r);let i=t?Kt:void 0,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ne.REFRESH_TOKEN,clientId:this.clientId,familyId:i},a=o&&o.refreshToken||this.getTokenKeys().refreshToken,c=[];a.forEach(d=>{if(this.refreshTokenKeyMatchesFilter(d,s)){let u=this.getRefreshTokenCredential(d,r);u&&this.credentialMatchesFilter(u,s,r)&&c.push(u)}});let l=c.length;return l<1?(this.commonLogger.info("0dlw11",r),null):(l>1&&this.performanceClient.addFields({multiMatchedRT:l},r),this.commonLogger.info("0wcnep",r),c[0])}refreshTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e,t){let r={environment:e,clientId:this.clientId},o=this.getAppMetadataFilteredBy(r,t),i=Object.keys(o).map(a=>o[a]),s=i.length;if(s<1)return null;if(s>1)throw p(fa);return i[0]}isAppMetadataFOCI(e,t){let r=this.readAppMetadataFromCache(e,t);return!!(r&&r.familyId===Kt)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){let r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&typeof e=="string"&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t,r){if(this.staticAuthorityOptions){let i=jl(this.staticAuthorityOptions,this.commonLogger,r);if(i.includes(t)&&i.includes(e.environment))return!0}let o=this.getAuthorityMetadataByAlias(t,r);return!!(o&&o.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==ne.ACCESS_TOKEN&&e.credentialType!==ne.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:G.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(gr)!==-1}isAuthorityMetadata(e){return e.indexOf(Cr)!==-1}generateAuthorityMetadataCacheKey(e){return`${Cr}-${this.clientId}-${e}`}static toObject(e,t){for(let r in t)e[r]=t[r];return e}},Po=class extends Qt{setAccount(){return h(this,null,function*(){throw p(R)})}getAccount(){throw p(R)}setIdTokenCredential(){return h(this,null,function*(){throw p(R)})}getIdTokenCredential(){throw p(R)}setAccessTokenCredential(){return h(this,null,function*(){throw p(R)})}getAccessTokenCredential(){throw p(R)}setRefreshTokenCredential(){return h(this,null,function*(){throw p(R)})}getRefreshTokenCredential(){throw p(R)}setAppMetadata(){throw p(R)}getAppMetadata(){throw p(R)}setServerTelemetry(){throw p(R)}getServerTelemetry(){throw p(R)}setAuthorityMetadata(){throw p(R)}getAuthorityMetadata(){throw p(R)}getAuthorityMetadataKeys(){throw p(R)}setThrottlingCache(){throw p(R)}getThrottlingCache(){throw p(R)}removeItem(){throw p(R)}getKeys(){throw p(R)}getAccountKeys(){throw p(R)}getTokenKeys(){throw p(R)}generateCredentialKey(){throw p(R)}generateAccountKey(){throw p(R)}};var No={NotStarted:0,InProgress:1,Completed:2},Wl=new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT","unencryptedCacheCount","encryptedCacheExpiredCount","oldAccountCount","oldAccessCount","oldIdCount","oldRefreshCount","currAccountCount","currAccessCount","currIdCount","currRefreshCount","expiredCacheRemovedCount","upgradedCacheCount"]);var Ce=class{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:No.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""}}}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}};var Ln={tokenRenewalOffsetSeconds:us,preventCorsPreflight:!1},Rm={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:M.Info,correlationId:""},vm={sendGetRequestAsync(){return h(this,null,function*(){throw p(R)})},sendPostRequestAsync(){return h(this,null,function*(){throw p(R)})}},bm={sku:Mi,version:We,cpu:"",os:""},Om={clientSecret:"",clientAssertion:void 0},Pm={azureCloudInstance:Rt.None,tenant:`${to}`},Nm={application:{appName:"",appVersion:""}};function _r({authOptions:n,systemOptions:e,loggerOptions:t,storageInterface:r,networkInterface:o,cryptoInterface:i,clientCredentials:s,libraryInfo:a,telemetry:c,serverTelemetryManager:l,persistencePlugin:d,serializableCache:u}){let g=f(f({},Rm),t);return{authOptions:Mm(n),systemOptions:f(f({},Ln),e),loggerOptions:g,storageInterface:r||new Po(n.clientId,qe,new U(g),new Ce),networkInterface:o||vm,cryptoInterface:i||qe,clientCredentials:s||Om,libraryInfo:f(f({},bm),a),telemetry:f(f({},Nm),c),serverTelemetryManager:l||null,persistencePlugin:d||null,serializableCache:u||null}}function Mm(n){return f({clientCapabilities:[],azureCloudOptions:Pm,instanceAware:!1},n)}function Hn(n){return n.authOptions.authority.options.protocolMode===H.OIDC}var le=class n extends w{constructor(e,t,r,o,i){super(e,t,r),this.name="ServerError",this.errorNo=o,this.status=i,Object.setPrototypeOf(this,n.prototype)}};var Qe={};Y(Qe,{badToken:()=>Mo,consentRequired:()=>qa,interactionRequired:()=>ja,loginRequired:()=>Wa,nativeAccountUnavailable:()=>xm,noTokensFound:()=>Fn,refreshTokenExpired:()=>Ga,uxNotAllowed:()=>Va});var Fn="no_tokens_found",xm="native_account_unavailable",Ga="refresh_token_expired",Va="ux_not_allowed",ja="interaction_required",qa="consent_required",Wa="login_required",Mo="bad_token";var Jl=[ja,qa,Wa,Mo,Va],Um=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token","ux_not_allowed"],J=class n extends w{constructor(e,t,r,o,i,s,a,c){super(e,t,r),Object.setPrototypeOf(this,n.prototype),this.timestamp=o||"",this.traceId=i||"",this.correlationId=s||"",this.claims=a||"",this.name="InteractionRequiredAuthError",this.errorNo=c}};function Kn(n,e,t){let r=!!n&&Jl.indexOf(n)>-1,o=!!t&&Um.indexOf(t)>-1,i=!!e&&Jl.some(s=>e.indexOf(s)>-1);return r||i||o}function Yt(n,e){return new J(n,e)}var Me={};Y(Me,{generateLibraryState:()=>$l,parseRequestState:()=>Ja,setRequestState:()=>Dm});function Dm(n,e,t){let r=$l(n,t);return e?`${r}${ro}${e}`:r}function $l(n,e){if(!n)throw p(Un);let t={id:n.createNewGuid()};e&&(t.meta=e);let r=JSON.stringify(t);return n.base64Encode(r)}function Ja(n,e){if(!n)throw p(Un);if(!e)throw p(Bt);try{let t=e.split(ro),r=t[0],o=t.length>1?t.slice(1).join(ro):"",i=n(r),s=JSON.parse(i);return{userRequestState:o||"",libraryState:s}}catch{throw p(Bt)}}var P={};Y(P,{delay:()=>Fm,isCacheExpired:()=>Hm,isTokenExpired:()=>kr,nowSeconds:()=>Te,toDateFromSeconds:()=>xo,toSecondsFromDate:()=>Lm,wasClockTurnedBack:()=>$a});function Te(){return Math.round(new Date().getTime()/1e3)}function Lm(n){return n.getTime()/1e3}function xo(n){return n?new Date(Number(n)*1e3):new Date}function kr(n,e){let t=Number(n)||0;return Te()+e>t}function Hm(n,e){let t=Number(n)+e*24*60*60*1e3;return Date.now()>t}function $a(n){return Number(n)>Te()}function Fm(n,e){return new Promise(t=>setTimeout(()=>t(e),n))}var se={};Y(se,{AuthClientCreateTokenRequestBody:()=>nc,AuthClientExecuteTokenRequest:()=>oc,AuthorityGetCloudDiscoveryMetadataFromNetwork:()=>ac,AuthorityGetEndpointMetadataFromNetwork:()=>lc,AuthorityResolveEndpointsAsync:()=>sc,AuthorityUpdateCloudDiscoveryMetadata:()=>cc,AuthorityUpdateEndpointMetadata:()=>hc,AuthorityUpdateMetadataWithRegionalInformation:()=>Bn,AuthorizationCodeClientExecutePostToTokenEndpoint:()=>Xa,CacheManagerGetRefreshToken:()=>mc,GetAuthCodeUrl:()=>Km,HandleCodeResponseFromServer:()=>Bm,HandleServerTokenResponse:()=>Do,NetworkClientSendPostRequestAsync:()=>Qa,PopTokenGenerateCnf:()=>Xt,RefreshTokenClientAcquireToken:()=>ec,RefreshTokenClientAcquireTokenWithCachedRefreshToken:()=>Uo,RefreshTokenClientCreateTokenRequestBody:()=>tc,RefreshTokenClientExecutePostToTokenEndpoint:()=>Ya,RefreshTokenClientExecuteTokenRequest:()=>Za,RegionDiscoveryDetectRegion:()=>dc,RegionDiscoveryGetCurrentVersion:()=>uc,RegionDiscoveryGetRegionFromIMDS:()=>zn,SetUserData:()=>zm,SilentFlowClientGenerateResultFromCacheRecord:()=>rc,UpdateTokenEndpointAuthority:()=>ic});var Qa="networkClientSendPostRequestAsync",Ya="refreshTokenClientExecutePostToTokenEndpoint",Xa="authorizationCodeClientExecutePostToTokenEndpoint",Za="refreshTokenClientExecuteTokenRequest",ec="refreshTokenClientAcquireToken",Uo="refreshTokenClientAcquireTokenWithCachedRefreshToken",tc="refreshTokenClientCreateTokenRequestBody",rc="silentFlowClientGenerateResultFromCacheRecord",Km="getAuthCodeUrl",Bm="handleCodeResponseFromServer",oc="authClientExecuteTokenRequest",nc="authClientCreateTokenRequestBody",ic="updateTokenEndpointAuthority",Xt="popTokenGenerateCnf",Do="handleServerTokenResponse",sc="authorityResolveEndpointsAsync",ac="authorityGetCloudDiscoveryMetadataFromNetwork",cc="authorityUpdateCloudDiscoveryMetadata",lc="authorityGetEndpointMetadataFromNetwork",hc="authorityUpdateEndpointMetadata",Bn="authorityUpdateMetadataWithRegionalInformation",dc="regionDiscoveryDetectRegion",zn="regionDiscoveryGetRegionFromIMDS",uc="regionDiscoveryGetCurrentVersion",mc="cacheManagerGetRefreshToken",zm="setUserData";var te=(n,e,t,r,o)=>(...i)=>{t.trace("1plfzx",o);let s=r.startMeasurement(e,o);if(o){let a=e+"CallCount";r.incrementFields({[a]:1},o)}try{let a=n(...i);return s.end({success:!0}),t.trace("1g8n6a",o),a}catch(a){t.trace("0cfd8i",o);try{t.trace(JSON.stringify(a),o)}catch{t.trace("00dty7",o)}throw s.end({success:!1},a),a}},m=(n,e,t,r,o)=>(...i)=>{t.trace("1plfzx",o);let s=r.startMeasurement(e,o);if(o){let a=e+"CallCount";r.incrementFields({[a]:1},o)}return n(...i).then(a=>(t.trace("1g8n6a",o),s.end({success:!0}),a)).catch(a=>{t.trace("0cfd8i",o);try{t.trace(JSON.stringify(a),o)}catch{t.trace("00dty7",o)}throw s.end({success:!1},a),a})};var Gm={SW:"sw"},de=class{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){return h(this,null,function*(){let r=yield m(this.generateKid.bind(this),Xt,t,this.performanceClient,e.correlationId)(e),o=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:o}})}generateKid(e){return h(this,null,function*(){return{kid:yield this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:Gm.SW}})}signPopToken(e,t,r){return h(this,null,function*(){return this.signPayload(e,t,r)})}signPayload(e,t,r,o){return h(this,null,function*(){let{resourceRequestMethod:i,resourceRequestUri:s,shrClaims:a,shrNonce:c,shrOptions:l}=r,u=(s?new b(s):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt(f({at:e,ts:Te(),m:i?.toUpperCase(),u:u?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:u?.AbsolutePath,q:u?.QueryString?[[],u.QueryString]:void 0,client_claims:a||void 0},o),t,l,r.correlationId)})}};var Gn=class{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}};var V={};Y(V,{createAccessTokenEntity:()=>fc,createIdTokenEntity:()=>pc,createRefreshTokenEntity:()=>gc,generateAppMetadataKey:()=>$m,generateAuthorityMetadataExpiresAt:()=>jn,isAccessTokenEntity:()=>Vm,isAppMetadataEntity:()=>Qm,isAuthorityMetadataEntity:()=>Ym,isAuthorityMetadataExpired:()=>qn,isCredentialEntity:()=>Vn,isIdTokenEntity:()=>jm,isRefreshTokenEntity:()=>qm,isServerTelemetryEntity:()=>Wm,isThrottlingEntity:()=>Jm,updateAuthorityEndpointMetadata:()=>Rr,updateCloudDiscoveryMetadata:()=>Lo});function pc(n,e,t,r,o){return{credentialType:ne.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:o,lastUpdatedAt:Date.now().toString()}}function fc(n,e,t,r,o,i,s,a,c,l,d,u,g){let E={homeAccountId:n,credentialType:ne.ACCESS_TOKEN,secret:t,cachedAt:Te().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:r,realm:o,target:i,tokenType:d||z.BEARER,lastUpdatedAt:Date.now().toString()};if(u&&(E.userAssertionHash=u),l&&(E.refreshOn=l.toString()),E.tokenType?.toLowerCase()!==z.BEARER.toLowerCase())switch(E.credentialType=ne.ACCESS_TOKEN_WITH_AUTH_SCHEME,E.tokenType){case z.POP:let S=at(t,c);if(!S?.cnf?.kid)throw p(Aa);E.keyId=S.cnf.kid;break;case z.SSH:E.keyId=g}return E}function gc(n,e,t,r,o,i,s){let a={credentialType:ne.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,lastUpdatedAt:Date.now().toString()};return i&&(a.userAssertionHash=i),o&&(a.familyId=o),s&&(a.expiresOn=s.toString()),a}function Vn(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function Vm(n){return n?Vn(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===ne.ACCESS_TOKEN||n.credentialType===ne.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function jm(n){return n?Vn(n)&&n.hasOwnProperty("realm")&&n.credentialType===ne.ID_TOKEN:!1}function qm(n){return n?Vn(n)&&n.credentialType===ne.REFRESH_TOKEN:!1}function Wm(n,e){let t=n.indexOf(io)===0,r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function Jm(n,e){let t=!1;n&&(t=n.indexOf(so)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function $m({environment:n,clientId:e}){return[gr,n,e].join(Ft).toLowerCase()}function Qm(n,e){return e?n.indexOf(gr)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function Ym(n,e){return e?n.indexOf(Cr)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function jn(){return Te()+es}function Rr(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function Lo(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function qn(n){return n.expiresAt<=Te()}var xe=class n{constructor(e,t,r,o,i,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=o,this.performanceClient=i,this.serializableCache=s,this.persistencePlugin=a}validateTokenResponse(e,t,r){if(e.error||e.error_description||e.suberror){let o=`Error(s): ${e.error_codes||Ht} - Timestamp: ${e.timestamp||Ht} - Description: ${e.error_description||Ht} - Correlation ID: ${e.correlation_id||Ht} - Trace ID: ${e.trace_id||Ht}`,i=e.error_codes?.length?e.error_codes[0]:void 0,s=new le(e.error,o,e.suberror,i,e.status);if(r&&e.status&&e.status>=Ji&&e.status<=$i){this.logger.warning("16ks7j",t);return}else if(r&&e.status&&e.status>=qi&&e.status<=Wi){this.logger.warning("0g61x3",t);return}throw Kn(e.error,e.error_description,e.suberror)?new J(e.error,e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",i):s}}handleServerTokenResponse(e,t,r,o,i,s,a,c,l,d){return h(this,null,function*(){let u;if(e.id_token){if(u=at(e.id_token||"",this.cryptoObj.base64Decode),s&&s.nonce&&u.nonce!==s.nonce)throw p(ma);if(o.maxAge||o.maxAge===0){let _=u.auth_time;if(!_)throw p(uo);vo(_,o.maxAge)}}this.homeAccountIdentifier=za(e.client_info||"",t.authorityType,this.logger,this.cryptoObj,o.correlationId,u);let g;s&&s.state&&(g=Ja(this.cryptoObj.base64Decode,s.state)),e.key_id=e.key_id||o.sshKid||void 0;let E=this.generateCacheRecord(e,t,r,o,u,a,s),S;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("0jbz5k",o.correlationId),S=new Gn(this.serializableCache,!0),yield this.persistencePlugin.beforeCacheAccess(S)),c&&!l&&E.account&&this.cacheStorage.getAllAccounts({homeAccountId:E.account.homeAccountId,environment:E.account.environment},o.correlationId).length<1)return this.logger.warning("1gmt66",o.correlationId),this.performanceClient?.addFields({acntLoggedOut:!0},o.correlationId),yield n.generateAuthenticationResult(this.cryptoObj,t,E,!1,o,this.performanceClient,u,g,void 0,d);yield this.cacheStorage.saveCacheRecord(E,o.correlationId,Ua(u||{}),i,o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&S&&(this.logger.verbose("1bh17u",o.correlationId),yield this.persistencePlugin.afterCacheAccess(S))}return n.generateAuthenticationResult(this.cryptoObj,t,E,!1,o,this.performanceClient,u,g,e,d)})}generateCacheRecord(e,t,r,o,i,s,a){let c=t.getPreferredCache();if(!c)throw p(po);let l=ct(i),d,u;e.id_token&&i&&(d=pc(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),u=vr(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,o.correlationId,i,e.client_info,c,l,a,void 0,this.logger));let g=null;if(e.access_token){let _=e.scope?G.fromString(e.scope):new G(o.scopes||[]),B=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,oe=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,L=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,ae=r+B,ce=ae+oe,At=L&&L>0?r+L:void 0;g=fc(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",_.printScopes(),ae,ce,this.cryptoObj.base64Decode,At,e.token_type,s,e.key_id)}let E=null;if(e.refresh_token){let _;if(e.refresh_token_expires_in){let B=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;_=r+B,this.performanceClient?.addFields({ntwkRtExpiresOnSeconds:_},o.correlationId)}E=gc(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,_)}let S=null;return e.foci&&(S={clientId:this.clientId,environment:c,familyId:e.foci}),{account:u,idToken:d,accessToken:g,refreshToken:E,appMetadata:S}}static generateAuthenticationResult(e,t,r,o,i,s,a,c,l,d){return h(this,null,function*(){let u="",g=[],E=null,S,_,B="";if(r.accessToken){if(r.accessToken.tokenType===z.POP&&!i.popKid){let ce=new de(e,s),{secret:At,keyId:Tt}=r.accessToken;if(!Tt)throw p(wa);u=yield ce.signPopToken(At,Tt,i)}else u=r.accessToken.secret;g=G.fromString(r.accessToken.target).asArray(),E=xo(r.accessToken.expiresOn),S=xo(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(_=xo(r.accessToken.refreshOn))}r.appMetadata&&(B=r.appMetadata.familyId===Kt?Kt:"");let oe=a?.oid||a?.sub||"",L=a?.tid||"";l?.spa_accountid&&r.account&&(r.account.nativeAccountId=l?.spa_accountid);let ae=r.account?$t(Sr(r.account),void 0,a,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:oe,tenantId:L,scopes:g,account:ae,idToken:r?.idToken?.secret||"",idTokenClaims:a||{},accessToken:u,fromCache:o,expiresOn:E,extExpiresOn:S,refreshOn:_,correlationId:i.correlationId,requestId:d||"",familyId:B,tokenType:r.accessToken?.tokenType||"",state:c?c.userRequestState:"",cloudGraphHostName:r.account?.cloudGraphHostName||"",msGraphHost:r.account?.msGraphHost||"",code:l?.spa_code,fromPlatformBroker:!1}})}};function vr(n,e,t,r,o,i,s,a,c,l,d,u){u?.verbose("09jz0t",o);let E=n.getAccountKeys().find(L=>L.startsWith(t)),S=null;E&&(S=n.getAccount(E,o));let _=S||Ba({homeAccountId:t,idTokenClaims:i,clientInfo:s,environment:a,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:d},e,r),B=_.tenantProfiles||[],oe=c||_.realm;if(oe&&!B.find(L=>L.tenantId===oe)){let L=ke(t,_.localAccountId,oe,i);B.push(L)}return _.tenantProfiles=B,_}var ue={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};function Wn(n,e,t){return h(this,null,function*(){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})})}function lt(n,e,t){return{clientId:n,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||e.extraParameters?.clientId}}var ht=class n{static generateThrottlingStorageKey(e){return`${so}.${JSON.stringify(e)}`}static preProcess(e,t,r){let o=n.generateThrottlingStorageKey(t),i=e.getThrottlingCache(o,r);if(i){if(i.throttleTime<Date.now()){e.removeItem(o,r);return}throw new le(i.errorCodes?.join(" ")||"",i.errorMessage,i.subError)}}static postProcess(e,t,r,o){if(n.checkResponseStatus(r)||n.checkResponseForRetryAfter(r)){let i={throttleTime:n.calculateThrottleTime(parseInt(r.headers[F.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(n.generateThrottlingStorageKey(t),i,o)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(F.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){let t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||ss),r+as)*1e3)}static removeThrottle(e,t,r,o){let i=lt(t,r,o),s=this.generateThrottlingStorageKey(i);e.removeItem(s,r.correlationId)}};var br=class n extends w{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,n.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}};function Zt(n,e,t,r){return n.errorMessage=`${n.errorMessage}, additionalErrorInfo: error.name:${r?.name}, error.message:${r?.message}`,new br(n,e,t)}function Jn(n,e,t){let r={};if(r[F.CONTENT_TYPE]=Fi,!e&&t)switch(t.type){case ue.HOME_ACCOUNT_ID:try{let o=$e(t.credential);r[F.CCS_HEADER]=`Oid:${o.uid}@${o.utid}`}catch{n.verbose("1qhtee","")}break;case ue.UPN:r[F.CCS_HEADER]=`UPN: ${t.credential}`;break}return r}function $n(n,e,t,r){let o=new Map;return n.embeddedClientId&&it(o,e,t),n.extraQueryParameters&&nt(o,n.extraQueryParameters),Wt(o,n.correlationId),zt(o,n.correlationId,r),je(o)}function Qn(n,e,t,r,o,i,s,a,c,l){return h(this,null,function*(){let d=yield Xm(r,n,{body:e,headers:t},o,i,s,a,c);return l&&d.status<500&&d.status!==429&&l.clearTelemetryCache(),d})}function Xm(n,e,t,r,o,i,s,a){return h(this,null,function*(){ht.preProcess(o,n,r);let c;try{c=yield m(i.sendPostRequestAsync.bind(i),Qa,s,a,r)(e,t);let l=c.headers||{};a?.addFields({refreshTokenSize:c.body.refresh_token?.length||0,httpVerToken:l[F.X_MS_HTTP_VERSION]||"",requestId:l[F.X_MS_REQUEST_ID]||""},r)}catch(l){if(l instanceof br){let d=l.responseHeaders;throw d&&a?.addFields({httpVerToken:d[F.X_MS_HTTP_VERSION]||"",requestId:d[F.X_MS_REQUEST_ID]||"",contentTypeHeader:d[F.CONTENT_TYPE]||void 0,contentLengthHeader:d[F.CONTENT_LENGTH]||void 0,httpStatus:l.httpStatus},r),l.error}throw l instanceof w?l:p(la)}return ht.postProcess(o,n,c,r),c})}var Or={};Y(Or,{createDiscoveredInstance:()=>Cc});function Ql(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}function Yl(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}function Xl(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}var Zl=(()=>{class n{constructor(t,r,o,i){this.networkInterface=t,this.logger=r,this.performanceClient=o,this.correlationId=i}detectRegion(t,r){return h(this,null,function*(){let o=t;if(o)r.region_source=St.ENVIRONMENT_VARIABLE;else{let i=n.IMDS_OPTIONS;try{let s=yield m(this.getRegionFromIMDS.bind(this),zn,this.logger,this.performanceClient,this.correlationId)(Ki,i);if(s.status===fn&&(o=s.body,r.region_source=St.IMDS),s.status===gn){let a=yield m(this.getCurrentVersion.bind(this),uc,this.logger,this.performanceClient,this.correlationId)(i);if(!a)return r.region_source=St.FAILED_AUTO_DETECTION,null;let c=yield m(this.getRegionFromIMDS.bind(this),zn,this.logger,this.performanceClient,this.correlationId)(a,i);c.status===fn&&(o=c.body,r.region_source=St.IMDS)}}catch{return r.region_source=St.FAILED_AUTO_DETECTION,null}}return o||(r.region_source=St.FAILED_AUTO_DETECTION),o||null})}getRegionFromIMDS(t,r){return h(this,null,function*(){return this.networkInterface.sendGetRequestAsync(`${pn}?api-version=${t}&format=text`,r,Bi)})}getCurrentVersion(t){return h(this,null,function*(){try{let r=yield this.networkInterface.sendGetRequestAsync(`${pn}?format=json`,t);return r.status===gn&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}})}}return n.IMDS_OPTIONS={headers:{Metadata:"true"}},n})();var Ue=class n{constructor(e,t,r,o,i,s,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=o,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=a,this.correlationId=s,this.managedIdentity=c||!1,this.regionDiscovery=new Zl(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(un))return me.Ciam;let t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case Ui:return me.Adfs;case Di:return me.Dsts}return me.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new b(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw p(Ne)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw p(Ne)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw p(Ne)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw p(Ia);return this.replacePath(this.metadata.end_session_endpoint)}else throw p(Ne)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw p(Ne)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw p(Ne)}canReplaceTenant(e){return e.PathSegments.length===1&&!n.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===me.Default&&this.protocolMode!==H.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e,o=new b(this.metadata.canonical_authority).getUrlComponents(),i=o.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let l=i[c];if(c===0&&this.canReplaceTenant(o)){let d=new b(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==d&&(this.logger.verbose("1q3g2x",this.correlationId),l=d)}a!==l&&(t=t.replace(`/${l}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){let e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===me.Adfs||this.protocolMode===H.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){return h(this,null,function*(){let e=this.getCurrentMetadataEntity(),t=yield m(this.updateCloudDiscoveryMetadata.bind(this),cc,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);let r=yield m(this.updateEndpointMetadata.bind(this),hc,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)})}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort,this.correlationId);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:jn(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==Ae.CACHE&&r?.source!==Ae.CACHE&&(e.expiresAt=jn(),e.canonical_authority=this.canonicalAuthority);let o=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache,this.correlationId);this.cacheManager.setAuthorityMetadata(o,e,this.correlationId),this.metadata=e}updateEndpointMetadata(e){return h(this,null,function*(){let t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Ae.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){let o=yield m(this.updateMetadataWithRegionalInformation.bind(this),Bn,this.logger,this.performanceClient,this.correlationId)(t.metadata);Rr(e,o,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=yield m(this.getEndpointMetadataFromNetwork.bind(this),lc,this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=yield m(this.updateMetadataWithRegionalInformation.bind(this),Bn,this.logger,this.performanceClient,this.correlationId)(r)),Rr(e,r,!0),Ae.NETWORK;throw p(ha,this.defaultOpenIdConfigurationEndpoint)})}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("1fi0kc",this.correlationId);let t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("06t0uj",this.correlationId),Rr(e,t,!1),{source:Ae.CONFIG};this.logger.verbose("151k0p",this.correlationId);let r=this.getEndpointMetadataFromHardcodedValues();if(r)return Rr(e,r,!1),{source:Ae.HARDCODED_VALUES,metadata:r};this.logger.verbose("1imop5",this.correlationId);let o=qn(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!o?(this.logger.verbose("16uq31",""),{source:Ae.CACHE}):(o&&this.logger.verbose("0uoibc",""),null)}isAuthoritySameType(e){return new b(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw v(na)}return null}getEndpointMetadataFromNetwork(){return h(this,null,function*(){let e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("1y65x6",this.correlationId);try{let r=yield this.networkInterface.sendGetRequestAsync(t,e);return Ql(r.body)?r.body:(this.logger.verbose("1koyv8",this.correlationId),null)}catch{return this.logger.verbose("0a9wik",this.correlationId),null}})}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Da?Da[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){return h(this,null,function*(){let t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==zi)return this.regionDiscoveryMetadata.region_outcome=ao.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,n.replaceWithRegionalInformation(e,t);let r=yield m(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),dc,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome=ao.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,n.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome=ao.AUTO_DETECTION_REQUESTED_FAILED}return e})}updateCloudDiscoveryMetadata(e){return h(this,null,function*(){let t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;let r=yield m(this.getCloudDiscoveryMetadataFromNetwork.bind(this),ac,this.logger,this.performanceClient,this.correlationId)();if(r)return Lo(e,r,!0),Ae.NETWORK;throw v(ia)})}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("0jhlgt",this.correlationId),this.logger.verbosePii("1fy7uz",this.correlationId),this.logger.verbosePii("08zabj",this.correlationId),this.logger.verbosePii("1o1kv3",this.correlationId);let t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("1nakio",this.correlationId),Lo(e,t,!1),Ae.CONFIG;this.logger.verbose("1x74aj",this.correlationId);let r=ql(this.hostnameAndPort);if(r)return this.logger.verbose("0by47c",this.correlationId),Lo(e,r,!1),Ae.HARDCODED_VALUES;this.logger.verbose("0r2fzy",this.correlationId);let o=qn(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("1uffgh",""),Ae.CACHE):(o&&this.logger.verbose("0uoibc",""),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===me.Ciam)return this.logger.verbose("04y84h",this.correlationId),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("0gszr3",this.correlationId);try{this.logger.verbose("1iifkx",this.correlationId);let e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=bo(e.metadata,this.hostnameAndPort);if(this.logger.verbose("0q67e3",""),t)return this.logger.verbose("0hzfao",this.correlationId),t;this.logger.verbose("1ajz3u",this.correlationId)}catch{throw this.logger.verbose("1wq5tu",this.correlationId),v(bn)}}return this.isInKnownAuthorities()?(this.logger.verbose("0mt9al",this.correlationId),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){return h(this,null,function*(){let e=`${Li}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={},r=null;try{let o=yield this.networkInterface.sendGetRequestAsync(e,t),i,s;if(Yl(o.body))i=o.body,s=i.metadata,this.logger.verbosePii("1vglyt",this.correlationId);else if(Xl(o.body)){if(this.logger.warning("062uto",this.correlationId),i=o.body,i.error===ji)return this.logger.error("1x90tm",this.correlationId),null;this.logger.warning("0wchdm",this.correlationId),this.logger.warning("1s5mpv",this.correlationId),this.logger.warning("1yhqpw",this.correlationId),s=[]}else return this.logger.error("0768g0",this.correlationId),null;this.logger.verbose("1lrobr",this.correlationId),r=bo(s,this.hostnameAndPort)}catch(o){return o instanceof w?this.logger.error("0vwhc7",this.correlationId):this.logger.error("0s2z41",this.correlationId),null}return r||(this.logger.warning("0jp28q",this.correlationId),this.logger.verbose("130sd8",this.correlationId),r=n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r})}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&b.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Rt.None){let o=t.tenant?t.tenant:to;r=`${t.azureCloudInstance}/${o}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return xi;if(this.discoveryComplete())return this.metadata.preferred_cache;throw p(Ne)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Ha.has(e)}static isPublicCloudAuthority(e){return Vi.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){let o=new b(e);o.validateAsUri();let i=o.getUrlComponents(),s=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(s=`${t}.${Gi}`);let a=b.constructAuthorityUriFromObject(I(f({},o.getUrlComponents()),{HostNameAndPort:s})).urlString;return r?`${a}?${r}`:a}static replaceWithRegionalInformation(e,t){let r=f({},e);return r.authorization_endpoint=n.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=n.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=n.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e,o=new b(e).getUrlComponents();if(o.PathSegments.length===0&&o.HostNameAndPort.endsWith(un)){let i=o.HostNameAndPort.split(".")[0];t=`${t}${i}${Hi}`}return t}};Ue.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Oe.COMMON,Oe.CONSUMERS,Oe.ORGANIZATIONS]);function eh(n){let r=new b(n).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case Oe.COMMON:case Oe.ORGANIZATIONS:case Oe.CONSUMERS:return;default:return r}}function Yn(n){return n.endsWith(ur)?n:`${n}${ur}`}function er(n){let e=n.cloudDiscoveryMetadata,t;if(e)try{t=JSON.parse(e)}catch{throw v(bn)}return{canonicalAuthority:n.authority?Yn(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}function Cc(n,e,t,r,o,i,s){return h(this,null,function*(){let a=Ue.transformCIAMAuthority(Yn(n)),c=new Ue(a,e,t,r,o,i,s);try{return yield m(c.resolveEndpointsAsync.bind(c),sc,o,s,i)(),c}catch{throw p(Ne)}})}var tr=class{constructor(e,t){this.includeRedirectUri=!0,this.config=_r(e),this.logger=new U(this.config.loggerOptions,kt,We),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}acquireToken(e,t,r){return h(this,null,function*(){if(!e.code)throw p(ga);r&&r.cloud_instance_host_name&&(yield m(this.updateTokenEndpointAuthority.bind(this),ic,this.logger,this.performanceClient,e.correlationId)(r.cloud_instance_host_name,e.correlationId));let o=Te(),i=yield m(this.executeTokenRequest.bind(this),oc,this.logger,this.performanceClient,e.correlationId)(this.authority,e,this.serverTelemetryManager),s=i.headers?.[F.X_MS_REQUEST_ID],a=new xe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(i.body,e.correlationId),m(a.handleServerTokenResponse.bind(a),Do,this.logger,this.performanceClient,e.correlationId)(i.body,this.authority,o,e,t,r,void 0,void 0,void 0,s)})}getLogoutUri(e){if(!e)throw v(ra);let t=this.createLogoutUrlQueryString(e);return b.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t,r){return h(this,null,function*(){let o=$n(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),i=b.appendQueryString(e.tokenEndpoint,o),s=yield m(this.createTokenRequestBody.bind(this),nc,this.logger,this.performanceClient,t.correlationId)(t),a;if(t.clientInfo)try{let d=wr(t.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${d.uid}${fr}${d.utid}`,type:ue.HOME_ACCOUNT_ID}}catch{this.logger.verbose("0wznt3",t.correlationId)}let c=Jn(this.logger,this.config.systemOptions.preventCorsPreflight,a||t.ccsCredential),l=lt(this.config.authOptions.clientId,t);return m(Qn,Xa,this.logger,this.performanceClient,t.correlationId)(i,s,c,l,t.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,r)})}createTokenRequestBody(e){return h(this,null,function*(){let t=new Map;if(Vt(t,e.embeddedClientId||e.extraParameters?.[Ve]||this.config.authOptions.clientId),this.includeRedirectUri)jt(t,e.redirectUri);else if(!e.redirectUri)throw v(Ys);if(Gt(t,e.scopes,!0,this.oidcDefaultScopes),Oa(t,e.code),go(t,this.config.libraryInfo),Co(t,this.config.telemetry.application),Ro(t),this.serverTelemetryManager&&!Hn(this.config)&&ko(t,this.serverTelemetryManager),e.codeVerifier&&Na(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&yo(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let o=this.config.clientCredentials.clientAssertion;Ao(t,yield Wn(o.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),To(t,o.assertionType)}if(Io(t,no.AUTHORIZATION_CODE_GRANT),Jt(t),e.authenticationScheme===z.POP){let o=new de(this.cryptoUtils,this.performanceClient),i;e.popKid?i=this.cryptoUtils.encodeKid(e.popKid):i=(yield m(o.generateCnf.bind(o),Xt,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,So(t,i)}else if(e.authenticationScheme===z.SSH)if(e.sshJwk)_o(t,e.sshJwk);else throw v(ho);(!K.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&qt(t,e.claims,this.config.authOptions.clientCapabilities);let r;if(e.clientInfo)try{let o=wr(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${o.uid}${fr}${o.utid}`,type:ue.HOME_ACCOUNT_ID}}catch{this.logger.verbose("0wznt3",e.correlationId)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case ue.HOME_ACCOUNT_ID:try{let o=$e(r.credential);ot(t,o)}catch{this.logger.verbose("1qhtee",e.correlationId)}break;case ue.UPN:_t(t,r.credential);break}return e.embeddedClientId&&it(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&nt(t,e.extraParameters),e.enableSpaAuthorizationCode&&(!e.extraParameters||!e.extraParameters[_n])&&nt(t,{[_n]:"1"}),zt(t,e.correlationId,this.performanceClient),je(t)})}createLogoutUrlQueryString(e){let t=new Map;return e.postLogoutRedirectUri&&_a(t,e.postLogoutRedirectUri),e.correlationId&&Wt(t,e.correlationId),e.idTokenHint&&ka(t,e.idTokenHint),e.state&&Eo(t,e.state),e.logoutHint&&Ma(t,e.logoutHint),e.extraQueryParameters&&nt(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&wo(t),je(t)}updateTokenEndpointAuthority(e,t){return h(this,null,function*(){let r=`https://${e}/${this.authority.tenant}/`,o=yield Cc(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=o})}};var Zm=300,Ho=class{constructor(e,t){this.config=_r(e),this.logger=new U(this.config.loggerOptions,kt,We),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}acquireToken(e,t){return h(this,null,function*(){let r=Te(),o=yield m(this.executeTokenRequest.bind(this),Za,this.logger,this.performanceClient,e.correlationId)(e,this.authority),i=o.headers?.[F.X_MS_REQUEST_ID],s=new xe(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return s.validateTokenResponse(o.body,e.correlationId),m(s.handleServerTokenResponse.bind(s),Do,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,r,e,t,void 0,void 0,!0,e.forceCache,i)})}acquireTokenByRefreshToken(e,t){return h(this,null,function*(){if(!e)throw v(ta);if(!e.account)throw p(mo);if(this.cacheManager.isAppMetadataFOCI(e.account.environment,e.correlationId))try{return yield m(this.acquireTokenWithCachedRefreshToken.bind(this),Uo,this.logger,this.performanceClient,e.correlationId)(e,!0,t)}catch(o){let i=o instanceof J&&o.errorCode===Fn,s=o instanceof le&&o.errorCode===ls&&o.subError===hs;if(i||s)return m(this.acquireTokenWithCachedRefreshToken.bind(this),Uo,this.logger,this.performanceClient,e.correlationId)(e,!1,t);throw o}return m(this.acquireTokenWithCachedRefreshToken.bind(this),Uo,this.logger,this.performanceClient,e.correlationId)(e,!1,t)})}acquireTokenWithCachedRefreshToken(e,t,r){return h(this,null,function*(){let o=te(this.cacheManager.getRefreshToken.bind(this.cacheManager),mc,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0);if(!o)throw Yt(Fn);if(o.expiresOn){let s=e.refreshTokenExpirationOffsetSeconds||Zm;if(this.performanceClient?.addFields({cacheRtExpiresOnSeconds:Number(o.expiresOn),rtOffsetSeconds:s},e.correlationId),kr(o.expiresOn,s))throw Yt(Ga)}let i=I(f({},e),{refreshToken:o.secret,authenticationScheme:e.authenticationScheme||z.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:ue.HOME_ACCOUNT_ID}});try{return yield m(this.acquireToken.bind(this),ec,this.logger,this.performanceClient,e.correlationId)(i,r)}catch(s){if(s instanceof J&&s.subError===Mo){this.logger.verbose("1pg3ap",e.correlationId);let a=this.cacheManager.generateCredentialKey(o);this.cacheManager.removeRefreshToken(a,e.correlationId)}throw s}})}executeTokenRequest(e,t){return h(this,null,function*(){let r=$n(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),o=b.appendQueryString(t.tokenEndpoint,r),i=yield m(this.createTokenRequestBody.bind(this),tc,this.logger,this.performanceClient,e.correlationId)(e),s=Jn(this.logger,this.config.systemOptions.preventCorsPreflight,e.ccsCredential),a=lt(this.config.authOptions.clientId,e);return m(Qn,Ya,this.logger,this.performanceClient,e.correlationId)(o,i,s,a,e.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,this.serverTelemetryManager)})}createTokenRequestBody(e){return h(this,null,function*(){let t=new Map;if(Vt(t,e.embeddedClientId||e.extraParameters?.[Ve]||this.config.authOptions.clientId),e.redirectUri&&jt(t,e.redirectUri),Gt(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),Io(t,no.REFRESH_TOKEN_GRANT),Jt(t),go(t,this.config.libraryInfo),Co(t,this.config.telemetry.application),Ro(t),this.serverTelemetryManager&&!Hn(this.config)&&ko(t,this.serverTelemetryManager),Pa(t,e.refreshToken),this.config.clientCredentials.clientSecret&&yo(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let r=this.config.clientCredentials.clientAssertion;Ao(t,yield Wn(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),To(t,r.assertionType)}if(e.authenticationScheme===z.POP){let r=new de(this.cryptoUtils,this.performanceClient),o;e.popKid?o=this.cryptoUtils.encodeKid(e.popKid):o=(yield m(r.generateCnf.bind(r),Xt,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,So(t,o)}else if(e.authenticationScheme===z.SSH)if(e.sshJwk)_o(t,e.sshJwk);else throw v(ho);if((!K.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&qt(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case ue.HOME_ACCOUNT_ID:try{let r=$e(e.ccsCredential.credential);ot(t,r)}catch{this.logger.verbose("1qhtee",e.correlationId)}break;case ue.UPN:_t(t,e.ccsCredential.credential);break}return e.embeddedClientId&&it(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&nt(t,f({},e.extraParameters)),zt(t,e.correlationId,this.performanceClient),je(t)})}};var Fo=class{constructor(e,t){this.config=_r(e),this.logger=new U(this.config.loggerOptions,kt,We),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}acquireCachedToken(e){return h(this,null,function*(){let t=Ge.NOT_APPLICABLE;if(e.forceRefresh||!K.isEmptyObj(e.claims))throw this.setCacheOutcome(Ge.FORCE_REFRESH_OR_CLAIMS,e.correlationId),p(fo);if(!e.account)throw p(mo);let r=e.account.tenantId||eh(e.authority),o=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,o,r);if(i){if($a(i.cachedAt)||kr(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(Ge.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),p(fo);i.refreshOn&&kr(i.refreshOn,0)&&(t=Ge.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(Ge.NO_CACHED_ACCESS_TOKEN,e.correlationId),p(fo);let s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,o,r),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s,e.correlationId)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[yield m(this.generateResultFromCacheRecord.bind(this),rc,this.logger,this.performanceClient,e.correlationId)(a,e),t]})}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==Ge.NOT_APPLICABLE&&this.logger.info("09ingz",t)}generateResultFromCacheRecord(e,t){return h(this,null,function*(){let r;if(e.idToken&&(r=at(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){let o=r?.auth_time;if(!o)throw p(uo);vo(o,t.maxAge)}return xe.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,this.performanceClient,r)})}};var Ec={sendGetRequestAsync:()=>Promise.reject(p(R)),sendPostRequestAsync:()=>Promise.reject(p(R))};var Ye={};Y(Ye,{getAuthorizationCodePayload:()=>rp,getAuthorizeUrl:()=>tp,getStandardAuthorizeRequestParameters:()=>ep,validateAuthorizationResponse:()=>th});function ep(n,e,t,r){let o=e.correlationId,i=new Map;Vt(i,e.embeddedClientId||e.extraQueryParameters?.[Ve]||n.clientId);let s=[...e.scopes||[],...e.extraScopesToConsent||[]];if(Gt(i,s,!0,n.authority.options.OIDCOptions?.defaultScopes),jt(i,e.redirectUri),Wt(i,o),Sa(i,e.responseMode),Jt(i),e.prompt&&(va(i,e.prompt),r?.addFields({prompt:e.prompt},o)),e.domainHint&&(Ra(i,e.domainHint),r?.addFields({domainHintFromRequest:!0},o)),e.prompt!==oo.SELECT_ACCOUNT)if(e.sid&&e.prompt===oo.NONE)t.verbose("1tvqyx",e.correlationId),Dn(i,e.sid),r?.addFields({sidFromRequest:!0},o);else if(e.account){let a=np(e.account),c=ip(e.account);if(c&&e.domainHint&&(t.warning("0wkg3v",e.correlationId),c=null),c){t.verbose("1eyfsw",e.correlationId),Tr(i,c),r?.addFields({loginHintFromClaim:!0},o);try{let l=$e(e.account.homeAccountId);ot(i,l)}catch{t.verbose("12ugck",e.correlationId)}}else if(a&&e.prompt===oo.NONE){t.verbose("1rmd8s",e.correlationId),Dn(i,a),r?.addFields({sidFromClaim:!0},o);try{let l=$e(e.account.homeAccountId);ot(i,l)}catch{t.verbose("12ugck",e.correlationId)}}else if(e.loginHint)t.verbose("0y3007",e.correlationId),Tr(i,e.loginHint),_t(i,e.loginHint),r?.addFields({loginHintFromRequest:!0},o);else if(e.account.username){t.verbose("02f507",e.correlationId),Tr(i,e.account.username),r?.addFields({loginHintFromUpn:!0},o);try{let l=$e(e.account.homeAccountId);ot(i,l)}catch{t.verbose("12ugck",e.correlationId)}}}else e.loginHint&&(t.verbose("0g01ey",e.correlationId),Tr(i,e.loginHint),_t(i,e.loginHint),r?.addFields({loginHintFromRequest:!0},o));else t.verbose("169k9v",e.correlationId);return e.nonce&&ba(i,e.nonce),e.state&&Eo(i,e.state),(e.claims||n.clientCapabilities&&n.clientCapabilities.length>0)&&qt(i,e.claims,n.clientCapabilities),e.embeddedClientId&&it(i,n.clientId,n.redirectUri),n.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(Er))&&wo(i),i}function tp(n,e){let t=je(e);return b.appendQueryString(n.authorizationEndpoint,t)}function rp(n,e){if(th(n,e),!n.code)throw p(Ta);return n}function th(n,e){if(!n.state||!e)throw n.state?p(Mn,"Cached State"):p(Mn,"Server State");let t,r;try{t=decodeURIComponent(n.state)}catch{throw p(Bt,n.state)}try{r=decodeURIComponent(e)}catch{throw p(Bt,n.state)}if(t!==r)throw p(ua);if(n.error||n.error_description||n.suberror){let o=op(n);throw Kn(n.error,n.error_description,n.suberror)?new J(n.error||"",n.error_description,n.suberror,n.timestamp||"",n.trace_id||"",n.correlation_id||"",n.claims||"",o):new le(n.error||"",n.error_description,n.suberror,o)}}function op(n){let e="code=",t=n.error_uri?.lastIndexOf(e);return t&&t>=0?n.error_uri?.substring(t+e.length):void 0}function np(n){return n.idTokenClaims?.sid||null}function ip(n){return n.loginHint||n.idTokenClaims?.login_hint||null}var Xn=class{constructor(e){this.headers=e}getShrNonce(){let e=this.headers[F.AuthenticationInfo];if(e){let r=this.parseChallenges(e);if(r.nextnonce)return r.nextnonce;throw v(On)}let t=this.headers[F.WWWAuthenticate];if(t){let r=this.parseChallenges(t);if(r.nonce)return r.nonce;throw v(On)}throw v(sa)}parseChallenges(e){let t=e.indexOf(" "),r=e.substr(t+1).split(","),o={};return r.forEach(i=>{let[s,a]=i.split("=");o[s]=unescape(a.replace(/['"]+/g,""))}),o}};var vt={};Y(vt,{postRequestFailed:()=>ap,unexpectedError:()=>sp});var sp="unexpected_error",ap="post_request_failed";var rh=",",oh="|";function cp(n){let{skus:e,libraryName:t,libraryVersion:r,extensionName:o,extensionVersion:i}=n,s=new Map([[0,[t,r]],[2,[o,i]]]),a=[];if(e?.length){if(a=e.split(rh),a.length<4)return e}else a=Array.from({length:4},()=>oh);return s.forEach((c,l)=>{c.length===2&&c[0]?.length&&c[1]?.length&&lp({skuArr:a,index:l,skuName:c[0],skuVersion:c[1]})}),a.join(rh)}function lp(n){let{skuArr:e,index:t,skuName:r,skuVersion:o}=n;t>=e.length||(e[t]=[r,o].join(oh))}var rr=class n{constructor(e,t){this.cacheOutcome=Ge.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||"",this.wrapperVer=e.wrapperVer||"",this.telemetryCacheKey=io+Ft+e.clientId}generateCurrentRequestHeaderValue(){let e=`${this.apiId}${wt}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);let o=t.join(wt),i=this.getRegionDiscoveryFields(),s=[e,i].join(wt);return[yn,s,o].join(An)}generateLastRequestHeaderValue(){let e=this.getLastRequests(),t=n.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(wt),o=e.errors.slice(0,t).join(wt),i=e.errors.length,s=t<i?os:ns,a=[i,s].join(wt);return[yn,e.cacheHits,r,o,a].join(An)}cacheFailedRequest(e){let t=this.getLastRequests();t.errors.length>=rs&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof w?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(is),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){let e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){let e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey,this.correlationId)||e}clearTelemetryCache(){let e=this.getLastRequests(),t=n.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{let o={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,o,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,o=0,i=e.errors.length;for(t=0;t<i;t++){let s=e.failedRequests[2*t]||"",a=e.failedRequests[2*t+1]||"",c=e.errors[t]||"";if(o+=s.toString().length+a.toString().length+c.length+3,o<ts)r+=1;else break}return r}getRegionDiscoveryFields(){let e=[];return e.push(this.regionUsed||""),e.push(this.regionSource||""),e.push(this.regionOutcome||""),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){let t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){let e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return cp(e)}};var yc=class n extends w{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,n.prototype)}};function Ac(n){return new yc(n)}var nh="missing_kid_error",ih="missing_alg_error";var Ko=class n{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Ac(nh);if(!e.alg)throw Ac(ih);let t=new n({typ:e.typ||ds.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}};function hp(n,e){e&&e.push({name:n.name})}function dp(n,e,t){if(!e?.length)return;let r=g=>g.length?g[g.length-1]:void 0,o=n.name;if(r(e)?.name!==o)return;let s=e?.pop();if(!s)return;let a=t instanceof w?t.errorCode:t instanceof Error?t.name:void 0,c=t instanceof w?t.subError:void 0;a&&s.childErr!==a&&(s.err=a,c&&(s.subErr=c)),delete s.name,delete s.childErr;let l=I(f({},s),{dur:n.durationMs});n.success||(l.fail=1);let d=r(e);if(!d)return{[o]:l};a&&(d.childErr=a);let u;if(!d[o])u=o;else{let g=Object.keys(d).filter(E=>E.startsWith(o)).length;u=`${o}_${g+1}`}return d[u]=l,d}function up(n,e,t,r=5){if(n instanceof Error){if(n instanceof w){t.errorCode=n.errorCode,t.subErrorCode=n.subError,(n instanceof le||n instanceof J)&&(t.serverErrorNo=n.errorNo);return}else if(n instanceof Je){t.errorCode=n.errorCode;return}else if(t.errorStack?.length){e.trace("0lmqrh",t.correlationId);return}else if(!n.stack?.length){e.trace("1cnpwa",t.correlationId);return}}else{e.trace("0gcyox",t.correlationId);return}n.stack&&(t.errorStack=mp(n.stack,r)),t.errorName=n.name}function mp(n,e){if(e<0)return[];let t=n.split(`
`)||[],r=[],o=t[0];o.startsWith("TypeError: Cannot read property")||o.startsWith("TypeError: Cannot read properties of")||o.startsWith("TypeError: Cannot set property")||o.startsWith("TypeError: Cannot set properties of")||o.endsWith("is not a function")?r.push(Tc(o)):(o.startsWith("SyntaxError")||o.startsWith("TypeError"))&&r.push(Tc(o.replace(/['].*[']|["].*["]/g,"<redacted>")));for(let i=1;i<t.length&&!(r.length>=e);i++){let s=t[i];r.push(Tc(s))}return r}function Tc(n){let e=n.lastIndexOf(" ")+1;if(e<1)return n;let t=n.substring(e),r=t.lastIndexOf("/");return r=r<0?t.lastIndexOf("\\"):r,r>=0?(n.substring(0,e)+"("+t.substring(r+1)+(t.charAt(t.length-1)===")"?"":")")).trimStart():n.trimStart()}function pp(n){let e=n?.idTokenClaims;if(e?.tfp||e?.acr)return"B2C";if(e?.tid){if(e?.tid==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}var Bo=class{constructor(e,t,r,o,i,s,a){this.authority=t,this.libraryName=o,this.libraryVersion=i,this.applicationTelemetry=s,this.clientId=e,this.logger=r,this.callbacks=new Map,this.eventsByCorrelationId=new Map,this.eventStack=new Map,this.intFields=a||new Set;for(let c of Wl)this.intFields.add(c)}startMeasurement(e,t){let r=t||this.generateId(),o={eventId:this.generateId(),status:No.InProgress,authority:this.authority,libraryName:this.libraryName,libraryVersion:this.libraryVersion,clientId:this.clientId,name:e,startTimeMs:Date.now(),correlationId:r,appName:this.applicationTelemetry?.appName,appVersion:this.applicationTelemetry?.appVersion};return this.cacheEventByCorrelationId(o),hp(o,this.eventStack.get(r)),{end:(i,s,a)=>this.endMeasurement(f(f({},o),i),s,a),discard:()=>this.discardMeasurements(o.correlationId),add:i=>this.addFields(i,o.correlationId),increment:i=>this.incrementFields(i,o.correlationId),event:o}}endMeasurement(e,t,r){let o=this.eventsByCorrelationId.get(e.correlationId);if(!o)return this.logger.trace("0k9ti8",e.correlationId),null;let i=e.eventId===o.eventId;e.durationMs=Math.round(e.durationMs||this.getDurationMs(e.startTimeMs));let s=JSON.stringify(dp(e,this.eventStack.get(o.correlationId),t));if(i?this.discardMeasurements(o.correlationId):o.incompleteSubMeasurements?.delete(e.eventId),t&&up(t,this.logger,o),!i)return o[e.name+"DurationMs"]=Math.floor(e.durationMs),f({},o);i&&!t&&(o.errorCode||o.subErrorCode)&&(this.logger.trace("1fm1tm",e.correlationId),o.errorCode=void 0,o.subErrorCode=void 0);let a=f(f({},o),e),c=0;a.incompleteSubMeasurements?.forEach(u=>{this.logger.trace("0nxk52",a.correlationId),c++}),a.incompleteSubMeasurements=void 0;let d=Bl(e.correlationId).map(u=>`${u.milliseconds},${u.hash}`).join(";");return a=I(f({},a),{status:No.Completed,incompleteSubsCount:c,context:s,logs:d}),r&&(a.accountType=pp(r),a.dataBoundary=r.dataBoundary),this.truncateIntegralFields(a),this.emitEvents([a],e.correlationId),a}addFields(e,t){let r=this.eventsByCorrelationId.get(t);r?this.eventsByCorrelationId.set(t,f(f({},r),e)):this.logger.trace("0thl6s",t)}incrementFields(e,t){let r=this.eventsByCorrelationId.get(t);if(r)for(let o in e){if(!r.hasOwnProperty(o))r[o]=0;else if(isNaN(Number(r[o])))return;r[o]+=e[o]}else this.logger.trace("0thl6s",t)}cacheEventByCorrelationId(e){let t=this.eventsByCorrelationId.get(e.correlationId);t?(t.incompleteSubMeasurements=t.incompleteSubMeasurements||new Map,t.incompleteSubMeasurements.set(e.eventId,{name:e.name,startTimeMs:e.startTimeMs})):(this.eventsByCorrelationId.set(e.correlationId,f({},e)),this.eventStack.set(e.correlationId,[]))}discardMeasurements(e){this.eventsByCorrelationId.delete(e),this.eventStack.delete(e)}addPerformanceCallback(e){for(let[r,o]of this.callbacks)if(o.toString()===e.toString())return this.logger.warning("1eap5p",""),r;let t=this.generateId();return this.callbacks.set(t,e),this.logger.verbose("0c9ujz",""),t}removePerformanceCallback(e){let t=this.callbacks.delete(e);return t?this.logger.verbose("0253if",""):this.logger.verbose("0iqk07",""),t}emitEvents(e,t){this.logger.verbose("11jb1y",t),this.callbacks.forEach((r,o)=>{this.logger.trace("0p2pjl",t),r.apply(null,[e])})}truncateIntegralFields(e){this.intFields.forEach(t=>{t in e&&typeof e[t]=="number"&&(e[t]=Math.floor(e[t]))})}getDurationMs(e){let t=Date.now()-e;return t<0?t:0}};function Pr(n){return`See https://aka.ms/msal.js.errors#${n} for details`}var bt=class n extends w{constructor(e,t){super(e,Pr(e),t),Object.setPrototypeOf(this,n.prototype),this.name="BrowserAuthError"}};function C(n,e){return new bt(n,e)}var X={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",MSAL_SKU:"msal.js.browser"},pe={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},Nr={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Z={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Ic={GET:"GET",POST:"POST"},De={SIGNIN:"signin",SIGNOUT:"signout"},q={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},zo={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},k={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962,hydrateCache:963,loadExternalTokens:964},sh={861:"acquireTokenRedirect",862:"acquireTokenPopup",863:"ssoSilent",864:"acquireTokenSilent_authCode",865:"handleRedirectPromise",866:"acquireTokenByCode",61:"acquireTokenSilent_silentFlow",961:"logout",962:"logoutPopup",963:"hydrateCache",964:"loadExternalTokens"},ah=n=>typeof n=="number"&&n in sh?sh[n]:"unknown",T=function(n){return n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none",n}(T||{}),Le={Startup:"startup",Logout:"logout",AcquireToken:"acquireToken",HandleRedirect:"handleRedirect",None:"none"},Go={scopes:y.OIDC_DEFAULT_SCOPES},wc="jwk",fp={React:"@azure/msal-react",Angular:"@azure/msal-angular"},Zn="msal.db",ch=1,lh=`${Zn}.keys`,j={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},hh=[j.Default,j.Skip,j.RefreshTokenAndNetwork];function Vo(n){return encodeURIComponent(Ot(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Re(n){return dh(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Ot(n){return dh(new TextEncoder().encode(n))}function dh(n){let e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}var uh={};Y(uh,{authCodeOrNativeAccountIdRequired:()=>Gc,authCodeRequired:()=>zc,authRequestNotSetError:()=>Ep,blockIframeReload:()=>xc,blockNestedPopups:()=>Uc,cryptoKeyNotFound:()=>Wo,cryptoNonExistent:()=>ri,databaseNotOpen:()=>sr,databaseUnavailable:()=>Jo,earJweEmpty:()=>Sc,earJwkEmpty:()=>ti,emptyNavigateUri:()=>or,emptyResponse:()=>Zc,emptyWindowError:()=>Pc,failedToBuildHeaders:()=>Yc,failedToDecryptEarResponse:()=>Qo,failedToParseHeaders:()=>Xc,failedToParseResponse:()=>oi,getRequestFailed:()=>Kc,hashDoesNotContainKnownProperties:()=>kc,hashEmptyError:()=>_c,iframeClosedPrematurely:()=>gp,interactionInProgress:()=>vc,interactionInProgressCancelled:()=>bc,invalidBase64String:()=>$c,invalidCacheType:()=>yp,invalidPopTokenRequest:()=>Qc,nativeConnectionNotEstablished:()=>$o,nativeExtensionNotInstalled:()=>Wc,nativeHandshakeTimeout:()=>qc,nativePromptNotSupported:()=>Jc,noAccountError:()=>Dc,noNetworkConnectivity:()=>xr,noStateInHash:()=>nr,noTokenRequestCacheError:()=>Lc,nonBrowserEnvironment:()=>qo,pkceNotCreated:()=>ei,popupWindowError:()=>Oc,postRequestFailed:()=>Fc,redirectBridgeEmptyResponse:()=>Nc,redirectInIframe:()=>Mc,silentLogoutUnsupported:()=>ir,silentPromptValueError:()=>Cp,spaCodeAndNativeAccountIdPresent:()=>Vc,stateInteractionTypeMismatch:()=>Rc,timedOut:()=>Pt,unableToAcquireTokenFromNativePlatform:()=>jc,unableToLoadToken:()=>Bc,unableToParseState:()=>jo,unableToParseTokenRequestCacheError:()=>Hc,uninitializedPublicClientApplication:()=>ar,userCancelled:()=>Mr});var ei="pkce_not_created",ti="ear_jwk_empty",Sc="ear_jwe_empty",ri="crypto_nonexistent",or="empty_navigate_uri",_c="hash_empty_error",nr="no_state_in_hash",kc="hash_does_not_contain_known_properties",jo="unable_to_parse_state",Rc="state_interaction_type_mismatch",vc="interaction_in_progress",bc="interaction_in_progress_cancelled",Oc="popup_window_error",Pc="empty_window_error",Mr="user_cancelled",Nc="redirect_bridge_empty_response",Mc="redirect_in_iframe",xc="block_iframe_reload",Uc="block_nested_popups",gp="iframe_closed_prematurely",ir="silent_logout_unsupported",Dc="no_account_error",Cp="silent_prompt_value_error",Lc="no_token_request_cache_error",Hc="unable_to_parse_token_request_cache_error",Ep="auth_request_not_set_error",yp="invalid_cache_type",qo="non_browser_environment",sr="database_not_open",xr="no_network_connectivity",Fc="post_request_failed",Kc="get_request_failed",oi="failed_to_parse_response",Bc="unable_to_load_token",Wo="crypto_key_not_found",zc="auth_code_required",Gc="auth_code_or_nativeAccountId_required",Vc="spa_code_and_nativeAccountId_present",Jo="database_unavailable",jc="unable_to_acquire_token_from_native_platform",qc="native_handshake_timeout",Wc="native_extension_not_installed",$o="native_connection_not_established",ar="uninitialized_public_client_application",Jc="native_prompt_not_supported",$c="invalid_base64_string",Qc="invalid_pop_token_request",Yc="failed_to_build_headers",Xc="failed_to_parse_headers",Qo="failed_to_decrypt_ear_response",Pt="timed_out",Zc="empty_response";function $(n){return new TextDecoder().decode(Xe(n))}function Xe(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw C($c)}let t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}var Ap="RSASSA-PKCS1-v1_5",Ur="AES-GCM",fh="HKDF",tl="SHA-256",Tp=2048,Ip=new Uint8Array([1,0,1]),mh="0123456789abcdef",ph=new Uint32Array(1),rl="raw",gh="encrypt",ol="decrypt",wp="deriveKey",Sp="crypto_subtle_undefined",nl={name:Ap,hash:tl,modulusLength:Tp,publicExponent:Ip};function Ch(n){if(!window)throw C(qo);if(!window.crypto)throw C(ri);if(!n&&!window.crypto.subtle)throw C(ri,Sp)}function il(n){return h(this,null,function*(){let t=new TextEncoder().encode(n);return window.crypto.subtle.digest(tl,t)})}function Eh(n){return window.crypto.getRandomValues(n)}function el(){return window.crypto.getRandomValues(ph),ph[0]}function O(){let n=Date.now(),e=el()*1024+(el()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),o=e&2**30-1,i=el();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|o>>>24,t[9]=o>>>16,t[10]=o>>>8,t[11]=o,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let s="";for(let a=0;a<t.length;a++)s+=mh.charAt(t[a]>>>4),s+=mh.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}function yh(n,e){return h(this,null,function*(){return window.crypto.subtle.generateKey(nl,n,e)})}function ni(n){return h(this,null,function*(){return window.crypto.subtle.exportKey(wc,n)})}function Ah(n,e,t){return h(this,null,function*(){return window.crypto.subtle.importKey(wc,n,nl,e,t)})}function Th(n,e){return h(this,null,function*(){return window.crypto.subtle.sign(nl,n,e)})}function Dr(){return h(this,null,function*(){let n=yield sl(),t={alg:"dir",kty:"oct",k:Re(new Uint8Array(n))};return Ot(JSON.stringify(t))})}function _p(n){return h(this,null,function*(){let e=$(n),r=JSON.parse(e).k,o=Xe(r);return window.crypto.subtle.importKey(rl,o,Ur,!1,[ol])})}function Ih(n,e){return h(this,null,function*(){let t=e.split(".");if(t.length!==5)throw C(Qo,"jwe_length");let r=yield _p(n).catch(()=>{throw C(Qo,"import_key")});try{let o=new TextEncoder().encode(t[0]),i=Xe(t[2]),s=Xe(t[3]),a=Xe(t[4]),c=a.byteLength*8,l=new Uint8Array(s.length+a.length);l.set(s),l.set(a,s.length);let d=yield window.crypto.subtle.decrypt({name:Ur,iv:i,tagLength:c,additionalData:o},r,l);return new TextDecoder().decode(d)}catch{throw C(Qo,"decrypt")}})}function sl(){return h(this,null,function*(){let n=yield window.crypto.subtle.generateKey({name:Ur,length:256},!0,[gh,ol]);return window.crypto.subtle.exportKey(rl,n)})}function al(n){return h(this,null,function*(){return window.crypto.subtle.importKey(rl,n,fh,!1,[wp])})}function wh(n,e,t){return h(this,null,function*(){return window.crypto.subtle.deriveKey({name:fh,salt:e,hash:tl,info:new TextEncoder().encode(t)},n,{name:Ur,length:256},!1,[gh,ol])})}function Sh(n,e,t){return h(this,null,function*(){let r=new TextEncoder().encode(e),o=window.crypto.getRandomValues(new Uint8Array(16)),i=yield wh(n,o,t),s=yield window.crypto.subtle.encrypt({name:Ur,iv:new Uint8Array(12)},i,r);return{data:Re(new Uint8Array(s)),nonce:Re(o)}})}function cl(n,e,t,r){return h(this,null,function*(){let o=Xe(r),i=yield wh(n,Xe(e),t),s=yield window.crypto.subtle.decrypt({name:Ur,iv:new Uint8Array(12)},i,o);return new TextDecoder().decode(s)})}function _h(n){return h(this,null,function*(){let e=yield il(n),t=new Uint8Array(e);return Re(t)})}var ii=class n extends w{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,n.prototype)}};function Q(n){return new ii(n,Pr(n))}var kh={};Y(kh,{inMemRedirectUnavailable:()=>ll,storageNotSupported:()=>Yo,stubbedPublicClientApplicationCalled:()=>he});var Yo="storage_not_supported",he="stubbed_public_client_application_called",ll="in_mem_redirect_unavailable";function Rh(){let n=window.location.hash,e=window.location.search,t=!1,r=!1,o="",i;if(n&&n.length>1){let d=n.charAt(0)==="#"?n.substring(1):n,u=new URLSearchParams(d);u.has("state")&&(t=!0,o=d,i=u)}if(e&&e.length>1){let d=e.charAt(0)==="?"?e.substring(1):e,u=new URLSearchParams(d);u.has("state")&&(r=!0,o=d,i=u)}if(t&&r){let d=e.charAt(0)==="?"?e.substring(1):e,u=n.charAt(0)==="#"?n.substring(1):n;o=`${d}${u}`,i=new URLSearchParams(o)}if(!o||!i)throw C(Zc);let s=i.get("state");if(!s)throw C(nr);let{libraryState:a}=Me.parseRequestState($,s),{id:c,meta:l}=a;if(!c||!l)throw C(jo,"missing_library_state");return{params:i,payload:o,urlHash:n,urlQuery:e,hasResponseInHash:t,hasResponseInQuery:r,libraryState:{id:c,meta:l}}}function Xo(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function hl(n){let e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Lr(){return window.parent!==window}function vh(){if(Lr())return!1;try{let{libraryState:n}=Rh(),{meta:e}=n;return e.interactionType===T.Popup}catch{return!1}}var Nt=null;function dl(n,e){Nt&&(n.verbose("18y01k",e),clearTimeout(Nt.timeoutId),Nt.channel.close(),Nt.reject(C(bc)),Nt=null)}function dt(n,e,t,r){return h(this,null,function*(){return new Promise((o,i)=>{e.verbose("1rf6em",r.correlationId);let{libraryState:s}=Me.parseRequestState(t.base64Decode,r.state||""),a=new BroadcastChannel(s.id),c,l=window.setTimeout(()=>{Nt=null,a.close(),i(C(Pt,"redirect_bridge_timeout"))},n);Nt={timeoutId:l,channel:a,reject:i},a.onmessage=d=>{c=d.data.payload,Nt=null,clearTimeout(l),a.close(),c?o(c):i(C(Nc))}})})}function Ie(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function ul(){let e=new b(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function bh(){if(_e.getDeserializedResponse(window.location.hash)&&Lr())throw C(xc)}function Oh(n){if(Lr()&&!n)throw C(Mc)}function Ph(){if(vh())throw C(Uc)}function Hr(){if(typeof window>"u")throw C(qo)}function si(n){if(!n)throw C(ar)}function Zo(n){Hr(),bh(),Ph(),si(n)}function ai(n,e){if(Zo(n),Oh(e.system.allowRedirectInIframe),e.cache.cacheLocation===Z.MemoryStorage)throw Q(ll)}function en(n){let e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function Fr(){return O()}var kp=x.addClientCapabilitiesToClaims;var Mh="acquireTokenFromCache",xh="acquireTokenByRefreshToken",Uh="acquireTokenSilentAsync",Dh="cryptoOptsGetPublicKeyThumbprint",Lh="cryptoOptsSignJwt",Hh="silentCacheClientAcquireToken",Fh="silentIframeClientAcquireToken",Kh="awaitConcurrentIframe",Bh="silentRefreshClientAcquireToken",He="standardInteractionClientGetDiscoveredAuthority",ci="nativeInteractionClientAcquireToken",zh="refreshTokenClientAcquireTokenByRefreshToken",ml="acquireTokenBySilentIframe",Kr="initializeBaseRequest",Gh="initializeSilentRequest",Vh="initializeCache",pl="silentIframeClientTokenHelper",li="silentHandlerInitiateAuthRequest",Br="silentHandlerMonitorIframeForHash",jh="silentHandlerLoadFrameSync",Fe="standardInteractionClientCreateAuthCodeClient",Mt="standardInteractionClientGetClientConfiguration",xt="standardInteractionClientInitializeAuthorizationRequest",qh="silentFlowClientAcquireCachedToken",Wh="getStandardParams",Jh="handleCodeResponse",zr="handleResponseEar",fl="handleResponsePlatformBroker",ut="handleResponseCode",$h="authClientAcquireToken",cr="deserializeResponse",Qh="authorityFactoryCreateDiscoveredInstance",Yh="acquireTokenByCodeAsync",Xh="handleRedirectPromise",Zh="handleNativeRedirectPromise",ed="nativeMessageHandlerHandshake",td="importExistingCache",Ke="generatePkceCodes",rd="generateCodeVerifier",od="generateCodeChallengeFromVerifier",nd="sha256Digest",id="getRandomValues",gl="generateHKDF",sd="generateBaseKey",ad="base64Decode",cd="urlEncodeArr",ld="encrypt",Cl="decrypt",Gr="generateEarKey",hd="decryptEarResponse",dd="loadAccount",ud="loadIdToken",md="loadAccessToken",pd="loadRefreshToken";var hi=class{constructor(){this.dbName=Zn,this.version=ch,this.tableName=lh,this.dbOpen=!1}open(){return h(this,null,function*(){return new Promise((e,t)=>{let r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",o=>{let i=o;this.db=i.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(C(Jo)))})})}closeConnection(){let e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){return h(this,null,function*(){if(!this.dbOpen)return this.open()})}getItem(e){return h(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(C(sr));let s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{let c=a;this.closeConnection(),t(c.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})})}setItem(e,t){return h(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((r,o)=>{if(!this.db)return o(C(sr));let a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),r()}),a.addEventListener("error",c=>{this.closeConnection(),o(c)})})})}removeItem(e){return h(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(C(sr));let s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})})}getKeys(){return h(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(C(sr));let i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",s=>{let a=s;this.closeConnection(),e(a.target.result)}),i.addEventListener("error",s=>{this.closeConnection(),t(s)})})})}containsKey(e){return h(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(C(sr));let s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{let c=a;this.closeConnection(),t(c.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})})}deleteDatabase(){return h(this,null,function*(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{let r=window.indexedDB.deleteDatabase(Zn),o=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(o),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(o),e(!0))),r.addEventListener("error",()=>(clearTimeout(o),t(!1)))})})}};var Ze=class{constructor(){this.cache=new Map}initialize(){return h(this,null,function*(){})}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}setUserData(e,t){return h(this,null,function*(){this.setItem(e,t)})}removeItem(e){this.cache.delete(e)}getKeys(){let e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}};var di=class{constructor(e){this.inMemoryCache=new Ze,this.indexedDBCache=new hi,this.logger=e}handleDatabaseAccessError(e,t){if(e instanceof bt&&e.errorCode===Jo)this.logger.error("1wx7zz",t);else throw e}getItem(e,t){return h(this,null,function*(){let r=this.inMemoryCache.getItem(e);if(!r)try{return this.logger.verbose("0naxpl",t),yield this.indexedDBCache.getItem(e)}catch(o){this.handleDatabaseAccessError(o,t)}return r})}setItem(e,t,r){return h(this,null,function*(){this.inMemoryCache.setItem(e,t);try{yield this.indexedDBCache.setItem(e,t)}catch(o){this.handleDatabaseAccessError(o,r)}})}removeItem(e,t){return h(this,null,function*(){this.inMemoryCache.removeItem(e);try{yield this.indexedDBCache.removeItem(e)}catch(r){this.handleDatabaseAccessError(r,t)}})}getKeys(e){return h(this,null,function*(){let t=this.inMemoryCache.getKeys();if(t.length===0)try{return this.logger.verbose("1iqrbq",e),yield this.indexedDBCache.getKeys()}catch(r){this.handleDatabaseAccessError(r,e)}return t})}containsKey(e,t){return h(this,null,function*(){let r=this.inMemoryCache.containsKey(e);if(!r)try{return this.logger.verbose("03zl2j",t),yield this.indexedDBCache.containsKey(e)}catch(o){this.handleDatabaseAccessError(o,t)}return r})}clearInMemory(e){this.logger.verbose("03r21p",e),this.inMemoryCache.clear(),this.logger.verbose("0uksk1",e)}clearPersistent(e){return h(this,null,function*(){try{this.logger.verbose("0rdqut",e);let t=yield this.indexedDBCache.deleteDatabase();return t&&this.logger.verbose("149ouc",e),t}catch(t){return this.handleDatabaseAccessError(t,e),!1}})}};var ve=(()=>{class n{constructor(t,r,o){this.logger=t,Ch(o??!1),this.cache=new di(this.logger),this.performanceClient=r}createNewGuid(){return O()}base64Encode(t){return Ot(t)}base64Decode(t){return $(t)}base64UrlEncode(t){return Vo(t)}encodeKid(t){return this.base64UrlEncode(JSON.stringify({kid:t}))}getPublicKeyThumbprint(t){return h(this,null,function*(){let r=this.performanceClient?.startMeasurement(Dh,t.correlationId),o=yield yh(n.EXTRACTABLE,n.POP_KEY_USAGES),i=yield ni(o.publicKey),s={e:i.e,kty:i.kty,n:i.n},a=fd(s),c=yield this.hashString(a),l=yield ni(o.privateKey),d=yield Ah(l,!1,["sign"]);return yield this.cache.setItem(c,{privateKey:d,publicKey:o.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri},t.correlationId),r&&r.end({success:!0}),c})}removeTokenBindingKey(t,r){return h(this,null,function*(){if(yield this.cache.removeItem(t,r),yield this.cache.containsKey(t,r))throw p(N.bindingKeyNotRemoved)})}clearKeystore(t){return h(this,null,function*(){this.cache.clearInMemory(t);try{return yield this.cache.clearPersistent(t),!0}catch(r){return r instanceof Error?this.logger.error("1owpn8",t):this.logger.error("0yrmwo",t),!1}})}signJwt(t,r,o,i){return h(this,null,function*(){let s=this.performanceClient?.startMeasurement(Lh,i),a=yield this.cache.getItem(r,i||"");if(!a)throw C(Wo);let c=yield ni(a.publicKey),l=fd(c),d=Vo(JSON.stringify({kid:r})),u=Ko.getShrHeaderString(I(f({},o?.header),{alg:c.alg,kid:d})),g=Vo(u);t.cnf={jwk:JSON.parse(l)};let E=Vo(JSON.stringify(t)),S=`${g}.${E}`,B=new TextEncoder().encode(S),oe=yield Th(a.privateKey,B),L=Re(new Uint8Array(oe)),ae=`${S}.${L}`;return s&&s.end({success:!0}),ae})}hashString(t){return h(this,null,function*(){return _h(t)})}}return n.POP_KEY_USAGES=["sign","verify"],n.EXTRACTABLE=!0,n})();function fd(n){return JSON.stringify(n,Object.keys(n).sort())}var gd={};Y(gd,{AcquireTokenByCode:()=>El,AcquireTokenPopup:()=>rn,AcquireTokenPreRedirect:()=>yl,AcquireTokenRedirect:()=>on,AcquireTokenSilent:()=>tn,InitializeClientApplication:()=>Al,LoadExternalTokens:()=>Il,LocalStorageUpdated:()=>Tl,SsoSilent:()=>nn});var tn="acquireTokenSilent",El="acquireTokenByCode",rn="acquireTokenPopup",yl="acquireTokenPreRedirect",on="acquireTokenRedirect",nn="ssoSilent",Al="initializeClientApplication",Tl="localStorageUpdated",Il="loadExternalTokens";var re="msal",ui="browser",wl="|";var yd=`${re}.${ui}.log.level`,Ad=`${re}.${ui}.log.pii`,Td=`${re}.${ui}.performance.enabled`,Id=`${re}.${ui}.platform.auth.dom`,Sl=`${re}.version`,Cd="account.keys",Ed="token.keys";function mt(n=2){return n<1?`${re}.${Cd}`:`${re}.${n}.${Cd}`}function pt(n,e=2){return e<1?`${re}.${Ed}.${n}`:`${re}.${e}.${Ed}.${n}`}var Rp=24*60*60*1e3,mi={Lax:"Lax",None:"None"},Vr=class{initialize(){return Promise.resolve()}getItem(e){let t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let o=0;o<r.length;o++){let i=r[o],[s,...a]=decodeURIComponent(i).trim().split("="),c=a.join("=");if(s===t)return c}return""}getUserData(){throw p(N.methodNotImplemented)}setItem(e,t,r,o=!0,i=mi.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(r){let a=vp(r);s+=`expires=${a};`}(o||i===mi.None)&&(s+="Secure;"),document.cookie=s}setUserData(){return h(this,null,function*(){return Promise.reject(p(N.methodNotImplemented))})}removeItem(e){this.setItem(e,"",-1)}getKeys(){let e=document.cookie.split(";"),t=[];return e.forEach(r=>{let o=decodeURIComponent(r).trim().split("=");t.push(o[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}};function vp(n){let e=new Date;return new Date(e.getTime()+n*Rp).toUTCString()}function et(n,e){let t=n.getItem(mt(e));return t?JSON.parse(t):[]}function we(n,e,t){let r=e.getItem(pt(n,t));if(r){let o=JSON.parse(r);if(o&&o.hasOwnProperty("idToken")&&o.hasOwnProperty("accessToken")&&o.hasOwnProperty("refreshToken"))return o}return{idToken:[],accessToken:[],refreshToken:[]}}function jr(n){return n.hasOwnProperty("id")&&n.hasOwnProperty("nonce")&&n.hasOwnProperty("data")}var wd="msal.cache.encryption",bp="msal.broadcast.cache",sn=class{constructor(e,t,r){if(!window.localStorage)throw Q(Yo);this.memoryStorage=new Ze,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel(bp)}initialize(e){return h(this,null,function*(){let t=new Vr,r=t.getItem(wd),o={key:"",id:""};if(r)try{o=JSON.parse(r)}catch{}if(o.key&&o.id){let i=te(Xe,ad,this.logger,this.performanceClient,e)(o.key);this.encryptionCookie={id:o.id,key:yield m(al,gl,this.logger,this.performanceClient,e)(i)}}else{let i=O(),s=yield m(sl,sd,this.logger,this.performanceClient,e)(),a=te(Re,cd,this.logger,this.performanceClient,e)(new Uint8Array(s));this.encryptionCookie={id:i,key:yield m(al,gl,this.logger,this.performanceClient,e)(s)};let c={id:i,key:a};t.setItem(wd,JSON.stringify(c),0,!0,mi.None)}yield m(this.importExistingCache.bind(this),td,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",i=>{this.updateCache(i,e)}),this.initialized=!0})}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw C(ar);return this.memoryStorage.getItem(e)}decryptData(e,t,r){return h(this,null,function*(){if(!this.initialized||!this.encryptionCookie)throw C(ar);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;let o=yield m(cl,Cl,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!o)return null;try{return I(f({},JSON.parse(o)),{lastUpdatedAt:t.lastUpdatedAt})}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}})}setItem(e,t){window.localStorage.setItem(e,t)}setUserData(e,t,r,o,i){return h(this,null,function*(){if(!this.initialized||!this.encryptionCookie)throw C(ar);if(i)this.setItem(e,t);else{let{data:s,nonce:a}=yield m(Sh,ld,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),c={id:this.encryptionCookie.id,nonce:a,data:s,lastUpdatedAt:o};this.setItem(e,JSON.stringify(c))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),et(this).forEach(r=>this.removeItem(r));let t=we(this.clientId,this);t.idToken.forEach(r=>this.removeItem(r)),t.accessToken.forEach(r=>this.removeItem(r)),t.refreshToken.forEach(r=>this.removeItem(r)),this.getKeys().forEach(r=>{(r.startsWith(re)||r.indexOf(this.clientId)!==-1)&&this.removeItem(r)})}importExistingCache(e){return h(this,null,function*(){if(!this.encryptionCookie)return;let t=et(this);t=yield this.importArray(t,e),t.length?this.setItem(mt(),JSON.stringify(t)):this.removeItem(mt());let r=we(this.clientId,this);r.idToken=yield this.importArray(r.idToken,e),r.accessToken=yield this.importArray(r.accessToken,e),r.refreshToken=yield this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem(pt(this.clientId),JSON.stringify(r)):this.removeItem(pt(this.clientId))})}getItemFromEncryptedCache(e,t){return h(this,null,function*(){if(!this.encryptionCookie)return null;let r=this.getItem(e);if(!r)return null;let o;try{o=JSON.parse(r)}catch{return null}return jr(o)?o.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),m(cl,Cl,this.logger,this.performanceClient,t)(this.encryptionCookie.key,o.nonce,this.getContext(e),o.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),r)})}importArray(e,t){return h(this,null,function*(){let r=[],o=[];return e.forEach(i=>{let s=this.getItemFromEncryptedCache(i,t).then(a=>{a?(this.memoryStorage.setItem(i,a),r.push(i)):this.removeItem(i)});o.push(s)}),yield Promise.all(o),r})}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e,t){this.logger.trace("17cxcm",t);let r=this.performanceClient.startMeasurement(Tl);r.add({isBackground:!0});let{key:o,value:i,context:s}=e.data;if(!o){this.logger.error("0e10qr",t),r.end({success:!1,errorCode:"noKey"});return}if(s&&s!==this.clientId){this.logger.trace("04rtdy",t),r.end({success:!1,errorCode:"contextMismatch"});return}i?(this.memoryStorage.setItem(o,i),this.logger.verbose("1vzsgt",t)):(this.memoryStorage.removeItem(o),this.logger.verbose("04ypih",t)),r.end({success:!0})}};var an=class{constructor(){if(!window.sessionStorage)throw Q(Yo)}initialize(){return h(this,null,function*(){})}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}setUserData(e,t){return h(this,null,function*(){this.setItem(e,t)})}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}};var A={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_SUCCESS:"msal:loginSuccess",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",BROKERED_REQUEST_START:"msal:brokeredRequestStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",BROKERED_REQUEST_SUCCESS:"msal:brokeredRequestSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",BROKERED_REQUEST_FAILURE:"msal:brokeredRequestFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};var ft="@azure/msal-browser",W="5.2.0";function gt(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var tt=class n extends Qt{constructor(e,t,r,o,i,s,a){super(e,r,o,i,a),this.cacheConfig=t,this.logger=o,this.internalStorage=new Ze,this.browserStorage=Sd(e,t.cacheLocation,o,i),this.temporaryCacheStorage=Sd(e,Z.SessionStorage,o,i),this.cookieStorage=new Vr,this.eventHandler=s}initialize(e){return h(this,null,function*(){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),yield this.browserStorage.initialize(e),yield this.migrateExistingCache(e),this.trackVersionChanges(e)})}migrateExistingCache(e){return h(this,null,function*(){let t=et(this.browserStorage),r=we(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:r.accessToken.length,preMigrateITCount:r.idToken.length,preMigrateRTCount:r.refreshToken.length},e);for(let i=0;i<2;i++){let s=i;yield this.removeStaleAccounts(i,s,e)}for(let i=0;i<2;i++){let s=i;yield this.migrateIdTokens(i,s,e)}let o=this.getKMSIValues();for(let i=0;i<2;i++)yield this.migrateAccessTokens(i,o,e),yield this.migrateRefreshTokens(i,o,e);t=et(this.browserStorage),r=we(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:r.accessToken.length,postMigrateITCount:r.idToken.length,postMigrateRTCount:r.refreshToken.length},e)})}updateOldEntry(e,t){return h(this,null,function*(){let r=this.browserStorage.getItem(e),o=this.validateAndParseJson(r||"");if(!o)return this.browserStorage.removeItem(e),null;if(!o.lastUpdatedAt)o.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(o),t);else if(P.isCacheExpired(o.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null;let i=jr(o)?yield this.browserStorage.decryptData(e,o,t):o;return!i||!V.isCredentialEntity(i)?(this.performanceClient.incrementFields({invalidCacheCount:1},t),null):(V.isAccessTokenEntity(i)||V.isRefreshTokenEntity(i))&&i.expiresOn&&P.isTokenExpired(i.expiresOn,y.DEFAULT_TOKEN_RENEWAL_OFFSET_SEC)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):i})}removeStaleAccounts(e,t,r){return h(this,null,function*(){let o=et(this.browserStorage,e);if(o.length!==0){for(let i of[...o]){this.performanceClient.incrementFields({oldAcntCount:1},r);let s=this.browserStorage.getItem(i),a=this.validateAndParseJson(s||"");if(!a){gt(o,i);continue}if(a.lastUpdatedAt)P.isCacheExpired(a.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(yield this.removeAccountOldSchema(i,a,t,r),gt(o,i));else{a.lastUpdatedAt=Date.now().toString(),this.setItem(i,JSON.stringify(a),r);continue}}this.setAccountKeys(o,r,e)}})}removeAccountOldSchema(e,t,r,o){return h(this,null,function*(){let s=(jr(t)?yield this.browserStorage.decryptData(e,t,o):t)?.homeAccountId;if(s){let a=this.getTokenKeys(r);[...a.idToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),gt(a.idToken,c)}),[...a.accessToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),gt(a.accessToken,c)}),[...a.refreshToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),gt(a.refreshToken,c)}),this.setTokenKeys(a,o,r)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},o),this.browserStorage.removeItem(e)})}getKMSIValues(){let e={},t=this.getTokenKeys().idToken;for(let r of t){let o=this.browserStorage.getUserData(r);if(o){let i=JSON.parse(o),s=D.extractTokenClaims(i.secret,$);s&&(e[i.homeAccountId]=D.isKmsi(s))}}return e}migrateIdTokens(e,t,r){return h(this,null,function*(){let o=we(this.clientId,this.browserStorage,e);if(o.idToken.length===0)return;let i=we(this.clientId,this.browserStorage,2),s=et(this.browserStorage),a=et(this.browserStorage,t);for(let c of[...o.idToken]){this.performanceClient.incrementFields({oldITCount:1},r);let l=yield this.updateOldEntry(c,r);if(!l){gt(o.idToken,c);continue}let d=s.find(L=>L.includes(l.homeAccountId)),u=a.find(L=>L.includes(l.homeAccountId)),g=null;if(d)g=this.getAccount(d,r);else if(u){let L=this.browserStorage.getItem(u),ae=this.validateAndParseJson(L||"");g=ae&&jr(ae)?yield this.browserStorage.decryptData(u,ae,r):ae}if(!g){this.performanceClient.incrementFields({skipITMigrateCount:1},r);continue}let E=D.extractTokenClaims(l.secret,$),S=this.generateCredentialKey(l),_=this.getIdTokenCredential(S,r),B=Object.keys(E).includes("signin_state"),oe=_&&Object.keys(D.extractTokenClaims(_.secret,$)||{}).includes("signin_state");if(!_||l.lastUpdatedAt>_.lastUpdatedAt&&(B||!oe)){let L=g.tenantProfiles||[],ae=ct(E)||g.realm;if(ae&&!L.find(Tt=>Tt.tenantId===ae)){let Tt=ke(g.homeAccountId,g.localAccountId,ae,E);L.push(Tt)}g.tenantProfiles=L;let ce=this.generateAccountKey(ie.getAccountInfo(g)),At=D.isKmsi(E);yield this.setUserData(ce,JSON.stringify(g),r,g.lastUpdatedAt,At),s.includes(ce)||s.push(ce),yield this.setUserData(S,JSON.stringify(l),r,l.lastUpdatedAt,At),this.performanceClient.incrementFields({migratedITCount:1},r),i.idToken.push(S)}}this.setTokenKeys(o,r,e),this.setTokenKeys(i,r),this.setAccountKeys(s,r)})}migrateAccessTokens(e,t,r){return h(this,null,function*(){let o=we(this.clientId,this.browserStorage,e);if(o.accessToken.length===0)return;let i=we(this.clientId,this.browserStorage,2);for(let s of[...o.accessToken]){this.performanceClient.incrementFields({oldATCount:1},r);let a=yield this.updateOldEntry(s,r);if(!a){gt(o.accessToken,s);continue}if(!(a.homeAccountId in t)){this.performanceClient.incrementFields({skipATMigrateCount:1},r);continue}let c=this.generateCredentialKey(a),l=t[a.homeAccountId];if(!i.accessToken.includes(c))yield this.setUserData(c,JSON.stringify(a),r,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedATCount:1},r),i.accessToken.push(c);else{let d=this.getAccessTokenCredential(c,r);(!d||a.lastUpdatedAt>d.lastUpdatedAt)&&(yield this.setUserData(c,JSON.stringify(a),r,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedATCount:1},r))}}this.setTokenKeys(o,r,e),this.setTokenKeys(i,r)})}migrateRefreshTokens(e,t,r){return h(this,null,function*(){let o=we(this.clientId,this.browserStorage,e);if(o.refreshToken.length===0)return;let i=we(this.clientId,this.browserStorage,2);for(let s of[...o.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},r);let a=yield this.updateOldEntry(s,r);if(!a){gt(o.refreshToken,s);continue}if(!(a.homeAccountId in t)){this.performanceClient.incrementFields({skipRTMigrateCount:1},r);continue}let c=this.generateCredentialKey(a),l=t[a.homeAccountId];if(!i.refreshToken.includes(c))yield this.setUserData(c,JSON.stringify(a),r,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedRTCount:1},r),i.refreshToken.push(c);else{let d=this.getRefreshTokenCredential(c,r);(!d||a.lastUpdatedAt>d.lastUpdatedAt)&&(yield this.setUserData(c,JSON.stringify(a),r,a.lastUpdatedAt,l),this.performanceClient.incrementFields({migratedRTCount:1},r))}}this.setTokenKeys(o,r,e),this.setTokenKeys(i,r)})}trackVersionChanges(e){let t=this.browserStorage.getItem(Sl);t&&(this.logger.info("1wuc87",e),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==W&&this.setItem(Sl,W,e)}validateAndParseJson(e){if(!e)return null;try{let t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}setItem(e,t,r){let o=new Array(3).fill(0),i=[],s=20;for(let a=0;a<=s;a++)try{if(this.browserStorage.setItem(e,t),a>0)for(let c=0;c<=2;c++){let l=o.slice(0,c).reduce((u,g)=>u+g,0);if(l>=a)break;let d=a>l+o[c]?l+o[c]:a;a>l&&o[c]>0&&this.removeAccessTokenKeys(i.slice(l,d),r,c)}break}catch(c){let l=Ir(c);if(l.errorCode===Oo.cacheQuotaExceeded&&a<s){if(!i.length)for(let d=0;d<=2;d++)if(e===pt(this.clientId,d)){let u=JSON.parse(t).accessToken;i.push(...u),o[d]=u.length}else{let u=this.getTokenKeys(d).accessToken;i.push(...u),o[d]=u.length}if(i.length<=a)throw l;this.removeAccessToken(i[a],r,!1)}else throw l}}setUserData(e,t,r,o,i){return h(this,null,function*(){let s=new Array(3).fill(0),a=[],c=20;for(let l=0;l<=c;l++)try{if(yield m(this.browserStorage.setUserData.bind(this.browserStorage),se.SetUserData,this.logger,this.performanceClient,r)(e,t,r,o,i),l>0)for(let d=0;d<=2;d++){let u=s.slice(0,d).reduce((E,S)=>E+S,0);if(u>=l)break;let g=l>u+s[d]?u+s[d]:l;l>u&&s[d]>0&&this.removeAccessTokenKeys(a.slice(u,g),r,d)}break}catch(d){let u=Ir(d);if(u.errorCode===Oo.cacheQuotaExceeded&&l<c){if(!a.length)for(let g=0;g<=2;g++){let E=this.getTokenKeys(g).accessToken;a.push(...E),s[g]=E.length}if(a.length<=l)throw u;this.removeAccessToken(a[l],r,!1)}else throw u}})}getAccount(e,t){this.logger.trace("1lfvm6",t);let r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;let o=this.validateAndParseJson(r);if(!o||!ie.isAccountEntity(o))return null;let i=Qt.toObject({},o);return this.performanceClient.addFields({accountCachedBy:ah(i.cachedByApiId)},t),i}setAccount(e,t,r,o){return h(this,null,function*(){this.logger.trace("1bz3wr",t);let i=this.generateAccountKey(ie.getAccountInfo(e)),s=Date.now().toString();e.lastUpdatedAt=s,e.cachedByApiId=o,yield this.setUserData(i,JSON.stringify(e),t,s,r),this.addAccountKeyToMap(i,t),this.performanceClient.addFields({kmsi:r},t)})}setAccountKeys(e,t,r=2){e.length===0?this.removeItem(mt(r)):this.setItem(mt(r),JSON.stringify(e),t)}getAccountKeys(){return et(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("0rb85k",t),this.logger.tracePii("1l9bdo",t);let r=this.getAccountKeys();return r.indexOf(e)===-1?(r.push(e),this.setItem(mt(),JSON.stringify(r),t),this.logger.verbose("0xia39",t),!0):(this.logger.verbose("0161kk",t),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("1jpigu",t),this.logger.tracePii("1xzspl",t);let r=this.getAccountKeys(),o=r.indexOf(e);o>-1?(r.splice(o,1),this.setAccountKeys(r,t)):this.logger.trace("1dytu2",t)}removeAccount(e,t){let r=this.getActiveAccount(t);r?.homeAccountId===e.homeAccountId&&r?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(o=>{o.includes(e.homeAccountId)&&o.includes(e.environment)&&this.browserStorage.removeItem(o)})}removeIdToken(e,t){super.removeIdToken(e,t);let r=this.getTokenKeys(),o=r.idToken.indexOf(e);o>-1&&(this.logger.info("05udv9",t),r.idToken.splice(o,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=2){this.logger.trace("17o18n",t);let o=this.getTokenKeys(r),i=0;if(e.forEach(s=>{let a=o.accessToken.indexOf(s);a>-1&&(o.accessToken.splice(a,1),i++)}),i>0){this.logger.info("15i5d5",t),this.setTokenKeys(o,t,r);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);let r=this.getTokenKeys(),o=r.refreshToken.indexOf(e);o>-1&&(this.logger.info("1f4fq3",t),r.refreshToken.splice(o,1),this.setTokenKeys(r,t))}getTokenKeys(e=2){return we(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=2){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem(pt(this.clientId,r));return}else this.setItem(pt(this.clientId,r),JSON.stringify(e),t)}getIdTokenCredential(e,t){let r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("1jukz6",t),this.removeIdToken(e,t),null;let o=this.validateAndParseJson(r);return!o||!V.isIdTokenEntity(o)?(this.logger.trace("1jukz6",t),null):(this.logger.trace("01ju66",t),o)}setIdTokenCredential(e,t,r){return h(this,null,function*(){this.logger.trace("13hjll",t);let o=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,yield this.setUserData(o,JSON.stringify(e),t,i,r);let s=this.getTokenKeys();s.idToken.indexOf(o)===-1&&(this.logger.info("07jy92",t),s.idToken.push(o),this.setTokenKeys(s,t))})}getAccessTokenCredential(e,t){let r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0bqvx8",t),this.removeAccessTokenKeys([e],t),null;let o=this.validateAndParseJson(r);return!o||!V.isAccessTokenEntity(o)?(this.logger.trace("0bqvx8",t),null):(this.logger.trace("1o81rl",t),o)}setAccessTokenCredential(e,t,r){return h(this,null,function*(){this.logger.trace("1pondb",t);let o=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,yield this.setUserData(o,JSON.stringify(e),t,i,r);let s=this.getTokenKeys(),a=s.accessToken.indexOf(o);a!==-1&&s.accessToken.splice(a,1),this.logger.trace("1onhey",t),s.accessToken.push(o),this.setTokenKeys(s,t)})}getRefreshTokenCredential(e,t){let r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0jlizt",t),this.removeRefreshToken(e,t),null;let o=this.validateAndParseJson(r);return!o||!V.isRefreshTokenEntity(o)?(this.logger.trace("0jlizt",t),null):(this.logger.trace("0nokxi",t),o)}setRefreshTokenCredential(e,t,r){return h(this,null,function*(){this.logger.trace("0tcg8d",t);let o=this.generateCredentialKey(e),i=Date.now().toString();e.lastUpdatedAt=i,yield this.setUserData(o,JSON.stringify(e),t,i,r);let s=this.getTokenKeys();s.refreshToken.indexOf(o)===-1&&(this.logger.info("0eckjs",t),s.refreshToken.push(o),this.setTokenKeys(s,t))})}getAppMetadata(e,t){let r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1q101h",t),null;let o=this.validateAndParseJson(r);return!o||!V.isAppMetadataEntity(e,o)?(this.logger.trace("1q101h",t),null):(this.logger.trace("19pvg2",t),o)}setAppMetadata(e,t){this.logger.trace("0cyma6",t);let r=V.generateAppMetadataKey(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e,t){let r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("0jk19c",t),null;let o=this.validateAndParseJson(r);return!o||!V.isServerTelemetryEntity(e,o)?(this.logger.trace("0jk19c",t),null):(this.logger.trace("12jguk",t),o)}setServerTelemetry(e,t,r){this.logger.trace("1poh61",r),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e,t){let r=this.internalStorage.getItem(e);if(!r)return this.logger.trace("1r39oe",t),null;let o=this.validateAndParseJson(r);return o&&V.isAuthorityMetadataEntity(e,o)?(this.logger.trace("1ohvk3",t),o):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(zo.WRAPPER_SKU,e),this.internalStorage.setItem(zo.WRAPPER_VER,t)}getWrapperMetadata(){let e=this.internalStorage.getItem(zo.WRAPPER_SKU)||"",t=this.internalStorage.getItem(zo.WRAPPER_VER)||"";return[e,t]}setAuthorityMetadata(e,t,r){this.logger.trace("07w8n2",r),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){let t=this.generateCacheKey(y.PersistentCacheKeys.ACTIVE_ACCOUNT_FILTERS),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("08gw0e",e),null;let o=this.validateAndParseJson(r);return o?(this.logger.trace("1t3ch7",e),this.getAccountInfoFilteredBy({homeAccountId:o.homeAccountId,localAccountId:o.localAccountId,tenantId:o.tenantId},e)):(this.logger.trace("0me1up",e),null)}setActiveAccount(e,t){let r=this.generateCacheKey(y.PersistentCacheKeys.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("0rsj80",t);let o={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.setItem(r,JSON.stringify(o),t)}else this.logger.verbose("1bp5z5",t),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(A.ACTIVE_ACCOUNT_CHANGED,t)}getThrottlingCache(e,t){let r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1h4wa6",t),null;let o=this.validateAndParseJson(r);return!o||!V.isThrottlingEntity(e,o)?(this.logger.trace("1h4wa6",t),null):(this.logger.trace("0of6n8",t),o)}setThrottlingCache(e,t,r){this.logger.trace("0wfgh6",r),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t,r){let o=r?this.generateCacheKey(e):e,i=this.temporaryCacheStorage.getItem(o);if(!i){if(this.cacheConfig.cacheLocation===Z.LocalStorage){let s=this.browserStorage.getItem(o);if(s)return this.logger.trace("1yt61y",t),s}return this.logger.trace("1qhy81",t),null}return i}setTemporaryCache(e,t,r){let o=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(o,t)}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e)}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(re)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(re)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}generateCacheKey(e){return K.startsWith(e,re)?e:`${re}.${this.clientId}.${e}`}generateCredentialKey(e){let t=e.credentialType===y.CredentialType.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==y.AuthenticationScheme.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${re}.${2}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",r].join(wl).toLowerCase()}generateAccountKey(e){let t=e.homeAccountId.split(".")[1];return[`${re}.${2}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(wl).toLowerCase()}resetRequestCache(e){this.logger.trace("0h0ynu",e),this.removeTemporaryItem(this.generateCacheKey(q.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(q.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(q.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(q.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(q.NATIVE_REQUEST)),this.setInteractionInProgress(!1,void 0)}cacheAuthorizeRequest(e,t,r){this.logger.trace("1tzef5",t);let o=Ot(JSON.stringify(e));if(this.setTemporaryCache(q.REQUEST_PARAMS,o,!0),r){let i=Ot(r);this.setTemporaryCache(q.VERIFIER,i,!0)}}getCachedRequest(e){this.logger.trace("0uen20",e);let t=this.getTemporaryCache(q.REQUEST_PARAMS,e,!0);if(!t)throw C(Lc);let r=this.getTemporaryCache(q.VERIFIER,e,!0),o,i="";try{o=JSON.parse($(t)),r&&(i=$(r))}catch{throw this.logger.errorPii("0ewsey",e),this.logger.error("0tvdic",e),C(Hc)}return[o,i]}getCachedNativeRequest(){this.logger.trace("1yxcdm","");let e=this.getTemporaryCache(q.NATIVE_REQUEST,"",!0);if(!e)return this.logger.trace("0mnxd4",""),null;let t=this.validateAndParseJson(e);return t||(this.logger.error("0rrkip",""),null)}isInteractionInProgress(e){let t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){let e=`${re}.${q.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,"",!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("0jjyys",""),this.removeTemporaryItem(e),this.resetRequestCache(""),Xo(window),null}}setInteractionInProgress(e,t=De.SIGNIN,r=!1,o=""){let i=`${re}.${q.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())if(r)this.logger.warning("1pmscr",o),dl(this.logger,o),this.removeTemporaryItem(i);else throw C(vc);this.setTemporaryCache(i,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&this.getInteractionInProgress()?.clientId===this.clientId&&this.removeTemporaryItem(i)}hydrateCache(e,t){return h(this,null,function*(){let r=V.createIdTokenEntity(e.account.homeAccountId,e.account.environment,e.idToken,this.clientId,e.tenantId),o=V.createAccessTokenEntity(e.account.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?P.toSecondsFromDate(e.expiresOn):0,e.extExpiresOn?P.toSecondsFromDate(e.extExpiresOn):0,$,void 0,e.tokenType,void 0,t.sshKid),i={idToken:r,accessToken:o};return this.saveCacheRecord(i,e.correlationId,D.isKmsi(D.extractTokenClaims(e.idToken,$)),k.hydrateCache)})}saveCacheRecord(e,t,r,o,i){return h(this,null,function*(){try{yield Ml(n.prototype,this,"saveCacheRecord").call(this,e,t,r,o,i)}catch(s){if(s instanceof Je&&this.performanceClient&&t)try{let a=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},t)}catch{}throw s}})}};function Sd(n,e,t,r){try{switch(e){case Z.LocalStorage:return new sn(n,t,r);case Z.SessionStorage:return new an;case Z.MemoryStorage:default:break}}catch(o){t.error(o,"")}return new Ze}var pi=(n,e,t,r)=>{let o={cacheLocation:Z.MemoryStorage,cacheRetentionDays:5};return new tt(n,o,qe,e,t,r)};function fi(n,e,t,r,o){return n.verbose("1yd030",r),t?e.getAllAccounts(o,r):[]}function cn(n,e,t,r){if(e.trace("0u7b90",r),Object.keys(n).length===0)return e.warning("1kz0cu",r),null;let o=t.getAccountInfoFilteredBy(n,r);return o?(e.verbose("0btgll",r),o):(e.verbose("0ltaj5",r),null)}function gi(n,e,t){e.setActiveAccount(n,t)}function Ci(n,e){return n.getActiveAccount(e)}var Op="msal.broadcast.event",Ct=class{constructor(e){this.eventCallbacks=new Map,this.logger=e||new U({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(Op)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if(typeof window<"u"){let o=r||Fr();return this.eventCallbacks.has(o)?(this.logger.error("1578i0",""),null):(this.eventCallbacks.set(o,[e,t||[]]),this.logger.verbose("1cnec4",""),o)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("12zotd","")}emitEvent(e,t,r,o,i){let s={eventType:e,interactionType:r||null,payload:o||null,error:i||null,correlationId:t,timestamp:Date.now()};switch(e){case A.LOGIN_SUCCESS:case A.LOGOUT_SUCCESS:case A.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(s)}this.invokeCallbacks(s)}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],o)=>{(r.length===0||r.includes(e.eventType))&&(this.logger.verbose("15jpwk",""),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){let t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}};var qr=class{constructor(e,t,r,o,i,s,a,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=s,this.platformAuthProvider=l,this.correlationId=c,this.logger=o.clone(X.MSAL_SKU,W),this.performanceClient=a}};function lr(n,e,t,r){t.verbose("0bd1la",r);let o=n||e||"";return b.getAbsoluteUrl(o,Ie())}function ee(n,e,t,r,o,i){o.verbose("1p12tq",t);let s={clientId:e,correlationId:t,apiId:n,forceRefresh:!1,wrapperSKU:r.getWrapperMetadata()[0],wrapperVer:r.getWrapperMetadata()[1]};return new rr(s,r)}function Ee(n,e,t,r,o,i,s,a,c){return h(this,null,function*(){let l=a&&a.hasOwnProperty("instance_aware")?a.instance_aware:void 0,d={protocolMode:n.system.protocolMode,OIDCOptions:n.auth.OIDCOptions,knownAuthorities:n.auth.knownAuthorities,cloudDiscoveryMetadata:n.auth.cloudDiscoveryMetadata,authorityMetadata:n.auth.authorityMetadata},u=i||n.auth.authority,g=l?.length?l==="true":n.auth.instanceAware,E=c&&g?n.auth.authority.replace(b.getDomainFromUrl(u),c.environment):u,S=Ue.generateAuthority(E,s||n.auth.azureCloudOptions),_=yield m(Or.createDiscoveredInstance,Qh,o,t,e)(S,n.system.networkClient,r,d,o,e,t);if(c&&!_.isAlias(c.environment))throw v(ge.authorityMismatch);return _})}function Wr(n,e,t,r,o){return h(this,null,function*(){if(o)try{n.removeAccount(o,r),t.verbose("0s4z6h",r)}catch{t.error("0mgg1d",r)}else try{t.verbose("0zj631",r),n.clear(r),yield e.clearKeystore(r)}catch{t.error("12ih0c",r)}})}function ln(n,e,t,r,o){return h(this,null,function*(){let i=n.authority||e.auth.authority,s=[...n&&n.scopes||[]],a=I(f({},n),{correlationId:n.correlationId,authority:i,scopes:s});if(!a.authenticationScheme)a.authenticationScheme=y.AuthenticationScheme.BEARER,r.verbose("1l4fwv",o);else{if(a.authenticationScheme===y.AuthenticationScheme.SSH){if(!n.sshJwk)throw v(ge.missingSshJwk);if(!n.sshKid)throw v(ge.missingSshKid)}r.verbose("1ecmns",o)}return a})}function _d(n,e,t,r,o){return h(this,null,function*(){let i=yield m(ln,Kr,o,r,n.correlationId)(n,t,r,o,n.correlationId);return I(f(f({},n),i),{account:e,forceRefresh:n.forceRefresh||!1})})}function Ei(n,e){let t,r=n.httpMethod;if(e===H.EAR){if(r&&r!==y.HttpMethod.POST)throw v(ge.invalidRequestMethodForEAR);t=y.HttpMethod.POST}else t=r||y.HttpMethod.GET;return t}var ye=class extends qr{initializeLogoutRequest(e){this.logger.verbose("0546u4",this.correlationId);let t=f({correlationId:this.correlationId},e);if(e)if(e.logoutHint)this.logger.verbose("12k4l4",this.correlationId);else if(e.account){let r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("0st5di",this.correlationId),t.logoutHint=r)}else this.logger.verbose("0pdtc3",this.correlationId);else this.logger.verbose("07ndze",this.correlationId);return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("1vamm6",t.correlationId),t.postLogoutRedirectUri=b.getAbsoluteUrl(e.postLogoutRedirectUri,Ie())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("15m5g7",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("1f4xlz",t.correlationId),t.postLogoutRedirectUri=b.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Ie())):(this.logger.verbose("17s5rf",t.correlationId),t.postLogoutRedirectUri=b.getAbsoluteUrl(Ie(),Ie())):this.logger.verbose("0ljv63",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){let t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("0mvp54",this.correlationId)}else this.logger.verbose("1e7bdp",this.correlationId);return null}createAuthCodeClient(e){return h(this,null,function*(){let t=yield m(this.getClientConfiguration.bind(this),Mt,this.logger,this.performanceClient,this.correlationId)(e);return new tr(t,this.performanceClient)})}getClientConfiguration(e){return h(this,null,function*(){let{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:s}=e,a=e.authority||(yield m(Ee,He,this.logger,this.performanceClient,this.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,o,i,s)),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:X.MSAL_SKU,version:W,cpu:"",os:""},telemetry:this.config.telemetry}})}};function Ut(n,e,t,r,o,i,s,a){return h(this,null,function*(){let c=lr(n.redirectUri,t.auth.redirectUri,i,a),l={interactionType:e},d=Me.setRequestState(r,n&&n.state||"",l),u=yield m(ln,Kr,i,s,a)(I(f({},n),{correlationId:a}),t,s,i,a),g=I(f({},u),{redirectUri:c,state:d,nonce:n.nonce||O(),responseMode:t.auth.OIDCOptions.responseMode}),E=I(f({},g),{httpMethod:Ei(g,t.system.protocolMode)});if(n.loginHint||n.sid)return E;let S=n.account||o.getActiveAccount(a);return S&&(i.verbose("1eqlb3",a),i.verbosePii("0tf99t",a),E.account=S),E})}function kd(n,e){if(!e)return null;try{return Me.parseRequestState(n.base64Decode,e).libraryState.meta}catch{throw p(N.invalidState)}}function hr(n,e,t,r){let o=_e.getDeserializedResponse(n);if(!o)throw _e.stripLeadingHashOrQuery(n)?(t.error("13pl0s",r),t.errorPii("1097vx",r),C(kc)):(t.error("18h0l1",r),C(_c));return o}function Rd(n,e,t){if(!n.state)throw C(nr);let r=kd(e,n.state);if(!r)throw C(jo);if(r.interactionType!==t)throw C(Rc)}var Jr=class{constructor(e,t,r,o,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=o,this.performanceClient=i}handleCodeResponse(e,t,r){return h(this,null,function*(){let o;try{o=Ye.getAuthorizationCodePayload(e,t.state)}catch(i){throw i instanceof le&&i.subError===Mr?C(Mr):i}return m(this.handleCodeResponseFromServer.bind(this),se.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(o,t,r)})}handleCodeResponseFromServer(e,t,r,o=!0){return h(this,null,function*(){if(this.logger.trace("0mf2hb",t.correlationId),this.authCodeRequest.code=e.code,o&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{let s=this.createCcsCredentials(t);s&&(this.authCodeRequest.ccsCredential=s)}return yield m(this.authModule.acquireToken.bind(this.authModule),$h,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,r,e)})}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:ue.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:ue.UPN}:null}};var vd="ContentError",bd="PageException",Od="user_switch",Pd="unsupported_method";var Nd="USER_INTERACTION_REQUIRED",Md="USER_CANCEL",xd="NO_NETWORK",Ud="PERSISTENT_ERROR",Dd="DISABLED",Ld="ACCOUNT_UNAVAILABLE",Hd="UX_NOT_ALLOWED";var Pp=-2147186943,be=class n extends w{constructor(e,t,r){super(e,t||Pr(e)),Object.setPrototypeOf(this,n.prototype),this.name="NativeAuthError",this.ext=r}};function Dt(n){if(n.ext&&n.ext.status&&(n.ext.status===Ud||n.ext.status===Dd)||n.ext&&n.ext.error&&n.ext.error===Pp)return!0;switch(n.errorCode){case vd:case bd:return!0;default:return!1}}function dr(n,e,t){if(t&&t.status)switch(t.status){case Ld:return Yt(Qe.nativeAccountUnavailable,Pr(n));case Nd:return new J(n,e);case Md:return C(Mr);case xd:return C(xr);case Hd:return Yt(Qe.uxNotAllowed)}return new be(n,e,t)}var $r=class extends ye{acquireToken(e){return h(this,null,function*(){let t=ee(k.acquireTokenSilent_silentFlow,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=yield m(this.getClientConfiguration.bind(this),Mt,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new Fo(r,this.performanceClient);this.logger.verbose("0wa871",this.correlationId);try{let s=(yield m(o.acquireCachedToken.bind(o),qh,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(i){throw i instanceof bt&&i.errorCode===Wo&&this.logger.verbose("06wena",this.correlationId),i}})}logout(e){this.logger.verbose("1rkurh",this.correlationId);let t=this.initializeLogoutRequest(e);return Wr(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account)}};var Lt=class extends qr{constructor(e,t,r,o,i,s,a,c,l,d,u,g){super(e,t,r,o,i,s,c,g,l),this.apiId=a,this.accountId=d,this.platformAuthProvider=l,this.nativeStorageManager=u,this.silentCacheClient=new $r(e,this.nativeStorageManager,r,o,i,s,c,g,l);let E=this.platformAuthProvider.getExtensionName();this.skus=rr.makeExtraSkuString({libraryName:X.MSAL_SKU,libraryVersion:W,extensionName:E,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters=I(f({},e.extraParameters),{[rt.X_CLIENT_EXTRA_SKU]:this.skus})}acquireToken(e,t){return h(this,null,function*(){this.logger.trace("03qeos",this.correlationId);let r=this.performanceClient.startMeasurement(ci,e.correlationId),o=P.nowSeconds(),i=ee(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{let s=yield this.initializeNativeRequest(e);try{let c=yield this.acquireTokensFromCache(this.accountId,s);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),c}catch(c){if(t===j.AccessToken)throw this.logger.info("0eitbc",this.correlationId),c;this.logger.info("0957j1",this.correlationId)}let a=yield this.platformAuthProvider.sendMessage(s);return yield this.handleNativeResponse(a,s,o).then(c=>(r.end({success:!0,isNativeBroker:!0,requestId:c.requestId}),i.clearNativeBrokerErrorCode(),c)).catch(c=>{throw r.end({success:!1,errorCode:c.errorCode,subErrorCode:c.subError,isNativeBroker:!0}),c})}catch(s){throw s instanceof be&&i.setNativeBrokerErrorCode(s.errorCode),s}})}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:G.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){return h(this,null,function*(){if(!e)throw this.logger.warning("1ndf3e",this.correlationId),p(N.noAccountFound);let r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw p(N.noAccountFound);try{let o=this.createSilentCacheRequest(t,r),i=yield this.silentCacheClient.acquireToken(o),s=I(f({},r),{idTokenClaims:i?.idTokenClaims,idToken:i?.idToken});return I(f({},i),{account:s})}catch(o){throw o}})}acquireTokenRedirect(e,t,r){return h(this,null,function*(){this.logger.trace("0luikq",this.correlationId);let o=yield this.initializeNativeRequest(e),i=r?.navigateToLoginRequestUrl??!0;try{yield this.platformAuthProvider.sendMessage(o)}catch(c){if(c instanceof be&&(ee(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).setNativeBrokerErrorCode(c.errorCode),Dt(c)))throw c}this.browserStorage.setTemporaryCache(q.NATIVE_REQUEST,JSON.stringify(o),!0);let s={apiId:k.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=i?window.location.href:lr(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId);t.end({success:!0}),yield this.navigationClient.navigateExternal(a,s)})}handleRedirectPromise(e,t){return h(this,null,function*(){if(this.logger.trace("1c5lhw",this.correlationId),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",this.correlationId),null;let r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("0a6zjb",this.correlationId),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;let a=r,{prompt:o}=a,i=It(a,["prompt"]);o&&this.logger.verbose("0ac34v",this.correlationId),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(q.NATIVE_REQUEST));let s=P.nowSeconds();try{this.logger.verbose("003x5a",this.correlationId);let c=yield this.platformAuthProvider.sendMessage(i),l=yield this.handleNativeResponse(c,i,s);return ee(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).clearNativeBrokerErrorCode(),l}catch(c){throw c}})}logout(){return this.logger.trace("0u2sjm",this.correlationId),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,r){return h(this,null,function*(){this.logger.trace("1bojln",this.correlationId);let o=D.extractTokenClaims(e.id_token,$),i=this.createHomeAccountIdentifier(e,o),s=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("1ub1in",this.correlationId);else if(i!==s&&e.account.id!==t.accountId)throw dr(Od);let a=yield Ee(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t.authority),c=vr(this.browserStorage,a,i,$,this.correlationId,o,e.client_info,void 0,o.tid,void 0,e.account.id);e.expires_in=Number(e.expires_in);let l=yield this.generateAuthenticationResult(e,t,o,c,a.canonicalAuthority,r);return yield this.cacheAccount(c,D.isKmsi(o)),yield this.cacheNativeTokens(e,t,i,o,e.access_token,l.tenantId,r),l})}createHomeAccountIdentifier(e,t){return ie.generateHomeAccountId(e.client_info||"",me.Default,this.logger,this.browserCrypto,this.correlationId,t)}generateScopes(e,t){return t?G.fromString(t):G.fromString(e)}generatePopAccessToken(e,t){return h(this,null,function*(){if(t.tokenType===y.AuthenticationScheme.POP&&t.signPopToken){if(e.shr)return this.logger.trace("0coqhu",this.correlationId),e.shr;let r=new de(this.browserCrypto,this.performanceClient),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce,correlationId:this.correlationId};if(!t.keyId)throw p(N.keyIdMissing);return r.signPopToken(e.access_token,t.keyId,o)}else return e.access_token})}generateAuthenticationResult(e,t,r,o,i,s){return h(this,null,function*(){let a=this.addTelemetryFromNativeResponse(e.properties.MATS),c=this.generateScopes(t.scope,e.scope),l=e.account.properties||{},d=l.UID||r.oid||r.sub||"",u=l.TenantId||r.tid||"",g=$t(ie.getAccountInfo(o),void 0,r,e.id_token);g.nativeAccountId!==e.account.id&&(g.nativeAccountId=e.account.id);let E=yield this.generatePopAccessToken(e,t),S=t.tokenType===y.AuthenticationScheme.POP?y.AuthenticationScheme.POP:y.AuthenticationScheme.BEARER;return{authority:i,uniqueId:d,tenantId:u,scopes:c.asArray(),account:g,idToken:e.id_token,idTokenClaims:r,accessToken:E,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:P.toDateFromSeconds(s+e.expires_in),tokenType:S,correlationId:this.correlationId,state:e.state,fromPlatformBroker:!0}})}cacheAccount(e,t){return h(this,null,function*(){yield this.browserStorage.setAccount(e,this.correlationId,t,this.apiId),this.browserStorage.removeAccountContext(ie.getAccountInfo(e),this.correlationId)})}cacheNativeTokens(e,t,r,o,i,s,a){let c=V.createIdTokenEntity(r,t.authority,e.id_token||"",t.clientId,o.tid||""),l=t.tokenType===y.AuthenticationScheme.POP?y.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,d=a+l,u=this.generateScopes(e.scope,t.scope),g=V.createAccessTokenEntity(r,t.authority,i,t.clientId,o.tid||s,u.printScopes(),d,0,$,void 0,t.tokenType,void 0,t.keyId),E={idToken:c,accessToken:g};return this.nativeStorageManager.saveCacheRecord(E,this.correlationId,D.isKmsi(o),this.apiId,t.storeInCache)}getExpiresInValue(e,t){return e===y.AuthenticationScheme.POP?y.SHR_NONCE_VALIDITY:(typeof t=="string"?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){let t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch{this.logger.error("0b3l57",this.correlationId)}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("1okqev",this.correlationId),!1):!!e.is_cached}initializeNativeRequest(e){return h(this,null,function*(){this.logger.trace("04j6wj",this.correlationId);let t=yield this.getCanonicalAuthority(e),a=e,{scopes:r}=a,o=It(a,["scopes"]),i=new G(r||[]);i.appendScopes(y.OIDC_DEFAULT_SCOPES);let s=I(f({},o),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:i.printScopes(),redirectUri:lr(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:f({},e.extraParameters),extendedExpiryToken:!1,keyId:e.popKid});if(s.signPopToken&&e.popKid)throw C(Qc);if(this.handleExtraBrokerParams(s),s.extraParameters=s.extraParameters||{},s.extraParameters.telemetry=pe.MATS_TELEMETRY,e.authenticationScheme===y.AuthenticationScheme.POP){let c={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce,correlationId:this.correlationId},l=new de(this.browserCrypto,this.performanceClient),d;if(s.keyId)d=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:s.keyId})),s.signPopToken=!1;else{let u=yield m(l.generateCnf.bind(l),se.PopTokenGenerateCnf,this.logger,this.performanceClient,this.correlationId)(c,this.logger);d=u.reqCnfString,s.keyId=u.kid,s.signPopToken=!0}s.reqCnf=d}return this.addRequestSKUs(s),s})}getCanonicalAuthority(e){return h(this,null,function*(){let t=e.authority||this.config.auth.authority,{azureCloudOptions:r,account:o}=e;o&&(yield Ee(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t,r,void 0,o));let i=new b(t);return i.validateAsUri(),i})}getPrompt(e){switch(this.apiId){case k.ssoSilent:case k.acquireTokenSilent_silentFlow:return this.logger.trace("1hiwaz",this.correlationId),y.PromptValue.NONE}if(!e){this.logger.trace("1qlu04",this.correlationId);return}switch(e){case y.PromptValue.NONE:case y.PromptValue.CONSENT:case y.PromptValue.LOGIN:return this.logger.trace("1ynje4",this.correlationId),e;default:throw this.logger.trace("0nkr6q",this.correlationId),C(Jc)}}handleExtraBrokerParams(e){let t=e.extraParameters&&e.extraParameters.hasOwnProperty(rt.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(rt.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(rt.CLIENT_ID);if(!e.embeddedClientId&&!t)return;let r="",o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[rt.BROKER_REDIRECT_URI],r=e.extraParameters[rt.CLIENT_ID]),e.extraParameters={child_client_id:r,child_redirect_uri:o},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:o},e.correlationId)}};function kl(n,e,t,r,o){return h(this,null,function*(){let i=Ye.getStandardAuthorizeRequestParameters(I(f({},n.auth),{authority:e}),t,r,o);if(x.addLibraryInfo(i,{sku:X.MSAL_SKU,version:W,os:"",cpu:""}),n.system.protocolMode!==H.OIDC&&x.addApplicationTelemetry(i,n.telemetry.application),t.platformBroker&&(x.addNativeBroker(i),t.authenticationScheme===y.AuthenticationScheme.POP)){let s=new ve(r,o),a=new de(s,o),c;t.popKid?c=s.encodeKid(t.popKid):c=(yield m(a.generateCnf.bind(a),se.PopTokenGenerateCnf,r,o,t.correlationId)(t,r)).reqCnfString,x.addPopToken(i,c)}return x.instrumentBrokerParams(i,t.correlationId,o),i})}function Qr(n,e,t,r,o){return h(this,null,function*(){if(!t.codeChallenge)throw v(ge.pkceParamsMissing);let i=yield m(kl,Wh,r,o,t.correlationId)(n,e,t,r,o);return x.addResponseType(i,y.OAuthResponseType.CODE),x.addCodeChallengeParams(i,t.codeChallenge,y.S256_CODE_CHALLENGE_METHOD),x.addExtraParameters(i,f(f({},t.extraQueryParameters),t.extraParameters)),Ye.getAuthorizeUrl(e,i)})}function Yr(n,e,t,r,o,i){return h(this,null,function*(){if(!r.earJwk)throw C(ti);let s=yield kl(e,t,r,o,i);x.addResponseType(s,y.OAuthResponseType.IDTOKEN_TOKEN_REFRESHTOKEN),x.addEARParameters(s,r.earJwk),x.addCodeChallengeParams(s,r.codeChallenge,y.S256_CODE_CHALLENGE_METHOD),x.addExtraParameters(s,f({},r.extraParameters));let a=new Map;x.addExtraParameters(a,r.extraQueryParameters||{}),x.addCorrelationId(a,r.correlationId);let c=Ye.getAuthorizeUrl(t,a);return Fd(n,c,s)})}function Xr(n,e,t,r,o,i){return h(this,null,function*(){let s=yield kl(e,t,r,o,i);x.addResponseType(s,y.OAuthResponseType.CODE),x.addCodeChallengeParams(s,r.codeChallenge,r.codeChallengeMethod||y.S256_CODE_CHALLENGE_METHOD),x.addExtraParameters(s,f({},r.extraParameters));let a=new Map;x.addExtraParameters(a,r.extraQueryParameters||{}),x.addCorrelationId(a,r.correlationId);let c=Ye.getAuthorizeUrl(t,a);return Fd(n,c,s)})}function Fd(n,e,t){let r=n.createElement("form");return r.method="post",r.action=e,t.forEach((o,i)=>{let s=n.createElement("input");s.hidden=!0,s.name=i,s.value=o,r.appendChild(s)}),n.body.appendChild(r),r}function Kd(n,e,t,r,o,i,s,a,c,l){return h(this,null,function*(){if(a.verbose("11qcow",n.correlationId),!l)throw C($o);let d=new ve(a,c),u=new Lt(r,o,d,a,s,r.system.navigationClient,t,c,l,e,i,n.correlationId),{userRequestState:g}=Me.parseRequestState(d.base64Decode,n.state);return m(u.acquireToken.bind(u),ci,a,c,n.correlationId)(I(f({},n),{state:g,prompt:void 0}))})}function Et(n,e,t,r,o,i,s,a,c,l,d,u){return h(this,null,function*(){if(ht.removeThrottle(s,o.auth.clientId,n),e.accountId)return m(Kd,fl,l,d,n.correlationId)(n,e.accountId,r,o,s,a,c,l,d,u);let g=I(f({},n),{code:e.code||"",codeVerifier:t}),E=new Jr(i,s,g,l,d);return yield m(E.handleCodeResponse.bind(E),Jh,l,d,n.correlationId)(e,n,r)})}function Zr(n,e,t,r,o,i,s,a,c,l,d){return h(this,null,function*(){if(ht.removeThrottle(i,r.auth.clientId,n),Ye.validateAuthorizationResponse(e,n.state),!e.ear_jwe)throw C(Sc);if(!n.earJwk)throw C(ti);let u=JSON.parse(yield m(Ih,hd,c,l,n.correlationId)(n.earJwk,e.ear_jwe));if(u.accountId)return m(Kd,fl,c,l,n.correlationId)(n,u.accountId,t,r,i,s,a,c,l,d);let g=new xe(r.auth.clientId,i,new ve(c,l),c,l,null,null);g.validateTokenResponse(u,n.correlationId);let E={code:"",state:n.state,nonce:n.nonce,client_info:u.client_info,cloud_graph_host_name:u.cloud_graph_host_name,cloud_instance_host_name:u.cloud_instance_host_name,cloud_instance_name:u.cloud_instance_name,msgraph_host:u.msgraph_host};return yield m(g.handleServerTokenResponse.bind(g),se.HandleServerTokenResponse,c,l,n.correlationId)(u,o,P.nowSeconds(),n,t,E,void 0,void 0,void 0,void 0)})}var Np=32;function Be(n,e,t){return h(this,null,function*(){let r=te(Mp,rd,e,n,t)(n,e,t),o=yield m(xp,od,e,n,t)(r,n,e,t);return{verifier:r,challenge:o}})}function Mp(n,e,t){try{let r=new Uint8Array(Np);return te(Eh,id,e,n,t)(r),Re(r)}catch{throw C(ei)}}function xp(n,e,t,r){return h(this,null,function*(){try{let o=yield m(il,nd,t,e,r)(n);return Re(new Uint8Array(o))}catch{throw C(ei)}})}var hn=class n{navigateInternal(e,t){return n.defaultNavigateWindow(e,t)}navigateExternal(e,t){return n.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((r,o)=>{setTimeout(()=>{o(C(Pt,"failed_to_redirect"))},t.timeout)})}};var yi=class{sendGetRequestAsync(e,t){return h(this,null,function*(){let r,o={},i=0,s=Bd(t);try{r=yield fetch(e,{method:Ic.GET,headers:s})}catch(a){throw Zt(C(window.navigator.onLine?Kc:xr),void 0,void 0,a)}o=zd(r.headers);try{return i=r.status,{headers:o,body:yield r.json(),status:i}}catch(a){throw Zt(C(oi),i,o,a)}})}sendPostRequestAsync(e,t){return h(this,null,function*(){let r=t&&t.body||"",o=Bd(t),i,s=0,a={};try{i=yield fetch(e,{method:Ic.POST,headers:o,body:r})}catch(c){throw Zt(C(window.navigator.onLine?Fc:xr),void 0,void 0,c)}a=zd(i.headers);try{return s=i.status,{headers:a,body:yield i.json(),status:s}}catch(c){throw Zt(C(oi),s,a,c)}})}};function Bd(n){try{let e=new Headers;if(!(n&&n.headers))return e;let t=n.headers;return Object.entries(t).forEach(([r,o])=>{e.append(r,o)}),e}catch(e){throw Zt(C(Yc),void 0,void 0,e)}}function zd(n){try{let e={};return n.forEach((t,r)=>{e[r]=t}),e}catch{throw C(Xc)}}var Up=6e4,Gd=1e4,Dp=3e4,Rl=2e3;function Ai({auth:n,cache:e,system:t,telemetry:r},o){let i={clientId:"",authority:`${y.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:"",authorityMetadata:"",redirectUri:typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:"",postLogoutRedirectUri:"",clientCapabilities:[],OIDCOptions:{responseMode:y.ResponseMode.FRAGMENT,defaultScopes:[y.OPENID_SCOPE,y.PROFILE_SCOPE,y.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Rt.None,tenant:""},instanceAware:!1},s={cacheLocation:Z.SessionStorage,cacheRetentionDays:5},a={loggerCallback:()=>{},logLevel:M.Info,piiLoggingEnabled:!1},c=I(f({},Ln),{loggerOptions:a,networkClient:o?new yi:Ec,navigationClient:new hn,popupBridgeTimeout:t?.popupBridgeTimeout||Up,iframeBridgeTimeout:t?.iframeBridgeTimeout||Gd,redirectNavigationTimeout:Dp,allowRedirectInIframe:!1,navigatePopups:!0,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||Rl,protocolMode:H.AAD}),l=I(f(f({},c),t),{loggerOptions:t?.loggerOptions||a}),d={application:{appName:"",appVersion:""},client:new Ce};if(t?.protocolMode!==H.OIDC&&n?.OIDCOptions&&new U(l.loggerOptions).warning(JSON.stringify(v(ge.cannotSetOIDCOptions)),""),t?.protocolMode&&t.protocolMode===H.OIDC&&l?.allowPlatformBroker)throw v(ge.cannotAllowPlatformBroker);return{auth:I(f(f({},i),n),{OIDCOptions:f(f({},i.OIDCOptions),n?.OIDCOptions)}),cache:f(f({},s),e),system:l,telemetry:f(f({},d),r)}}var Ti=class n{constructor(e,t,r,o){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(ed),this.platformAuthType=pe.PLATFORM_EXTENSION_PROVIDER}sendMessage(e){return h(this,null,function*(){this.logger.trace("0on4p2",e.correlationId);let t={method:Nr.GetToken,request:e},r={channel:pe.CHANNEL_ID,extensionId:this.extensionId,responseId:O(),body:t};this.logger.trace("1qadfi",e.correlationId),this.logger.tracePii("1xm533",e.correlationId),this.messageChannel.port1.postMessage(r);let o=yield new Promise((s,a)=>{this.resolvers.set(r.responseId,{resolve:s,reject:a})});return this.validatePlatformBrokerResponse(o)})}static createProvider(e,t,r,o){return h(this,null,function*(){e.trace("15zfnw",o);try{let i=new n(e,t,r,pe.PREFERRED_EXTENSION_ID);return yield i.sendHandshakeRequest(o),i}catch{let s=new n(e,t,r);return yield s.sendHandshakeRequest(o),s}})}sendHandshakeRequest(e){return h(this,null,function*(){this.logger.trace("1dpg9o",e),window.addEventListener("message",this.windowListener,!1);let t={channel:pe.CHANNEL_ID,extensionId:this.extensionId,responseId:O(),body:{method:Nr.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=r=>{this.onChannelMessage(r)},window.postMessage(t,window.origin,[this.messageChannel.port2]),new Promise((r,o)=>{this.handshakeResolvers.set(t.responseId,{resolve:r,reject:o}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),o(C(qc)),this.handshakeResolvers.delete(t.responseId)},this.handshakeTimeoutMs)})})}onWindowMessage(e){let t=Fr();if(this.logger.trace("0jpn5u",t),e.source!==window)return;let r=e.data;if(!(!r.channel||r.channel!==pe.CHANNEL_ID)&&!(r.extensionId&&r.extensionId!==this.extensionId)&&r.body.method===Nr.HandshakeRequest){let o=this.handshakeResolvers.get(r.responseId);if(!o){this.logger.trace("07buhm",t);return}this.logger.verbose(r.extensionId?"0xrkug":"No extension installed",t),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),o.reject(C(Wc))}}onChannelMessage(e){let t=Fr();this.logger.trace("1py8yf",t);let r=e.data,o=this.resolvers.get(r.responseId),i=this.handshakeResolvers.get(r.responseId);try{let s=r.body.method;if(s===Nr.Response){if(!o)return;let a=r.body.response;if(this.logger.trace("19hpgm",t),this.logger.tracePii("179a24",t),a.status!=="Success")o.reject(dr(a.code,a.description,a.ext));else if(a.result)a.result.code&&a.result.description?o.reject(dr(a.result.code,a.result.description,a.result.ext)):o.resolve(a.result);else throw yr(vt.unexpectedError,"Event does not contain result.");this.resolvers.delete(r.responseId)}else if(s===Nr.HandshakeResponse){if(!i){this.logger.trace("082qnt",t);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=r.extensionId,this.extensionVersion=r.body.version,this.logger.verbose("0yf5ib",t),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),i.resolve(),this.handshakeResolvers.delete(r.responseId)}}catch(s){this.logger.error("0xf978",t),this.logger.errorPii("04i99o",t),this.logger.errorPii("0xdvsy",t),o?o.reject(s):i&&i.reject(s)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw yr(vt.unexpectedError,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===pe.PREFERRED_EXTENSION_ID?"chrome":this.getExtensionId()?.length?"unknown":void 0}};var Ii=class n{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType=pe.PLATFORM_DOM_PROVIDER}static createProvider(e,t,r){return h(this,null,function*(){if(e.trace("12mj4a",r),window.navigator?.platformAuthentication&&(yield window.navigator.platformAuthentication.getSupportedContracts(pe.MICROSOFT_ENTRA_BROKERID))?.includes(pe.PLATFORM_DOM_APIS))return e.trace("1h5q1r",r),new n(e,t,r)})}getExtensionId(){return pe.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return pe.DOM_API_NAME}sendMessage(e){return h(this,null,function*(){this.logger.trace("02bcil",e.correlationId);try{let t=this.initializePlatformDOMRequest(e),r=yield window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r,e.correlationId)}catch(t){throw this.logger.error("11im7g",e.correlationId),t}})}initializePlatformDOMRequest(e){this.logger.trace("15d6yv",e.correlationId);let _=e,{accountId:t,clientId:r,authority:o,scope:i,redirectUri:s,correlationId:a,state:c,storeInCache:l,embeddedClientId:d,extraParameters:u}=_,g=It(_,["accountId","clientId","authority","scope","redirectUri","correlationId","state","storeInCache","embeddedClientId","extraParameters"]),E=this.getDOMExtraParams(g);return{accountId:t,brokerId:this.getExtensionId(),authority:o,clientId:r,correlationId:a||this.correlationId,extraParameters:f(f({},u),E),isSecurityTokenService:!1,redirectUri:s,scope:i,state:c,storeInCache:l,embeddedClientId:d}}validatePlatformBrokerResponse(e,t){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace("0h4vei",t),this.convertToPlatformBrokerResponse(e,t);if(e.hasOwnProperty("error")){let r=e;if(r.isSuccess===!1&&r.error&&r.error.code)throw this.logger.trace("0g92vm",t),dr(r.error.code,r.error.description,{error:parseInt(r.error.errorCode),protocol_error:r.error.protocolError,status:r.error.status,properties:r.error.properties})}}throw yr(vt.unexpectedError,"Response missing expected properties.")}convertToPlatformBrokerResponse(e,t){return this.logger.trace("14913t",t),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){let t=Object.entries(e).reduce((o,[i,s])=>(o[i]=String(s),o),{});return f({},t)}};function Lp(n,e,t){return h(this,null,function*(){let r=new U(n||{},ft,W),o=t||"";r.trace("07660b",o);let i=e||new Ce;return typeof window>"u"?(r.trace("082ed3",o),!1):!!(yield vl(r,i,o))})}function vl(n,e,t,r){return h(this,null,function*(){n.trace("134j0v",t);let o=Hp();n.trace("04c81g",t);let i;try{o&&(i=yield Ii.createProvider(n,e,t)),i||(n.trace("0l3na8",t),i=yield Ti.createProvider(n,r||Rl,e,t))}catch(s){n.trace("0icbd7",s)}return i})}function Hp(){let n;try{return n=window[Z.SessionStorage],n?.getItem(Id)==="true"}catch{return!1}}function yt(n,e,t,r,o){if(e.trace("0uko3r",t),!n.system.allowPlatformBroker)return e.trace("04hozs",t),!1;if(!r)return e.trace("0kvv1r",t),!1;if(o)switch(o){case y.AuthenticationScheme.BEARER:case y.AuthenticationScheme.POP:return e.trace("18tev1",t),!0;default:return e.trace("1dd2nh",t),!1}return!0}var wi=class extends ye{constructor(e,t,r,o,i,s,a,c,l,d){super(e,t,r,o,i,s,a,l,d),this.nativeStorage=c,this.eventHandler=i}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||y.OIDC_DEFAULT_SCOPES,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:!this.config.system.navigatePopups},this.correlationId),this.config.system.navigatePopups){let i=I(f({},e),{httpMethod:Ei(e,this.config.system.protocolMode)});return this.logger.verbose("1f9ok3",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(i,r,t)}else return this.logger.verbose("162h4u",this.correlationId),this.acquireTokenPopupAsync(e,r,t)}catch(o){return Promise.reject(o)}}logout(e){try{this.logger.verbose("068rup",this.correlationId);let t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},o=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.navigatePopups?(this.logger.verbose("1a28da",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,o,i)):(this.logger.verbose("1phd8u",this.correlationId),this.logoutPopupAsync(t,r,o,i))}catch(t){return Promise.reject(t)}}acquireTokenPopupAsync(e,t,r){return h(this,null,function*(){this.logger.verbose("1g77pg",this.correlationId);let o=yield m(Ut,xt,this.logger,this.performanceClient,this.correlationId)(e,T.Popup,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.popup&&en(o.authority);let i=yt(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);return o.platformBroker=i,this.config.system.protocolMode===H.EAR?this.executeEarFlow(o,t,r):this.executeCodeFlow(o,t,r)})}executeCodeFlow(e,t,r){return h(this,null,function*(){let o=e.correlationId,i=ee(k.acquireTokenPopup,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=r||(yield m(Be,Ke,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o)),a=I(f({},e),{codeChallenge:s.challenge});try{let c=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,o)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account});if(a.httpMethod===y.HttpMethod.POST)return yield this.executeCodeFlowWithPost(a,t,c,s.verifier);{let l=yield m(Qr,se.GetAuthCodeUrl,this.logger,this.performanceClient,o)(this.config,c.authority,a,this.logger,this.performanceClient),d=this.initiateAuthRequest(l,t);this.eventHandler.emitEvent(A.POPUP_OPENED,o,T.Popup,{popupWindow:d},null);let u=yield dt(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),g=te(hr,cr,this.logger,this.performanceClient,this.correlationId)(u,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return yield m(Et,ut,this.logger,this.performanceClient,o)(e,g,s.verifier,k.acquireTokenPopup,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(c){throw t.popup?.close(),c instanceof w&&(c.setCorrelationId(this.correlationId),i.cacheFailedRequest(c)),c}})}executeEarFlow(e,t,r){return h(this,null,function*(){let{correlationId:o,authority:i,azureCloudOptions:s,extraQueryParameters:a,account:c}=e,l=yield m(Ee,He,this.logger,this.performanceClient,o)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,i,s,a,c),d=yield m(Dr,Gr,this.logger,this.performanceClient,o)(),u=r||(yield m(Be,Ke,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o)),g=I(f({},e),{earJwk:d,codeChallenge:u.challenge}),E=t.popup||this.openPopup("about:blank",t);(yield Yr(E.document,this.config,l,g,this.logger,this.performanceClient)).submit();let _=yield m(dt,Br,this.logger,this.performanceClient,o)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,g),B=te(hr,cr,this.logger,this.performanceClient,this.correlationId)(_,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);if(!B.ear_jwe&&B.code){let oe=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,o)({serverTelemetryManager:ee(k.acquireTokenPopup,this.config.auth.clientId,o,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:l});return m(Et,ut,this.logger,this.performanceClient,o)(g,B,u.verifier,k.acquireTokenPopup,this.config,oe,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return m(Zr,zr,this.logger,this.performanceClient,o)(g,B,k.acquireTokenPopup,this.config,l,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)})}executeCodeFlowWithPost(e,t,r,o){return h(this,null,function*(){let i=e.correlationId,s=yield m(Ee,He,this.logger,this.performanceClient,i)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger),a=t.popup||this.openPopup("about:blank",t);(yield Xr(a.document,this.config,s,e,this.logger,this.performanceClient)).submit();let l=yield m(dt,Br,this.logger,this.performanceClient,i)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),d=te(hr,cr,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return m(Et,ut,this.logger,this.performanceClient,i)(e,d,o,k.acquireTokenPopup,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)})}logoutPopupAsync(e,t,r,o){return h(this,null,function*(){this.logger.verbose("0b7yrk",this.correlationId),this.eventHandler.emitEvent(A.LOGOUT_START,this.correlationId,T.Popup,e);let i=ee(k.logoutPopup,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{yield Wr(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account);let s=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:r,account:e.account||void 0});try{s.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&s.authority.protocolMode===H.OIDC){if(this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,e.correlationId,T.Popup,e),o){let l={apiId:k.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},d=b.getAbsoluteUrl(o,Ie());yield this.navigationClient.navigateInternal(d,l)}t.popup?.close();return}}let a=s.getLogoutUri(e);this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,e.correlationId,T.Popup,e);let c=this.openPopup(a,t);if(this.eventHandler.emitEvent(A.POPUP_OPENED,e.correlationId,T.Popup,{popupWindow:c},null),yield dt(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e).catch(()=>{}),o){let l={apiId:k.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},d=b.getAbsoluteUrl(o,Ie());this.logger.verbose("0qcur2",this.correlationId),this.logger.verbosePii("0oj7lk",this.correlationId),yield this.navigationClient.navigateInternal(d,l)}else this.logger.verbose("03zgcf",this.correlationId)}catch(s){throw t.popup?.close(),s instanceof w&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),this.eventHandler.emitEvent(A.LOGOUT_FAILURE,this.correlationId,T.Popup,null,s),this.eventHandler.emitEvent(A.LOGOUT_END,this.correlationId,T.Popup),s}this.eventHandler.emitEvent(A.LOGOUT_END,this.correlationId,T.Popup)})}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("1kcr9k",this.correlationId),this.openPopup(e,t);throw this.logger.error("1l7hyp",this.correlationId),C(or)}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii("0cgeo7",this.correlationId),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii("0c2awd",this.correlationId),r=this.openSizedPopup(e,t)),!r)throw C(Pc);return r.focus&&r.focus(),this.currentWindow=r,r}catch{throw this.logger.error("0dxfb9",this.correlationId),C(Oc)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:o}){let i=o.screenLeft?o.screenLeft:o.screenX,s=o.screenTop?o.screenTop:o.screenY,a=o.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=o.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=r.popupSize?.width,d=r.popupSize?.height,u=r.popupPosition?.top,g=r.popupPosition?.left;return(!l||l<0||l>a)&&(this.logger.verbose("08vfmo",this.correlationId),l=X.POPUP_WIDTH),(!d||d<0||d>c)&&(this.logger.verbose("09cxa0",this.correlationId),d=X.POPUP_HEIGHT),(!u||u<0||u>c)&&(this.logger.verbose("1qh4wo",this.correlationId),u=Math.max(0,c/2-X.POPUP_HEIGHT/2+s)),(!g||g<0||g>a)&&(this.logger.verbose("1sz3en",this.correlationId),g=Math.max(0,a/2-X.POPUP_WIDTH/2+i)),o.open(e,t,`width=${l}, height=${d}, top=${u}, left=${g}, scrollbars=yes`)}generatePopupName(e,t){return`${X.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){let t=e.account&&e.account.homeAccountId;return`${X.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}};function Fp(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;let n=window.performance.getEntriesByType("navigation");return(n.length?n[0]:void 0)?.type}var Si=class extends ye{constructor(e,t,r,o,i,s,a,c,l,d){super(e,t,r,o,i,s,a,l,d),this.nativeStorage=c}acquireToken(e){return h(this,null,function*(){let t=yield m(Ut,xt,this.logger,this.performanceClient,this.correlationId)(e,T.Redirect,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.platformBroker=yt(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);let r=i=>{i.persisted&&(this.logger.verbose("0udvtt",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),this.eventHandler.emitEvent(A.RESTORE_FROM_BFCACHE,this.correlationId,T.Redirect))},o=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii("0zao0a",this.correlationId),this.browserStorage.setTemporaryCache(q.ORIGIN_URI,o,!0),window.addEventListener("pageshow",r);try{this.config.system.protocolMode===H.EAR?yield this.executeEarFlow(t):yield this.executeCodeFlow(t)}catch(i){throw i instanceof w&&i.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),i}})}executeCodeFlow(e){return h(this,null,function*(){let t=e.correlationId,r=ee(k.acquireTokenRedirect,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),o=yield m(Be,Ke,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),i=I(f({},e),{codeChallenge:o.challenge});this.browserStorage.cacheAuthorizeRequest(i,this.correlationId,o.verifier);try{if(i.httpMethod===y.HttpMethod.POST)return yield this.executeCodeFlowWithPost(i);{let s=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:i.authority,requestAzureCloudOptions:i.azureCloudOptions,requestExtraQueryParameters:i.extraQueryParameters,account:i.account}),a=yield m(Qr,se.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,s.authority,i,this.logger,this.performanceClient);return yield this.initiateAuthRequest(a)}}catch(s){throw s instanceof w&&(s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s)),s}})}executeEarFlow(e){return h(this,null,function*(){let{correlationId:t,authority:r,azureCloudOptions:o,extraQueryParameters:i,account:s}=e,a=yield m(Ee,He,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,o,i,s),c=yield m(Dr,Gr,this.logger,this.performanceClient,t)(),l=yield m(Be,Ke,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),d=I(f({},e),{earJwk:c,codeChallenge:l.challenge});return this.browserStorage.cacheAuthorizeRequest(d,this.correlationId,l.verifier),(yield Yr(document,this.config,a,d,this.logger,this.performanceClient)).submit(),new Promise((g,E)=>{setTimeout(()=>{E(C(Pt,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})})}executeCodeFlowWithPost(e){return h(this,null,function*(){let t=e.correlationId,r=yield m(Ee,He,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger);return this.browserStorage.cacheAuthorizeRequest(e,this.correlationId),(yield Xr(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Promise((i,s)=>{setTimeout(()=>{s(C(Pt,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})})}handleRedirectPromise(e,t,r,o){return h(this,null,function*(){let i=ee(k.handleRedirectPromise,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=o?.navigateToLoginRequestUrl??!0;try{let[a,c]=this.getRedirectResponse(o?.hash||"");if(!a)return this.logger.info("1qmv0q",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),Fp()!=="back_forward"?r.event.errorCode="no_server_response":this.logger.verbose("1eqegq",this.correlationId),null;let l=this.browserStorage.getTemporaryCache(q.ORIGIN_URI,this.correlationId,!0)||"",d=_e.normalizeUrlForComparison(l),u=_e.normalizeUrlForComparison(window.location.href);if(d===u&&s)return this.logger.verbose("11yred",this.correlationId),l.indexOf("#")>-1&&hl(l),yield this.handleResponse(a,e,t,i);if(s){if(!Lr()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(q.URL_HASH,c,!0);let g={apiId:k.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},E=!0;if(!l||l==="null"){let S=ul();this.browserStorage.setTemporaryCache(q.ORIGIN_URI,S,!0),this.logger.warning("1dutq1",this.correlationId),E=yield this.navigationClient.navigateInternal(S,g)}else this.logger.verbose("08jpy1",this.correlationId),E=yield this.navigationClient.navigateInternal(l,g);if(!E)return yield this.handleResponse(a,e,t,i)}}else return this.logger.verbose("0v4sdv",this.correlationId),yield this.handleResponse(a,e,t,i);return null}catch(a){throw a instanceof w&&(a.setCorrelationId(this.correlationId),i.cacheFailedRequest(a)),a}})}getRedirectResponse(e){this.logger.verbose("1c5i8m",this.correlationId);let t=e;t||(this.config.auth.OIDCOptions.responseMode===y.ResponseMode.QUERY?t=window.location.search:t=window.location.hash);let r=_e.getDeserializedResponse(t);if(r){try{Rd(r,this.browserCrypto,T.Redirect)}catch(i){return i instanceof w&&this.logger.error("0bkq6p",this.correlationId),[null,""]}return Xo(window),this.logger.verbose("00uvho",this.correlationId),[r,t]}let o=this.browserStorage.getTemporaryCache(q.URL_HASH,this.correlationId,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(q.URL_HASH)),o&&(r=_e.getDeserializedResponse(o),r)?(this.logger.verbose("001671",this.correlationId),[r,o]):[null,""]}handleResponse(e,t,r,o){return h(this,null,function*(){if(!e.state)throw C(nr);let{authority:s,azureCloudOptions:a,extraQueryParameters:c,account:l}=t;if(e.ear_jwe){let u=yield m(Ee,He,this.logger,this.performanceClient,t.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,s,a,c,l);return m(Zr,zr,this.logger,this.performanceClient,t.correlationId)(t,e,k.acquireTokenRedirect,this.config,u,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}let d=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:t.authority});return m(Et,ut,this.logger,this.performanceClient,t.correlationId)(t,e,r,k.acquireTokenRedirect,this.config,d,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)})}initiateAuthRequest(e){return h(this,null,function*(){if(this.logger.verbose("0yaw2e",this.correlationId),e){this.logger.infoPii("1luf83",this.correlationId);let t={apiId:k.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},r=this.config.auth.onRedirectNavigate;if(typeof r=="function")if(this.logger.verbose("1nehvl",this.correlationId),r(e)!==!1){this.logger.verbose("1a0jxh",this.correlationId),yield this.navigationClient.navigateExternal(e,t);return}else{this.logger.verbose("09k5h5",this.correlationId);return}else{this.logger.verbose("0klwf7",this.correlationId),yield this.navigationClient.navigateExternal(e,t);return}}else throw this.logger.info("0rlh4e",this.correlationId),C(or)})}logout(e){return h(this,null,function*(){this.logger.verbose("1rkurh",this.correlationId);let t=this.initializeLogoutRequest(e),r=ee(k.logout,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{this.eventHandler.emitEvent(A.LOGOUT_START,this.correlationId,T.Redirect,e),yield Wr(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account);let o={apiId:k.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===H.OIDC)try{i.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId){this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,this.correlationId,T.Redirect,t);return}}let s=i.getLogoutUri(t);t.account?.homeAccountId&&this.eventHandler.emitEvent(A.LOGOUT_SUCCESS,this.correlationId,T.Redirect,t);let a=this.config.auth.onRedirectNavigate;if(typeof a=="function")if(a(s)!==!1){this.logger.verbose("06v57e",this.correlationId),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,De.SIGNOUT),yield this.navigationClient.navigateExternal(s,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("0xqes1",this.correlationId);else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,De.SIGNOUT),yield this.navigationClient.navigateExternal(s,o);return}}catch(o){throw o instanceof w&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(A.LOGOUT_FAILURE,this.correlationId,T.Redirect,null,o),this.eventHandler.emitEvent(A.LOGOUT_END,this.correlationId,T.Redirect),o}this.eventHandler.emitEvent(A.LOGOUT_END,this.correlationId,T.Redirect)})}getRedirectStartPage(e){let t=e||window.location.href;return b.getAbsoluteUrl(t,Ie())}};function Vd(n,e,t,r){return h(this,null,function*(){if(!n)throw t.info("1l7hyp",r),C(or);return te(Kp,jh,t,e,r)(n)})}function jd(n,e,t,r,o){return h(this,null,function*(){let i=bl();if(!i.contentDocument)throw"No document associated with iframe!";return(yield Xr(i.contentDocument,n,e,t,r,o)).submit(),i})}function qd(n,e,t,r,o){return h(this,null,function*(){let i=bl();if(!i.contentDocument)throw"No document associated with iframe!";return(yield Yr(i.contentDocument,n,e,t,r,o)).submit(),i})}function Kp(n){let e=bl();return e.src=n,e}function bl(){let n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),n.setAttribute("allow","local-network-access *"),document.body.appendChild(n),n}var _i=class extends ye{constructor(e,t,r,o,i,s,a,c,l,d,u){super(e,t,r,o,i,s,c,d,u),this.apiId=a,this.nativeStorage=l}acquireToken(e){return h(this,null,function*(){!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("1kl318",this.correlationId);let t=f({},e);t.prompt?t.prompt!==y.PromptValue.NONE&&t.prompt!==y.PromptValue.NO_SESSION&&(this.logger.warning("0bmctg",this.correlationId),t.prompt=y.PromptValue.NONE):t.prompt=y.PromptValue.NONE;let r=yield m(Ut,xt,this.logger,this.performanceClient,this.correlationId)(t,T.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);return r.platformBroker=yt(this.config,this.logger,this.correlationId,this.platformAuthProvider,r.authenticationScheme),en(r.authority),this.config.system.protocolMode===H.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)})}executeCodeFlow(e){return h(this,null,function*(){let t,r=ee(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{return t=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),yield m(this.silentTokenHelper.bind(this),pl,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(o){if(o instanceof w&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),!t||!(o instanceof w)||o.errorCode!==X.INVALID_GRANT_ERROR)throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),yield m(this.silentTokenHelper.bind(this),pl,this.logger,this.performanceClient,this.correlationId)(t,e)}})}executeEarFlow(e){return h(this,null,function*(){let{correlationId:t,authority:r,azureCloudOptions:o,extraQueryParameters:i,account:s}=e,a=yield m(Ee,He,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,o,i,s),c=yield m(Dr,Gr,this.logger,this.performanceClient,t)(),l=yield m(Be,Ke,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),d=I(f({},e),{earJwk:c,codeChallenge:l.challenge});yield m(qd,li,this.logger,this.performanceClient,t)(this.config,a,d,this.logger,this.performanceClient);let u=this.config.auth.OIDCOptions.responseMode,g=yield m(dt,Br,this.logger,this.performanceClient,t)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,e),E=te(hr,cr,this.logger,this.performanceClient,t)(g,u,this.logger,this.correlationId);if(!E.ear_jwe&&E.code){let S=yield m(this.createAuthCodeClient.bind(this),Fe,this.logger,this.performanceClient,t)({serverTelemetryManager:ee(this.apiId,this.config.auth.clientId,t,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:a});return m(Et,ut,this.logger,this.performanceClient,t)(d,E,l.verifier,this.apiId,this.config,S,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return m(Zr,zr,this.logger,this.performanceClient,t)(d,E,this.apiId,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)})}logout(){return Promise.reject(C(ir))}silentTokenHelper(e,t){return h(this,null,function*(){let r=t.correlationId,o=yield m(Be,Ke,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),i=I(f({},t),{codeChallenge:o.challenge});if(t.httpMethod===y.HttpMethod.POST)yield m(jd,li,this.logger,this.performanceClient,r)(this.config,e.authority,i,this.logger,this.performanceClient);else{let l=yield m(Qr,se.GetAuthCodeUrl,this.logger,this.performanceClient,r)(this.config,e.authority,i,this.logger,this.performanceClient);yield m(Vd,li,this.logger,this.performanceClient,r)(l,this.performanceClient,this.logger,r)}let s=this.config.auth.OIDCOptions.responseMode,a=yield m(dt,Br,this.logger,this.performanceClient,r)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,t),c=te(hr,cr,this.logger,this.performanceClient,r)(a,s,this.logger,this.correlationId);return m(Et,ut,this.logger,this.performanceClient,r)(t,c,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)})}};var ki=class extends ye{acquireToken(e){return h(this,null,function*(){let t=yield m(ln,Kr,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger,this.correlationId),r=f(f({},e),t);e.redirectUri&&(r.redirectUri=lr(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId));let o=ee(k.acquireTokenSilent_silentFlow,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),i=yield this.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return m(i.acquireTokenByRefreshToken.bind(i),zh,this.logger,this.performanceClient,e.correlationId)(r,k.acquireTokenSilent_silentFlow).catch(s=>{throw s.setCorrelationId(this.correlationId),o.cacheFailedRequest(s),s})})}logout(){return Promise.reject(C(ir))}createRefreshTokenClient(e){return h(this,null,function*(){let t=yield m(this.getClientConfiguration.bind(this),Mt,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Ho(t,this.performanceClient)})}};var Ri=class extends tr{constructor(e,t){super(e,t),this.includeRedirectUri=!1}};var vi=class extends ye{constructor(e,t,r,o,i,s,a,c,l,d){super(e,t,r,o,i,s,c,l,d),this.apiId=a}acquireToken(e){return h(this,null,function*(){if(!e.code)throw C(zc);let t=yield m(Ut,xt,this.logger,this.performanceClient,this.correlationId)(e,T.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId),r=ee(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{let o=I(f({},t),{code:e.code}),i=yield m(this.getClientConfiguration.bind(this),Mt,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new Ri(i,this.performanceClient);this.logger.verbose("1uic5e",this.correlationId);let a=new Jr(s,this.browserStorage,o,this.logger,this.performanceClient);return yield m(a.handleCodeResponseFromServer.bind(a),se.HandleCodeResponseFromServer,this.logger,this.performanceClient,this.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,this.apiId,!1)}catch(o){throw o instanceof w&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),o}})}logout(){return Promise.reject(C(ir))}};function Wd(n,e,t,r){let o=window.msal?.clientIds||[],i=o.length,s=o.filter(a=>a===n).length;s>1&&t.warning("1e88vg",r),e.add({msalInstanceCount:i,sameClientIdInstanceCount:s})}function bi(n,e,t){try{Zo(n)}catch(r){throw e.end({success:!1},r,t),r}}var Oi=class n{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new ve(this.logger,this.performanceClient):qe,this.eventHandler=new Ct(this.logger),this.browserStorage=this.isBrowserEnvironment?new tt(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,er(this.config.auth)):pi(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);let t={cacheLocation:Z.MemoryStorage,cacheRetentionDays:5};this.nativeInternalStorage=new tt(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static createController(e,t){return h(this,null,function*(){let r=new n(e);return yield r.initialize(t),r})}trackPageVisibility(e){e&&(this.logger.info("16v6hv",e),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e);if(this.logger.trace("1f7joy",t),this.initialized){this.logger.info("061m5x",t);return}if(!this.isBrowserEnvironment){this.logger.info("19fvpi",t),this.initialized=!0,this.eventHandler.emitEvent(A.INITIALIZE_END,t);return}let r=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(Al,t);if(this.eventHandler.emitEvent(A.INITIALIZE_START,t),this.logMultipleInstances(o,t),yield m(this.browserStorage.initialize.bind(this.browserStorage),Vh,this.logger,this.performanceClient,t)(t),r)try{this.platformAuthProvider=yield vl(this.logger,this.performanceClient,t,this.config.system.nativeBrokerHandshakeTimeout)}catch(i){this.logger.verbose(i,t)}this.config.cache.cacheLocation===Z.LocalStorage&&this.eventHandler.subscribeCrossTab(),!this.config.system.navigatePopups&&(yield this.preGeneratePkceCodes(t)),this.initialized=!0,this.eventHandler.emitEvent(A.INITIALIZE_END,t),o.end({allowPlatformBroker:r,success:!0})})}handleRedirectPromise(e){return h(this,null,function*(){if(this.logger.verbose("02l8bm",""),si(this.initialized),this.isBrowserEnvironment){let t=e?.hash||"",r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("1wn9kp","")):this.logger.verbose("0w0gm3",""),r}return this.logger.verbose("12xi63",""),null})}handleRedirectPromiseInternal(e){return h(this,null,function*(){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",""),null;if(this.browserStorage.getInteractionInProgress()?.type===De.SIGNOUT)return this.logger.verbose("1ywcv2",""),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);let r=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),i=o&&this.platformAuthProvider&&!e?.hash,s,a;try{if(i&&this.platformAuthProvider){let c=o?.correlationId||"";this.eventHandler.emitEvent(A.HANDLE_REDIRECT_START,c,T.Redirect),s=this.performanceClient.startMeasurement(on,c),this.logger.trace("12v7is",c);let l=new Lt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,k.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,o.accountId,this.nativeInternalStorage,o.correlationId);a=m(l.handleRedirectPromise.bind(l),Zh,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{let[c,l]=this.browserStorage.getCachedRequest(""),d=c.correlationId;this.eventHandler.emitEvent(A.HANDLE_REDIRECT_START,d,T.Redirect),s=this.performanceClient.startMeasurement(on,d),this.logger.trace("0znzs5",d);let u=this.createRedirectClient(d);a=m(u.handleRedirectPromise.bind(u),Xh,this.logger,this.performanceClient,s.event.correlationId)(c,l,s,e)}}catch(c){throw this.browserStorage.resetRequestCache(""),c}return a.then(c=>(c?(this.browserStorage.resetRequestCache(c.correlationId),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,c.correlationId,T.Redirect,c),this.logger.verbose("0ui8f5",c.correlationId),r.length<this.getAllAccounts().length&&(this.eventHandler.emitEvent(A.LOGIN_SUCCESS,c.correlationId,T.Redirect,c.account),this.logger.verbose("16im3l",c.correlationId)),s.end({success:!0},void 0,c.account)):s.event.errorCode?s.end({success:!1},void 0):s.discard(),this.eventHandler.emitEvent(A.HANDLE_REDIRECT_END,s.event.correlationId,T.Redirect),c)).catch(c=>{this.browserStorage.resetRequestCache(s.event.correlationId);let l=c;throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,s.event.correlationId,T.Redirect,null,l),this.eventHandler.emitEvent(A.HANDLE_REDIRECT_END,s.event.correlationId,T.Redirect),s.end({success:!1},l),c})})}acquireTokenRedirect(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e);this.logger.verbose("0os66p",t);let r=this.performanceClient.startMeasurement(yl,t);r.add({scenarioId:e.scenarioId});let o=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=i=>{let s=typeof o=="function"?o(i):void 0;return r.add({navigateCallbackResult:s!==!1}),r.event=r.end({success:!0},void 0,e.account)||r.event,s};try{ai(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,De.SIGNIN),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,t,T.Redirect,e);let i;return this.platformAuthProvider&&this.canUsePlatformBroker(e)?i=new Lt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,k.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(a=>{if(a instanceof be&&Dt(a))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(a instanceof J)return this.logger.verbose("1ipyz4",t),this.createRedirectClient(t).acquireToken(e);throw a}):i=this.createRedirectClient(t).acquireToken(e),yield i}catch(i){throw this.browserStorage.resetRequestCache(t),r.event.status===2?this.performanceClient.startMeasurement(on,t).end({success:!1},i,e.account):r.end({success:!1},i,e.account),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,t,T.Redirect,null,i),i}})}acquireTokenPopup(e){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(rn,t);r.add({scenarioId:e.scenarioId});try{this.logger.verbose("0ch87b",t),bi(this.initialized,r,e.account),this.browserStorage.setInteractionInProgress(!0,De.SIGNIN,e.overrideInteractionInProgress,t)}catch(a){return Promise.reject(a)}let o=this.getAllAccounts();this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,t,T.Popup,e);let i,s=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?i=this.acquireTokenNative(I(f({},e),{correlationId:t}),k.acquireTokenPopup).then(a=>(r.end({success:!0,isNativeBroker:!0},void 0,a.account),a)).catch(a=>{if(a instanceof be&&Dt(a))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,s);if(a instanceof J)return this.logger.verbose("0yy5fw",t),this.createPopupClient(t).acquireToken(e,s);throw a}):i=this.createPopupClient(t).acquireToken(e,s),i.then(a=>{let c=o.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,t,T.Popup,a),c&&this.eventHandler.emitEvent(A.LOGIN_SUCCESS,t,T.Popup,a.account),r.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length},void 0,a.account),a}).catch(a=>(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,t,T.Popup,null,a),r.end({success:!1},a,e.account),Promise.reject(a))).finally(()=>h(this,null,function*(){this.browserStorage.setInteractionInProgress(!1),this.config.system.navigatePopups||(yield this.preGeneratePkceCodes(t))}))}trackPageVisibilityWithMeasurement(){let e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&e.increment({visibilityChangeCount:1})}ssoSilent(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e),r=I(f({},e),{prompt:e.prompt,correlationId:t});this.ssoSilentMeasurement=this.performanceClient.startMeasurement(nn,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),bi(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);let o=this.getAllAccounts();this.logger.verbose("0w1b45",t),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,t,T.Silent,r);let i;return this.canUsePlatformBroker(r)?i=this.acquireTokenNative(r,k.ssoSilent).catch(s=>{if(s instanceof be&&Dt(s))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw s}):i=this.createSilentIframeClient(r.correlationId).acquireToken(r),i.then(s=>{let a=o.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,t,T.Silent,s),a&&this.eventHandler.emitEvent(A.LOGIN_SUCCESS,t,T.Silent,s.account),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:s.fromPlatformBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length},void 0,s.account),s}).catch(s=>{throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,t,T.Silent,null,s),this.ssoSilentMeasurement?.end({success:!1},s,e.account),s}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})})}acquireTokenByCode(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e);this.logger.trace("0ch6ga",t);let r=this.performanceClient.startMeasurement(El,t);bi(this.initialized,r),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,t,T.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw C(Vc);if(e.code){let o=e.code,i=this.hybridAuthCodeResponses.get(o);return i?(this.logger.verbose("0qgp28",t),r.discard()):(this.logger.verbose("06eh73",t),i=this.acquireTokenByCodeAsync(I(f({},e),{correlationId:t})).then(s=>(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,t,T.Silent,s),this.hybridAuthCodeResponses.delete(o),r.end({success:!0,isNativeBroker:s.fromPlatformBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length},void 0,s.account),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,t,T.Silent,null,s),r.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(o,i)),yield i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){let o=yield this.acquireTokenNative(I(f({},e),{correlationId:t}),k.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof be&&Dt(i)&&(this.platformAuthProvider=void 0),i});return r.end({success:!0},void 0,o.account),o}else throw C(jc);else throw C(Gc)}catch(o){throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,t,T.Silent,null,o),r.end({success:!1},o),o}})}acquireTokenByCodeAsync(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.logger.trace("10d9hy",t),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(Yh,t),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),yield this.createSilentAuthCodeClient(t).acquireToken(e).then(i=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromPlatformBroker}),i)).catch(i=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})})}acquireTokenFromCache(e,t){return h(this,null,function*(){switch(t){case j.Default:case j.AccessToken:case j.AccessTokenAndRefreshToken:let r=this.createSilentCacheClient(e.correlationId);return m(r.acquireToken.bind(r),Hh,this.logger,this.performanceClient,e.correlationId)(e);default:throw p(N.tokenRefreshRequired)}})}acquireTokenByRefreshToken(e,t){return h(this,null,function*(){switch(t){case j.Default:case j.AccessTokenAndRefreshToken:case j.RefreshToken:case j.RefreshTokenAndNetwork:let r=this.createSilentRefreshClient(e.correlationId);return m(r.acquireToken.bind(r),Bh,this.logger,this.performanceClient,e.correlationId)(e);default:throw p(N.tokenRefreshRequired)}})}acquireTokenBySilentIframe(e){return h(this,null,function*(){let t=this.createSilentIframeClient(e.correlationId);return m(t.acquireToken.bind(t),Fh,this.logger,this.performanceClient,e.correlationId)(e)})}logoutRedirect(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e);return ai(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,De.SIGNOUT),this.createRedirectClient(t).logout(e)})}logoutPopup(e){try{let t=this.getRequestCorrelationId(e);return Zo(this.initialized),this.browserStorage.setInteractionInProgress(!0,De.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}clearCache(e){return h(this,null,function*(){if(!this.isBrowserEnvironment)return;let t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)})}getAllAccounts(e){return fi(this.logger,this.browserStorage,this.isBrowserEnvironment,this.getRequestCorrelationId(),e)}getAccount(e){return cn(e,this.logger,this.browserStorage,this.getRequestCorrelationId())}setActiveAccount(e){gi(e,this.browserStorage,this.getRequestCorrelationId())}getActiveAccount(){return Ci(this.browserStorage,this.getRequestCorrelationId())}hydrateCache(e,t){return h(this,null,function*(){this.logger.verbose("16jycr",e.correlationId);let r=ie.createAccountEntityFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return yield this.browserStorage.setAccount(r,e.correlationId,D.isKmsi(e.idTokenClaims),k.hydrateCache),e.fromPlatformBroker?(this.logger.verbose("1fxyu8",e.correlationId),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)})}acquireTokenNative(e,t,r,o){return h(this,null,function*(){let i=this.getRequestCorrelationId(e);if(this.logger.trace("0b9y3p",i),!this.platformAuthProvider)throw C($o);return new Lt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,i).acquireToken(e,o)})}canUsePlatformBroker(e,t){let r=this.getRequestCorrelationId(e);if(this.logger.trace("1n9lbl",r),!this.platformAuthProvider)return this.logger.trace("0vnu11",r),!1;if(!yt(this.config,this.logger,r,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("1m4bzf",r),!1;if(e.prompt)switch(e.prompt){case y.PromptValue.NONE:case y.PromptValue.CONSENT:case y.PromptValue.LOGIN:this.logger.trace("0vdv8e",r);break;default:return this.logger.trace("0pdzw6",r),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("16lbtk",r),!1):!0}getNativeAccountId(e){let t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new wi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createRedirectClient(e){return new Si(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentIframeClient(e){return new _i(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,k.ssoSilent,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentCacheClient(e){return new $r(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentRefreshClient(e){return new ki(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentAuthCodeClient(e){return new vi(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,k.acquireTokenByCode,this.performanceClient,e,this.platformAuthProvider)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Hr(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?O():""}loginRedirect(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.logger.verbose("0lz9hf",t),this.acquireTokenRedirect(f({correlationId:t},e||Go))})}loginPopup(e){let t=this.getRequestCorrelationId(e);return this.logger.verbose("0qw7v5",t),this.acquireTokenPopup(f({correlationId:t},e||Go))}acquireTokenSilent(e){return h(this,null,function*(){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(tn,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),bi(this.initialized,r,e.account),this.logger.verbose("0x1c4s",t);let o=e.account||this.getActiveAccount();if(!o)throw C(Dc);return this.acquireTokenSilentDeduped(e,o,t).then(i=>(r.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromPlatformBroker,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length},void 0,i.account),I(f({},i),{state:e.state,correlationId:t}))).catch(i=>{throw i instanceof w&&i.setCorrelationId(t),r.end({success:!1},i,o),i})})}acquireTokenSilentDeduped(e,t,r){return h(this,null,function*(){let o=lt(this.config.auth.clientId,I(f({},e),{authority:e.authority||this.config.auth.authority,correlationId:r}),t.homeAccountId),i=JSON.stringify(o),s=this.activeSilentTokenRequests.get(i);if(typeof s>"u"){this.logger.verbose("0fcjbk",r),this.performanceClient.addFields({deduped:!1},r);let a=m(this.acquireTokenSilentAsync.bind(this),Uh,this.logger,this.performanceClient,r)(I(f({},e),{correlationId:r}),t);return this.activeSilentTokenRequests.set(i,a),a.finally(()=>{this.activeSilentTokenRequests.delete(i)})}else return this.logger.verbose("1yq7nb",r),this.performanceClient.addFields({deduped:!0},r),s})}acquireTokenSilentAsync(e,t){return h(this,null,function*(){let r=()=>this.trackPageVisibility(e.correlationId);this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,e.correlationId,T.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);let o=yield m(_d,Gh,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||j.Default;return this.acquireTokenSilentNoIframe(o,i).catch(a=>h(this,null,function*(){if(Bp(a,i))if(this.activeIframeRequest)if(i!==j.Skip){let[l,d]=this.activeIframeRequest;this.logger.verbose("1w8fso",o.correlationId);let u=this.performanceClient.startMeasurement(Kh,o.correlationId);u.add({awaitIframeCorrelationId:d});let g=yield l;if(u.end({success:g}),g)return this.logger.verbose("0ywzzi",o.correlationId),this.acquireTokenSilentNoIframe(o,i);throw this.logger.info("17y14q",o.correlationId),a}else return this.logger.warning("1bd4p8",o.correlationId),m(this.acquireTokenBySilentIframe.bind(this),ml,this.logger,this.performanceClient,o.correlationId)(o);else{let l;return this.activeIframeRequest=[new Promise(d=>{l=d}),o.correlationId],this.logger.verbose("0rh08z",o.correlationId),m(this.acquireTokenBySilentIframe.bind(this),ml,this.logger,this.performanceClient,o.correlationId)(o).then(d=>(l(!0),d)).catch(d=>{throw l(!1),d}).finally(()=>{this.activeIframeRequest=void 0})}else throw a})).then(a=>(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,e.correlationId,T.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromPlatformBroker},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,e.correlationId,T.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",r)})})}acquireTokenSilentNoIframe(e,t){return h(this,null,function*(){return yt(this.config,this.logger,e.correlationId,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("0sczo4",e.correlationId),this.acquireTokenNative(e,k.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(r=>h(this,null,function*(){throw r instanceof be&&Dt(r)?(this.logger.verbose("07rkmb",e.correlationId),this.platformAuthProvider=void 0,p(N.tokenRefreshRequired)):r}))):(this.logger.verbose("0ox81t",e.correlationId),t===j.AccessToken&&this.logger.verbose("0fvwxe",e.correlationId),m(this.acquireTokenFromCache.bind(this),Mh,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===j.AccessToken)throw r;return this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_NETWORK_START,e.correlationId,T.Silent,e),m(this.acquireTokenByRefreshToken.bind(this),xh,this.logger,this.performanceClient,e.correlationId)(e,t)}))})}preGeneratePkceCodes(e){return h(this,null,function*(){return this.logger.verbose("1x6uj6",e),this.pkceCode=yield m(Be,Ke,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()})}getPreGeneratedPkceCodes(e){let t=this.pkceCode?f({},this.pkceCode):void 0;return this.pkceCode=void 0,t?this.logger.verbose("12js1o",e):this.logger.verbose("1oe9ci",e),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e,t){let r=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("1qtz3l",t),window.msal.clientIds.push(r),Wd(r,e,this.logger,t)}};function Bp(n,e){let t=!(n instanceof J&&n.subError!==Qe.badToken),r=n.errorCode===X.INVALID_GRANT_ERROR||n.errorCode===N.tokenRefreshRequired,o=t&&r||n.errorCode===Qe.noTokensFound||n.errorCode===Qe.refreshTokenExpired,i=hh.includes(e);return o&&i}var eo=class n{static loggerCallback(e,t){switch(e){case M.Error:console.error(t);return;case M.Info:console.info(t);return;case M.Verbose:console.debug(t);return;case M.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){this.browserEnvironment=typeof window<"u",this.config=Ai(e,this.browserEnvironment);let t;try{t=window[Z.SessionStorage]}catch{}let r=t?.getItem(yd),o=t?.getItem(Ad)?.toLowerCase(),i=o==="true"?!0:o==="false"?!1:void 0,s=f({},this.config.system.loggerOptions),a=r&&Object.keys(M).includes(r)?M[r]:void 0;a&&(s.loggerCallback=n.loggerCallback,s.logLevel=a),i!==void 0&&(s.piiLoggingEnabled=i),this.logger=new U(s,ft,W),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}};var Jd=(()=>{class n extends eo{getModuleName(){return n.MODULE_NAME}getId(){return n.ID}initialize(t){return h(this,null,function*(){return this.available=typeof window<"u",this.available})}}return n.MODULE_NAME="",n.ID="StandardOperatingContext",n})();function $d(n){return n.status!==void 0}var ze={UserInteractionRequired:"USER_INTERACTION_REQUIRED",UserCancel:"USER_CANCEL",NoNetwork:"NO_NETWORK",TransientError:"TRANSIENT_ERROR",PersistentError:"PERSISTENT_ERROR",Disabled:"DISABLED",AccountUnavailable:"ACCOUNT_UNAVAILABLE",NestedAppAuthUnavailable:"NESTED_APP_AUTH_UNAVAILABLE"};var Pi=class{constructor(e,t,r,o){this.clientId=e,this.clientCapabilities=t,this.crypto=r,this.logger=o}toNaaTokenRequest(e){let t;e.extraQueryParameters===void 0?t=new Map:t=new Map(Object.entries(e.extraQueryParameters));let r=e.correlationId||this.crypto.createNewGuid(),o=x.addClientCapabilitiesToClaims(e.claims,this.clientCapabilities),i=e.scopes||y.OIDC_DEFAULT_SCOPES;return{platformBrokerId:e.account?.homeAccountId,clientId:this.clientId,authority:e.authority,scope:i.join(" "),correlationId:r,claims:K.isEmptyObj(o)?void 0:o,state:e.state,authenticationScheme:e.authenticationScheme||y.AuthenticationScheme.BEARER,extraParameters:t}}fromNaaTokenResponse(e,t,r){if(!t.token.id_token||!t.token.access_token)throw p(N.nullOrEmptyToken);let o=P.toDateFromSeconds(r+(t.token.expires_in||0)),i=D.extractTokenClaims(t.token.id_token,this.crypto.base64Decode),s=this.fromNaaAccountInfo(t.account,t.token.id_token,i),a=t.token.scope||e.scope;return{authority:t.token.authority||s.environment,uniqueId:s.localAccountId,tenantId:s.tenantId,scopes:a.split(" "),account:s,idToken:t.token.id_token,idTokenClaims:i,accessToken:t.token.access_token,fromCache:!1,expiresOn:o,tokenType:e.authenticationScheme||y.AuthenticationScheme.BEARER,correlationId:e.correlationId,extExpiresOn:o,state:e.state}}fromNaaAccountInfo(e,t,r){let o=r||e.idTokenClaims,i=e.localAccountId||o?.oid||o?.sub||"",s=e.tenantId||ct(o)||"",a=e.homeAccountId||`${i}.${s}`,c=e.environment;if(!c)throw p(N.invalidCacheEnvironment);let l=o?.preferred_username||o?.upn,d=o?.emails?.[0]||null,u=e.username||l||d||"",g=e.name||o?.name||"",E=e.loginHint||o?.login_hint,S=new Map,_=ke(a,i,s,o);return S.set(s,_),{homeAccountId:a,environment:c,tenantId:s,username:u,localAccountId:i,name:g,loginHint:E,idToken:t,idTokenClaims:o,tenantProfiles:S}}fromBridgeError(e){if($d(e))switch(e.status){case ze.UserCancel:return new Pe(N.userCanceled);case ze.NoNetwork:return new Pe(N.noNetworkConnectivity);case ze.AccountUnavailable:return new Pe(N.noAccountFound);case ze.Disabled:return new Pe(N.nestedAppAuthBridgeDisabled);case ze.NestedAppAuthUnavailable:return new Pe(e.code||N.nestedAppAuthBridgeDisabled,e.description);case ze.TransientError:case ze.PersistentError:return new le(e.code,e.description);case ze.UserInteractionRequired:return new J(e.code,e.description);default:return new w(e.code,e.description)}else return new w("unknown_error","An unknown error occurred")}toAuthenticationResultFromCache(e,t,r,o,i){if(!t||!r)throw p(N.nullOrEmptyToken);let s=D.extractTokenClaims(t.secret,this.crypto.base64Decode),a=r.target||o.scopes.join(" ");return{authority:r.environment||e.environment,uniqueId:e.localAccountId,tenantId:e.tenantId,scopes:a.split(" "),account:e,idToken:t.secret,idTokenClaims:s||{},accessToken:r.secret,fromCache:!0,expiresOn:P.toDateFromSeconds(r.expiresOn),extExpiresOn:P.toDateFromSeconds(r.extendedExpiresOn),tokenType:o.authenticationScheme||y.AuthenticationScheme.BEARER,correlationId:i,state:o.state}}};var Se=class n extends w{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new n(Pd)}};var Ni=class n{constructor(e){this.operatingContext=e;let t=this.operatingContext.getBridgeProxy();if(t!==void 0)this.bridgeProxy=t;else throw new Error("unexpected: bridgeProxy is undefined");this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new ve(this.logger,this.performanceClient,!0):qe,this.eventHandler=new Ct(this.logger),this.browserStorage=this.operatingContext.isBrowserEnvironment()?new tt(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,er(this.config.auth)):pi(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler),this.nestedAppAuthAdapter=new Pi(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger);let r=this.bridgeProxy.getAccountContext();this.currentAccountContext=r||null}static createController(e){return h(this,null,function*(){let t=new n(e);return Promise.resolve(t)})}initialize(e,t){return h(this,null,function*(){let r=e?.correlationId||O();return yield this.browserStorage.initialize(r),Promise.resolve()})}ensureValidRequest(e){return e?.correlationId?e:I(f({},e),{correlationId:this.browserCrypto.createNewGuid()})}acquireTokenInteractive(e){return h(this,null,function*(){let t=this.ensureValidRequest(e),r=t.correlationId||O();this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,r,T.Popup,t);let o=this.performanceClient.startMeasurement(rn,r);o.add({nestedAppAuthRequest:!0});try{let i=this.nestedAppAuthAdapter.toNaaTokenRequest(t),s=P.nowSeconds(),a=yield this.bridgeProxy.getTokenInteractive(i),c=f({},this.nestedAppAuthAdapter.fromNaaTokenResponse(i,a,s));try{yield this.hydrateCache(c,e)}catch{this.logger.warningPii("1mwr91",r)}return this.currentAccountContext={homeAccountId:c.account.homeAccountId,environment:c.account.environment,tenantId:c.account.tenantId},this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,r,T.Popup,c),o.add({accessTokenSize:c.accessToken.length,idTokenSize:c.idToken.length}),o.end({success:!0,requestId:c.requestId},void 0,c.account),c}catch(i){let s=i instanceof w?i:this.nestedAppAuthAdapter.fromBridgeError(i);throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,r,T.Popup,null,i),o.end({success:!1},i,e.account),s}})}acquireTokenSilentInternal(e){return h(this,null,function*(){let t=this.ensureValidRequest(e),r=t.correlationId||O();this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_START,r,T.Silent,t);let o=yield this.acquireTokenFromCache(t);if(o)return this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,r,T.Silent,o),o;let i=this.performanceClient.startMeasurement(nn,r);i.increment({visibilityChangeCount:0}),i.add({nestedAppAuthRequest:!0});try{let s=this.nestedAppAuthAdapter.toNaaTokenRequest(t);s.forceRefresh=t.forceRefresh;let a=P.nowSeconds(),c=yield this.bridgeProxy.getTokenSilent(s),l=this.nestedAppAuthAdapter.fromNaaTokenResponse(s,c,a);try{yield this.hydrateCache(l,e)}catch{this.logger.warningPii("1mwr91",r)}return this.currentAccountContext={homeAccountId:l.account.homeAccountId,environment:l.account.environment,tenantId:l.account.tenantId},this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,r,T.Silent,l),i?.add({accessTokenSize:l.accessToken.length,idTokenSize:l.idToken.length}),i?.end({success:!0,requestId:l.requestId},void 0,l.account),l}catch(s){let a=s instanceof w?s:this.nestedAppAuthAdapter.fromBridgeError(s);throw this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,r,T.Silent,null,s),i?.end({success:!1},s,e.account),a}})}acquireTokenFromCache(e){return h(this,null,function*(){let t=e.correlationId||O(),r=this.performanceClient.startMeasurement(tn,t);if(r?.add({nestedAppAuthRequest:!0}),e.claims)return this.logger.verbose("11t57w",t),null;if(e.forceRefresh)return this.logger.verbose("1ovnmo",t),null;let o=null;switch(e.cacheLookupPolicy||(e.cacheLookupPolicy=j.Default),e.cacheLookupPolicy){case j.Default:case j.AccessToken:case j.AccessTokenAndRefreshToken:o=yield this.acquireTokenFromCacheInternal(e);break;default:return null}return o?(this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_SUCCESS,t,T.Silent,o),r.add({accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length}),r.end({success:!0},void 0,o.account),o):(this.logger.warning("1yb4fi",t),this.eventHandler.emitEvent(A.ACQUIRE_TOKEN_FAILURE,t,T.Silent,null),r.end({success:!1},void 0,e.account),null)})}acquireTokenFromCacheInternal(e){return h(this,null,function*(){let t=this.bridgeProxy.getAccountContext()||this.currentAccountContext,r=e.correlationId||O(),o=null;if(t&&(o=cn(t,this.logger,this.browserStorage,r)),!o)return this.logger.verbose("10qnr0",r),Promise.resolve(null);this.logger.verbose("1u7hux",r);let i=I(f({},e),{correlationId:r,authority:e.authority||o.environment,scopes:e.scopes?.length?e.scopes:[...y.OIDC_DEFAULT_SCOPES]}),s=this.browserStorage.getTokenKeys(),a=this.browserStorage.getAccessToken(o,i,s,o.tenantId);if(a){if(P.wasClockTurnedBack(a.cachedAt)||P.isTokenExpired(a.expiresOn,this.config.system.tokenRenewalOffsetSeconds))return this.logger.verbose("18egye",r),Promise.resolve(null)}else return this.logger.verbose("03vm49",r),Promise.resolve(null);let c=this.browserStorage.getIdToken(o,i.correlationId,s,o.tenantId);return c?this.nestedAppAuthAdapter.toAuthenticationResultFromCache(o,c,a,i,i.correlationId):(this.logger.verbose("0d68kd",r),Promise.resolve(null))})}acquireTokenPopup(e){return h(this,null,function*(){return this.acquireTokenInteractive(e)})}acquireTokenRedirect(e){throw Se.createUnsupportedError()}acquireTokenSilent(e){return h(this,null,function*(){return this.acquireTokenSilentInternal(e)})}acquireTokenByCode(e){throw Se.createUnsupportedError()}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw Se.createUnsupportedError()}removePerformanceCallback(e){throw Se.createUnsupportedError()}getAllAccounts(e){return fi(this.logger,this.browserStorage,this.isBrowserEnv(),O(),e)}getAccount(e){return cn(e,this.logger,this.browserStorage,O())}setActiveAccount(e){return gi(e,this.browserStorage,O())}getActiveAccount(){return Ci(this.browserStorage,O())}handleRedirectPromise(e){return Promise.resolve(null)}loginPopup(e){return this.acquireTokenInteractive(e||Go)}loginRedirect(e){throw Se.createUnsupportedError()}logoutRedirect(e){throw Se.createUnsupportedError()}logoutPopup(e){throw Se.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("1k8729","")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw Se.createUnsupportedError()}getRedirectResponse(){throw Se.createUnsupportedError()}clearCache(e){return h(this,null,function*(){throw Se.createUnsupportedError()})}hydrateCache(e,t){return h(this,null,function*(){this.logger.verbose("16jycr",e.correlationId);let r=ie.createAccountEntityFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return yield this.browserStorage.setAccount(r,e.correlationId,D.isKmsi(e.idTokenClaims),k.hydrateCache),this.browserStorage.hydrateCache(e,t)})}};var Qd=(()=>{class n{static initializeNestedAppAuthBridge(){return h(this,null,function*(){if(window===void 0)throw new Error("window is undefined");if(window.nestedAppAuthBridge===void 0)throw new Error("window.nestedAppAuthBridge is undefined");try{window.nestedAppAuthBridge.addEventListener("message",r=>{let o=typeof r=="string"?r:r.data,i=JSON.parse(o),s=n.bridgeRequests.find(a=>a.requestId===i.requestId);s!==void 0&&(n.bridgeRequests.splice(n.bridgeRequests.indexOf(s),1),i.success?s.resolve(i):s.reject(i.error))});let t=yield new Promise((r,o)=>{let i=n.buildRequest("GetInitContext"),s={requestId:i.requestId,method:i.method,resolve:r,reject:o};n.bridgeRequests.push(s),window.nestedAppAuthBridge.postMessage(JSON.stringify(i))});return n.validateBridgeResultOrThrow(t.initContext)}catch(t){throw window.console.log(t),t}})}getTokenInteractive(t){return this.getToken("GetTokenPopup",t)}getTokenSilent(t){return this.getToken("GetToken",t)}getToken(t,r){return h(this,null,function*(){let o=yield this.sendRequest(t,{tokenParams:r});return{token:n.validateBridgeResultOrThrow(o.token),account:n.validateBridgeResultOrThrow(o.account)}})}getHostCapabilities(){return this.capabilities??null}getAccountContext(){return this.accountContext?this.accountContext:null}static buildRequest(t,r){return f({messageType:"NestedAppAuthRequest",method:t,requestId:O(),sendTime:Date.now(),clientLibrary:X.MSAL_SKU,clientLibraryVersion:W},r)}sendRequest(t,r){let o=n.buildRequest(t,r);return new Promise((s,a)=>{let c={requestId:o.requestId,method:o.method,resolve:s,reject:a};n.bridgeRequests.push(c),window.nestedAppAuthBridge.postMessage(JSON.stringify(o))})}static validateBridgeResultOrThrow(t){if(t===void 0)throw{status:ze.NestedAppAuthUnavailable};return t}constructor(t,r,o,i){this.sdkName=t,this.sdkVersion=r,this.accountContext=o,this.capabilities=i}static create(){return h(this,null,function*(){let t=yield n.initializeNestedAppAuthBridge();return new n(t.sdkName,t.sdkVersion,t.accountContext,t.capabilities)})}}return n.bridgeRequests=[],n})();var Yd=(()=>{class n extends eo{constructor(){super(...arguments),this.bridgeProxy=void 0,this.accountContext=null}getModuleName(){return n.MODULE_NAME}getId(){return n.ID}getBridgeProxy(){return this.bridgeProxy}initialize(t){return h(this,null,function*(){try{if(typeof window<"u"){typeof window.__initializeNestedAppAuth=="function"&&(yield window.__initializeNestedAppAuth());let r=yield Qd.create();this.accountContext=r.getAccountContext(),this.bridgeProxy=r,this.available=r!==void 0}}catch{this.logger.infoPii("1mdxyj",t)}return this.logger.info("12jy9a",t),this.available})}}return n.MODULE_NAME="",n.ID="NestedAppOperatingContext",n})();var dn=class{constructor(e,t){this.controller=t||new Oi(new Jd(e))}initialize(e){return h(this,null,function*(){return this.controller.initialize(e)})}acquireTokenPopup(e){return h(this,null,function*(){return this.controller.acquireTokenPopup(e)})}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}getAccount(e){return this.controller.getAccount(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){return h(this,null,function*(){return this.controller.hydrateCache(e,t)})}clearCache(e){return this.controller.clearCache(e)}};function zp(n,e,t){return h(this,null,function*(){let r=e||O(),o=new Yd(n);if(yield o.initialize(r),o.isAvailable()){let i=new Ni(o),s=t?t(n,i):new dn(n,i);return yield s.initialize({correlationId:r}),s}return Xd(n)})}function Xd(n){return h(this,null,function*(){let e=new dn(n);return yield e.initialize(),e})}var Gp={initialize:()=>Promise.reject(Q(he)),acquireTokenPopup:()=>Promise.reject(Q(he)),acquireTokenRedirect:()=>Promise.reject(Q(he)),acquireTokenSilent:()=>Promise.reject(Q(he)),acquireTokenByCode:()=>Promise.reject(Q(he)),getAllAccounts:()=>[],getAccount:()=>null,handleRedirectPromise:()=>Promise.reject(Q(he)),loginPopup:()=>Promise.reject(Q(he)),loginRedirect:()=>Promise.reject(Q(he)),logoutRedirect:()=>Promise.reject(Q(he)),logoutPopup:()=>Promise.reject(Q(he)),ssoSilent:()=>Promise.reject(Q(he)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,getLogger:()=>{throw Q(he)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw Q(he)},hydrateCache:()=>Promise.reject(Q(he)),clearCache:()=>Promise.reject(Q(he))};function Vp(i,s,a,c){return h(this,arguments,function*(n,e,t,r,o=new Ce){Hr();let l=Ai(n,!0),d=e.correlationId||O(),u=o.startMeasurement(Il,d);try{let g=t.id_token?D.extractTokenClaims(t.id_token,$):void 0,E=D.isKmsi(g||{}),S={protocolMode:l.system.protocolMode,knownAuthorities:l.auth.knownAuthorities,cloudDiscoveryMetadata:l.auth.cloudDiscoveryMetadata,authorityMetadata:l.auth.authorityMetadata},_=new U(l.system.loggerOptions||{}),B=new ve(_,l.telemetry.client),oe=new tt(l.auth.clientId,l.cache,B,_,l.telemetry.client,new Ct(_),er(l.auth)),L=e.authority||l.auth.authority,ae=yield Or.createDiscoveredInstance(Ue.generateAuthority(L,e.azureCloudOptions),l.system.networkClient,oe,S,_,d,o),ce=yield m(jp,dd,_,o,d)(e,r.clientInfo||t.client_info||"",d,oe,_,B,ae,g),At=yield m(qp,ud,_,o,d)(t,ce.homeAccountId,ce.environment,ce.realm,E,d,oe,_,n.auth.clientId),Tt=yield m(Wp,md,_,o,d)(e,t,ce.homeAccountId,ce.environment,ce.realm,E,r,d,oe,_,n.auth.clientId),tu=yield m(Jp,pd,_,o,d)(t,ce.homeAccountId,ce.environment,E,d,oe,_,n.auth.clientId,o);return u.end({success:!0},void 0,ie.getAccountInfo(ce)),$p(e,{account:ce,idToken:At,accessToken:Tt,refreshToken:tu},ae,g)}catch(g){throw u.end({success:!1},g),g}})}function jp(n,e,t,r,o,i,s,a){return h(this,null,function*(){if(o.verbose("0ke46k",t),n.account){let u=ie.createAccountEntityFromAccountInfo(n.account);return yield r.setAccount(u,t,D.isKmsi(a||{}),k.loadExternalTokens),u}else if(!e&&!a)throw o.error("0hzcn4",t),C(Bc);let c=ie.generateHomeAccountId(e,s.authorityType,o,i,t,a),l=a?.tid,d=vr(r,s,c,$,t,a,e,s.getPreferredCache(),l,void 0,void 0,o);return yield r.setAccount(d,t,D.isKmsi(a||{}),k.loadExternalTokens),d})}function qp(n,e,t,r,o,i,s,a,c){return h(this,null,function*(){if(!n.id_token)return a.verbose("1pm7g1",i),null;a.verbose("168lyi",i);let l=V.createIdTokenEntity(e,t,n.id_token,c,r);return yield s.setIdTokenCredential(l,i,o),l})}function Wp(n,e,t,r,o,i,s,a,c,l,d){return h(this,null,function*(){if(e.access_token)if(e.expires_in){if(!e.scope&&(!n.scopes||!n.scopes.length))return l.error("1h7xse",a),null}else return l.error("15mzx8",a),null;else return l.verbose("1ckp9e",a),null;l.verbose("01kmxb",a);let u=e.scope?G.fromString(e.scope):new G(n.scopes),g=s.expiresOn||e.expires_in+P.nowSeconds(),E=s.extendedExpiresOn||(e.ext_expires_in||e.expires_in)+P.nowSeconds(),S=V.createAccessTokenEntity(t,r,e.access_token,d,o,u.printScopes(),g,E,$);return yield c.setAccessTokenCredential(S,a,i),S})}function Jp(n,e,t,r,o,i,s,a,c){return h(this,null,function*(){if(!n.refresh_token)return s.verbose("1l7um5",o),null;let l=n.refresh_token_expires_in?n.refresh_token_expires_in+P.nowSeconds():void 0;c.addFields({extRtExpiresOnSeconds:l},o),s.verbose("0qy8ev",o);let d=V.createRefreshTokenEntity(e,t,n.refresh_token,a,n.foci,void 0,l);return yield i.setRefreshTokenCredential(d,o,r),d})}function $p(n,e,t,r){let o="",i=[],s=null,a;e?.accessToken&&(o=e.accessToken.secret,i=G.fromString(e.accessToken.target).asArray(),s=P.toDateFromSeconds(e.accessToken.expiresOn),a=P.toDateFromSeconds(e.accessToken.extendedExpiresOn));let c=e.account;return{authority:t.canonicalAuthority,uniqueId:e.account.localAccountId,tenantId:e.account.realm,scopes:i,account:ie.getAccountInfo(c),idToken:e.idToken?.secret||"",idTokenClaims:r||{},accessToken:o,fromCache:!0,expiresOn:s,correlationId:n.correlationId||"",requestId:"",extExpiresOn:a,familyId:e.refreshToken?.familyId||"",tokenType:e?.accessToken?.tokenType||"",state:n.state||"",cloudGraphHostName:c.cloudGraphHostName||"",msGraphHost:c.msGraphHost||"",fromPlatformBroker:!1}}var Ol=class{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case A.ACQUIRE_TOKEN_START:if(e.interactionType===T.Redirect||e.interactionType===T.Popup)return Le.AcquireToken;break;case A.HANDLE_REDIRECT_START:return Le.HandleRedirect;case A.LOGOUT_START:return Le.Logout;case A.LOGOUT_END:if(t&&t!==Le.Logout)break;return Le.None;case A.HANDLE_REDIRECT_END:if(t&&t!==Le.HandleRedirect)break;return Le.None;case A.ACQUIRE_TOKEN_SUCCESS:case A.ACQUIRE_TOKEN_FAILURE:case A.RESTORE_FROM_BFCACHE:if(e.interactionType===T.Redirect||e.interactionType===T.Popup){if(t&&t!==Le.AcquireToken)break;return Le.None}break}return null}};var Pl=class{constructor(e,t){let r=t&&t.loggerOptions||{};this.logger=new U(r,ft,W),this.cryptoOps=new ve(this.logger),this.popTokenGenerator=new de(this.cryptoOps,new Ce),this.shrParameters=e}generatePublicKeyThumbprint(){return h(this,null,function*(){let{kid:e}=yield this.popTokenGenerator.generateKid(this.shrParameters);return e})}signRequest(e,t,r){return h(this,null,function*(){return this.popTokenGenerator.signPayload(e,t,this.shrParameters,r)})}removeKeys(e,t){return h(this,null,function*(){return this.cryptoOps.removeTokenBindingKey(e,t)})}};function Zd(){let n;try{n=window[Z.SessionStorage];let e=n?.getItem(Td);if(Number(e)===1)return import("./chunk-UQZI6XAJ.js")}catch{}}function eu(){return typeof window<"u"&&typeof window.performance<"u"&&typeof window.performance.now=="function"}function Qp(n){if(!(!n||!eu()))return Math.round(window.performance.now()-n)}var Nl=class extends Bo{constructor(e,t){super(e.auth.clientId,e.auth.authority||`${y.DEFAULT_AUTHORITY}`,new U(e.system?.loggerOptions||{},ft,W),ft,W,e.telemetry?.application||{appName:"",appVersion:""},t)}generateId(){return O()}getPageVisibility(){return document.visibilityState?.toString()||null}deleteIncompleteSubMeasurements(e){Zd()?.then(t=>{let r=this.eventsByCorrelationId.get(e.event.correlationId),o=r&&r.eventId===e.event.eventId,i=[];o&&r?.incompleteSubMeasurements&&r.incompleteSubMeasurements.forEach(s=>{i.push(f({},s))}),t.BrowserPerformanceMeasurement.flushMeasurements(e.event.correlationId,i)})}startMeasurement(e,t){let r=this.getPageVisibility(),o=super.startMeasurement(e,t),i=eu()?window.performance.now():void 0,s=Zd()?.then(a=>new a.BrowserPerformanceMeasurement(e,o.event.correlationId));return s?.then(a=>a.startMeasurement()),I(f({},o),{end:(a,c,l)=>{let d=o.end(I(f({},a),{startPageVisibility:r,endPageVisibility:this.getPageVisibility(),durationMs:Qp(i)}),c,l);return s?.then(u=>u.endMeasurement()),this.deleteIncompleteSubMeasurements(o),d},discard:()=>{o.discard(),s?.then(a=>a.flushMeasurement()),this.deleteIncompleteSubMeasurements(o)}})}};var Hv=y.AuthenticationScheme,Fv=y.ResponseMode,Kv=y.PromptValue,Bv=y.JsonWebTokenTypes,zv=y.OIDC_DEFAULT_SCOPES;export{k as ApiId,w as AuthError,vt as AuthErrorCodes,Xn as AuthenticationHeaderParser,Hv as AuthenticationScheme,Rt as AzureCloudInstance,bt as BrowserAuthError,uh as BrowserAuthErrorCodes,Z as BrowserCacheLocation,ii as BrowserConfigurationAuthError,kh as BrowserConfigurationAuthErrorCodes,Nl as BrowserPerformanceClient,ru as BrowserPerformanceMeasurement,gd as BrowserRootPerformanceEvents,Nh as BrowserUtils,j as CacheLookupPolicy,Pe as ClientAuthError,N as ClientAuthErrorCodes,lo as ClientConfigurationError,ge as ClientConfigurationErrorCodes,Gd as DEFAULT_IFRAME_TIMEOUT_MS,Ct as EventHandler,Ol as EventMessageUtils,A as EventType,J as InteractionRequiredAuthError,Qe as InteractionRequiredAuthErrorCodes,Le as InteractionStatus,T as InteractionType,Bv as JsonWebTokenTypes,sn as LocalStorage,M as LogLevel,U as Logger,Ze as MemoryStorage,hn as NavigationClient,zv as OIDC_DEFAULT_SCOPES,Kv as PromptValue,H as ProtocolMode,dn as PublicClientApplication,Fv as ResponseMode,le as ServerError,an as SessionStorage,Pl as SignedHttpRequest,Ce as StubPerformanceClient,fp as WrapperSKU,zp as createNestablePublicClientApplication,Xd as createStandardPublicClientApplication,Lp as isPlatformBrokerAvailable,Vp as loadExternalTokens,Gp as stubbedPublicClientApplication,W as version};
